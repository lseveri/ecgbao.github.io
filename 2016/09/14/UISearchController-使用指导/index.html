
 <!DOCTYPE HTML>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
  
    <title>UISearchController 使用指导 | 跳跳魔王的博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="跳跳魔王">
    

    
    <meta name="description" content="So much data, so little time.Note: Updated for Xcode 7.3, iOS 9.3, and Swift 2.2 on 04-03-2016Update note: This tutorial was updated to iOS 9 and Swift 2 by Andy Pereira. Origi">
<meta property="og:type" content="article">
<meta property="og:title" content="UISearchController 使用指导">
<meta property="og:url" content="http://yoursite.com/2016/09/14/UISearchController-使用指导/index.html">
<meta property="og:site_name" content="跳跳魔王的博客">
<meta property="og:description" content="So much data, so little time.Note: Updated for Xcode 7.3, iOS 9.3, and Swift 2.2 on 04-03-2016Update note: This tutorial was updated to iOS 9 and Swift 2 by Andy Pereira. Origi">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2015/09/UISearchController-Square.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2015/09/UISearchController-Starter-281x500.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2015/09/UISearchController-Data-281x500.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2015/09/darkchocolate.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2015/09/ragecomic.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2015/09/UISearchController-Filter-281x500.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2015/09/CandySearch-DetailView-281x500.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2015/09/UISearchController-Filter-with-Scope-281x500.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2012/07/nosearchfunction.jpg">
<meta property="og:updated_time" content="2016-09-14T01:23:10.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="UISearchController 使用指导">
<meta name="twitter:description" content="So much data, so little time.Note: Updated for Xcode 7.3, iOS 9.3, and Swift 2.2 on 04-03-2016Update note: This tutorial was updated to iOS 9 and Swift 2 by Andy Pereira. Origi">
<meta name="twitter:image" content="http://www.raywenderlich.com/wp-content/uploads/2015/09/UISearchController-Square.png">

    
    <link rel="alternative" href="/atom.xml" title="跳跳魔王的博客" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="跳跳魔王的博客">跳跳魔王的博客</a></h1>
				<h2 class="blog-motto">每天进步一点点</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页</a></li>
					
						<li><a href="/archives">归档</a></li>
					
						<li><a href="/about">关于</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/09/14/UISearchController-使用指导/" title="UISearchController 使用指导" itemprop="url">UISearchController 使用指导</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="跳跳魔王" target="_blank" itemprop="author">跳跳魔王</a>
		
  <p class="article-time">
    <time datetime="2016-09-14T00:59:02.000Z" itemprop="datePublished"> Published 2016-09-14</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">Contents</strong>
		
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">1.</span> <span class="toc-text">Getting Started</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">2.</span> <span class="toc-text">Populating the Table View</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">3.</span> <span class="toc-text">Introducing UISearchController</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">3.1.</span> <span class="toc-text">UISearchResultsUpdating and Filtering</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">4.</span> <span class="toc-text">Sending Data to a Detail View</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">5.</span> <span class="toc-text">Creating a Scope Bar to Filter Results</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">6.</span> <span class="toc-text">Where To Go From Here?</span></a></li></ol>
		
		</div>
		
		<div class="content-wrapper"><br>                        <div id="attachment_78152" style="width: 260px" class="wp-caption alignright"><img src="http://www.raywenderlich.com/wp-content/uploads/2015/09/UISearchController-Square.png" alt="UISearchBar-square" width="250" height="250" class="alignright size-thumbnail wp-image-78152"><p class="wp-caption-text">So much data, so little time.</p></div><br><p><em>Note</em>: Updated for Xcode 7.3, iOS 9.3, and Swift 2.2 on 04-03-2016</p><br><p><em>Update note:</em> This tutorial was updated to iOS 9 and Swift 2 by Andy Pereira. <a href="/?p=16873">Original post</a> by Tutorial Team Member Nicolas Martin.</p><br><p>If your app displays large datasets, scrolling through massive lists becomes slow and frustrating. In that case, it’s vitally important to allow users to search for specific items. Lucky for you, UIKit includes <code>UISearchBar</code> which seamlessly integrates with <code>UITableView</code> and allows for quick, responsive filtering of information.</p><br><p>In this <code>UISearchController</code> tutorial, you’ll build a searchable Candy app which is based on a standard table view. You&#8217;ll add table view search capability, including dynamic filtering, and add an optional scope bar, all while taking advantage of <code>UISearchController</code>, added in iOS 8. In the end, you&#8217;ll know how to make your apps much more user friendly and satisfy your users&#8217; urgent demands.</p><br><p>Ready for some sugar-coated search results? Read on.</p><br><h2>Getting Started</h2><br><p>Download the starter project from the tutorial <a href="http://www.raywenderlich.com/wp-content/uploads/2015/09/CandySearch-Starter.zip" target="_blank" rel="external">here</a> and open the project. The app has already been set up with a navigation controller and styling. Build and run the app; you&#8217;ll see an empty list:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2015/09/UISearchController-Starter.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2015/09/UISearchController-Starter-281x500.png" alt="UISearchController-Starter" width="281" height="500" class="aligncenter size-large wp-image-113862" srcset="https://cdn5.raywenderlich.com/wp-content/uploads/2015/09/UISearchController-Starter-281x500.png 281w, https://cdn5.raywenderlich.com/wp-content/uploads/2015/09/UISearchController-Starter-180x320.png 180w, https://cdn5.raywenderlich.com/wp-content/uploads/2015/09/UISearchController-Starter.png 750w" sizes="(max-width: 281px) 100vw, 281px"></a></p><br><p>Back in Xcode, the file <em>Candy.swift</em> contains a class to store the information about each piece of candy you&#8217;ll be displaying. This class has two properties: the category and name of the candy.</p><br><p>When the user searches for a candy in your app, you’ll be referencing the name property against the user&#8217;s search string. You’ll see how the category string will become important near the end of this tutorial when you implement the Scope Bar.</p><br><h2>Populating the Table View</h2><br><p>Open <em>MasterViewController.swift</em>. The <code>candies</code> property will be where you manage all the different <code>Candy</code> objects for your users to search.  Speaking of which, it&#8217;s time to create some Candy!</p><br><p>In this tutorial, you only need to create a limited number of values to illustrate how the search bar works; in a production app, you might have thousands of these searchable objects. But whether an app has thousands of objects to search or just a few, the methods used will remain the same. Scalability at its finest!</p><br><p>To populate your <code>candies</code> array, add the following code to <code>viewDidLoad()</code>, after the call to <code>super.viewDidLoad()</code>:</p><br><br><div class="wp_codebox"><table><tr id="p1137721"><td class="code" id="p113772code1"><pre class="swift" style="font-family:monospace;">candies <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span><br>  Candy<span style="color: #002200;">&#40;</span>category<span style="color: #002200;">:</span><span style="color: #bf1d1a;">&quot;Chocolate&quot;</span>, name<span style="color: #002200;">:</span><span style="color: #bf1d1a;">&quot;Chocolate Bar&quot;</span><span style="color: #002200;">&#41;</span>,<br>  Candy<span style="color: #002200;">&#40;</span>category<span style="color: #002200;">:</span><span style="color: #bf1d1a;">&quot;Chocolate&quot;</span>, name<span style="color: #002200;">:</span><span style="color: #bf1d1a;">&quot;Chocolate Chip&quot;</span><span style="color: #002200;">&#41;</span>,<br>  Candy<span style="color: #002200;">&#40;</span>category<span style="color: #002200;">:</span><span style="color: #bf1d1a;">&quot;Chocolate&quot;</span>, name<span style="color: #002200;">:</span><span style="color: #bf1d1a;">&quot;Dark Chocolate&quot;</span><span style="color: #002200;">&#41;</span>,<br>  Candy<span style="color: #002200;">&#40;</span>category<span style="color: #002200;">:</span><span style="color: #bf1d1a;">&quot;Hard&quot;</span>, name<span style="color: #002200;">:</span><span style="color: #bf1d1a;">&quot;Lollipop&quot;</span><span style="color: #002200;">&#41;</span>,<br>  Candy<span style="color: #002200;">&#40;</span>category<span style="color: #002200;">:</span><span style="color: #bf1d1a;">&quot;Hard&quot;</span>, name<span style="color: #002200;">:</span><span style="color: #bf1d1a;">&quot;Candy Cane&quot;</span><span style="color: #002200;">&#41;</span>,<br>  Candy<span style="color: #002200;">&#40;</span>category<span style="color: #002200;">:</span><span style="color: #bf1d1a;">&quot;Hard&quot;</span>, name<span style="color: #002200;">:</span><span style="color: #bf1d1a;">&quot;Jaw Breaker&quot;</span><span style="color: #002200;">&#41;</span>,<br>  Candy<span style="color: #002200;">&#40;</span>category<span style="color: #002200;">:</span><span style="color: #bf1d1a;">&quot;Other&quot;</span>, name<span style="color: #002200;">:</span><span style="color: #bf1d1a;">&quot;Caramel&quot;</span><span style="color: #002200;">&#41;</span>,<br>  Candy<span style="color: #002200;">&#40;</span>category<span style="color: #002200;">:</span><span style="color: #bf1d1a;">&quot;Other&quot;</span>, name<span style="color: #002200;">:</span><span style="color: #bf1d1a;">&quot;Sour Chew&quot;</span><span style="color: #002200;">&#41;</span>,<br>  Candy<span style="color: #002200;">&#40;</span>category<span style="color: #002200;">:</span><span style="color: #bf1d1a;">&quot;Other&quot;</span>, name<span style="color: #002200;">:</span><span style="color: #bf1d1a;">&quot;Gummi Bear&quot;</span><span style="color: #002200;">&#41;</span><br><span style="color: #002200;">&#93;</span></pre></td></tr></table></div>

<p>Go ahead and build and run your project again. Since the table view&#8217;s delegate and datasource methods have already been implemented, you&#8217;ll see that you now have a working table view: </p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2015/09/UISearchController-Data.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2015/09/UISearchController-Data-281x500.png" alt="UISearchController-Data" width="281" height="500" class="aligncenter size-large wp-image-113861" srcset="https://cdn2.raywenderlich.com/wp-content/uploads/2015/09/UISearchController-Data-281x500.png 281w, https://cdn2.raywenderlich.com/wp-content/uploads/2015/09/UISearchController-Data-180x320.png 180w, https://cdn2.raywenderlich.com/wp-content/uploads/2015/09/UISearchController-Data.png 750w" sizes="(max-width: 281px) 100vw, 281px"></a></p><br><p>Selecting a row in the table will also display a detail view of the corresponding candy:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2015/09/darkchocolate.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2015/09/darkchocolate.png" alt="Dark Chocolate" width="281" height="500" class="aligncenter size-large wp-image-115841" srcset="https://cdn2.raywenderlich.com/wp-content/uploads/2015/09/darkchocolate.png 375w, https://cdn2.raywenderlich.com/wp-content/uploads/2015/09/darkchocolate-180x320.png 180w, https://cdn2.raywenderlich.com/wp-content/uploads/2015/09/darkchocolate-281x500.png 281w" sizes="(max-width: 281px) 100vw, 281px"></a></p><br><p>So much candy, so little time to find what you want! You need a <code>UISearchBar</code>.</p><br><h2>Introducing UISearchController</h2><br><p>If you look at the <code>UISearchController</code> documentation, you&#8217;ll discover it&#8217;s pretty lazy. It doesn’t do any of the work of searching at all. The class simply provides a standard interface that users have come to expect from their iOS apps.</p><br><p><code>UISearchController</code> communicates with a delegate protocol to let the rest of your app know what the user is doing. You have to write all of the actual functionality for string matching yourself.</p><br><p>Although this may seem a tad scary at first, writing custom search functions gives you tight control over how results are returned specifically in your app. Your users will appreciate searches that are intelligent — and fast.</p><br><p>If you&#8217;ve worked with searching table views iOS in the past, you may be familiar with <code>UISearchDisplayController</code>. Since iOS 8, this class has been deprecated in favor of <code>UISearchController</code>, which simplifies the entire search process.</p><br><p>Unfortunately, at the time of this writing, Interface Builder does not support <code>UISearchController</code>, so you&#8217;ll have to create your UI programmatically.</p><br><p>In <em>MasterViewController.swift</em>, add a new property:</p>

<div class="wp_codebox"><table><tr id="p1137722"><td class="code" id="p113772code2"><pre class="swift" style="font-family:monospace;"><span style="color: #a61390;">let</span> searchController <span style="color: #002200;">=</span> UISearchController<span style="color: #002200;">&#40;</span>searchResultsController<span style="color: #002200;">:</span> <span style="color: #a61390;">nil</span><span style="color: #002200;">&#41;</span></pre></td></tr></table></div>

<p>By initializing <code>UISearchController</code> without a <code>searchResultsController</code>, you are telling the search controller that you want use the same  view that you&#8217;re searching to display the results. If you specify a different view controller here, that will be used to display the results instead.</p><br><p>Next, you&#8217;ll need to set up a few parameters for your searchController. Still in <em>MasterViewController.swift</em>, add the following to <code>viewDidLoad()</code>:</p>

<div class="wp_codebox"><table><tr id="p1137723"><td class="code" id="p113772code3"><pre class="swift" style="font-family:monospace;">  searchController.searchResultsUpdater <span style="color: #002200;">=</span> <span style="color: #a61390;">self</span><br>  searchController.dimsBackgroundDuringPresentation <span style="color: #002200;">=</span> <span style="color: #a61390;">false</span><br>  definesPresentationContext <span style="color: #002200;">=</span> <span style="color: #a61390;">true</span><br>  tableView.tableHeaderView <span style="color: #002200;">=</span> searchController.searchBar</pre></td></tr></table></div>

<p>Here&#8217;s a rundown of what you added:</p><br><ol><br><li><code>searchResultsUpdater</code> is a property on <code>UISearchController</code> that conforms to the new protocol <code>UISearchResultsUpdating</code>. This protocol allows your class to be informed as text changes within the <code>UISearchBar</code>. You&#8217;ll make the class conform to the protocol in a short while.</li><br><li>By default, <code>UISearchController</code> will dim the view it is presented over. This is useful if you are using another view controller for <code>searchResultsController</code>. In this instance, you have set the current view to show the results, so you do not want to dim your view.</li><br><li>By setting <code>definesPresentationContext</code> on your view controller to <code>true</code>, you ensure that the search bar does not remain on the screen if the user navigates to another view controller while the <code>UISearchController</code> is active.</li><br><li>Finally, you add the <code>searchBar</code> to your table view&#8217;s <code>tableHeaderView</code>. Remember that Interface Builder is not yet compatible with <code>UISearchController</code>, making this necessary.</li><br></ol><br><h3>UISearchResultsUpdating and Filtering</h3><br><p>After setting up the search controller, you’ll need to do some coding work to get it working. First, add the following property near the top of <code>MasterViewController</code>:</p>

<div class="wp_codebox"><table><tr id="p1137724"><td class="code" id="p113772code4"><pre class="swift" style="font-family:monospace;"><span style="color: #a61390;">var</span> filteredCandies <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>Candy<span style="color: #002200;">&#93;</span><span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span></pre></td></tr></table></div>

<p>This property will hold the candies that the user is searching for. Next, add the following helper method to the main <code>MasterViewController</code> class:</p>

<div class="wp_codebox"><table><tr id="p1137725"><td class="code" id="p113772code5"><pre class="swift" style="font-family:monospace;"><span style="color: #a61390;">func</span> filterContentForSearchText<span style="color: #002200;">&#40;</span>searchText<span style="color: #002200;">:</span> <span style="color: #a61390;">String</span>, scope<span style="color: #002200;">:</span> <span style="color: #a61390;">String</span> <span style="color: #002200;">=</span> <span style="color: #bf1d1a;">&quot;All&quot;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>  filteredCandies <span style="color: #002200;">=</span> candies.<span style="color: #a61390;">filter</span> <span style="color: #002200;">&#123;</span> candy <span style="color: #a61390;">in</span><br>    <span style="color: #a61390;">return</span> candy.name.lowercaseString.containsString<span style="color: #002200;">&#40;</span>searchText.lowercaseString<span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  tableView.reloadData<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br><span style="color: #002200;">&#125;</span></pre></td></tr></table></div>

<p>This filters the <code>candies</code> array based based on <code>searchText</code> and will put the results in the <code>filteredCandies</code> array you just added. Don&#8217;t worry about the <code>scope</code> parameter for now, you&#8217;ll use that in a later section of this tutorial.</p><br><p>To allow <code>MasterViewController</code> to respond to the search bar, it will have to implement <code>UISearchResultsUpdating</code>. Open <em>MasterViewController.swift</em> and add the following class extension, outside of the main <code>MasterViewController</code> class:</p>

<div class="wp_codebox"><table><tr id="p1137726"><td class="code" id="p113772code6"><pre class="swift" style="font-family:monospace;">extension MasterViewController<span style="color: #002200;">:</span> UISearchResultsUpdating <span style="color: #002200;">&#123;</span><br>  <span style="color: #a61390;">func</span> updateSearchResultsForSearchController<span style="color: #002200;">&#40;</span>searchController<span style="color: #002200;">:</span> UISearchController<span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    filterContentForSearchText<span style="color: #002200;">&#40;</span>searchController.searchBar.text<span style="color: #002200;">!</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br><span style="color: #002200;">&#125;</span></pre></td></tr></table></div>

<p>The <code>updateSearchResultsForSearchController(<em>:)</em></code> method is the one and only method that your class <i>must</i> implement to conform to the <code>UISearchResultsUpdating</code> protocol.</p><br><p>Now, whenever the user adds or removes text in the search bar, the <code>UISearchController</code> will inform the <code>MasterViewController</code> class of the change via this method. The method itself simply calls a helper method (which you&#8217;ll define soon) with the text currently in the search bar.</p><br><p><code>filter()</code> takes a closure of type <code>(candy: Candy) -&gt; Bool</code>. It then loops over all the elements of the array, and calls the closure, passing in the current element, for every one of the elements.</p><br><p>You can use this to determine whether a candy should be part of the search results that are presented to the user. To do so, you need to return <code>true</code> if the current candy is to be included in the filtered array, or <code>false</code> if not.</p><br><p>To determine this, <code>containsString(:)</code> is used to check to see if the name of the candy contains <code>searchText</code>. But before doing the comparison, you convert both strings to their lowercase equivalents using the <code>lowercaseString</code> method. </p><br><div class="note"><em>Note:</em> Most of the time, users don&#8217;t bother with the case of letters when performing a search so by only comparing the lowercase version of what they type with the lowercase version of the name of each candy you can easily return a case-insensitive &#8216;match&#8217;. Now, you can type &#8220;Chocolate&#8221; or &#8220;chocolate&#8221; and either will return a matching candy. How useful is that?! :]</div><br><p>Build and run the app now; you’ll notice that there is now a Search Bar above the table.</p><br><p>However, if you enter some search text you still don&#8217;t see any filtered results. What gives? This is simply because you haven’t yet written the code to let the table view know when to use the filtered results.</p><br><p>Back in <em>MasterViewController.swift</em>, replace <code>tableView(_:numberOfRowsInSection:)</code> with the following:</p>

<div class="wp_codebox"><table><tr id="p1137727"><td class="code" id="p113772code7"><pre class="swift" style="font-family:monospace;"><span style="color: #a61390;">override</span> <span style="color: #a61390;">func</span> tableView<span style="color: #002200;">&#40;</span>tableView<span style="color: #002200;">:</span> <span style="color: #400080;">UITableView</span>, numberOfRowsInSection section<span style="color: #002200;">:</span> <span style="color: #a61390;">Int</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">-</span>&gt; <span style="color: #a61390;">Int</span> <span style="color: #002200;">&#123;</span><br>  <span style="color: #a61390;">if</span> searchController.active <span style="color: #002200;">&amp;&amp;</span> searchController.searchBar.text <span style="color: #002200;">!=</span> <span style="color: #bf1d1a;">&quot;&quot;</span> <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">return</span> filteredCandies.<span style="color: #a61390;">count</span><br>  <span style="color: #002200;">&#125;</span><br>  <span style="color: #a61390;">return</span> candies.<span style="color: #a61390;">count</span><br><span style="color: #002200;">&#125;</span></pre></td></tr></table></div>

<p>Not much has changed here, you simply check whether the user is searching or not, and use either the filtered or normal candies as a data source for the table.</p><br><p>Next, replace <code>tableView(_:cellForRowAtIndexPath:)</code> with:</p>

<div class="wp_codebox"><table><tr id="p1137728"><td class="code" id="p113772code8"><pre class="swift" style="font-family:monospace;"><span style="color: #a61390;">override</span> <span style="color: #a61390;">func</span> tableView<span style="color: #002200;">&#40;</span>tableView<span style="color: #002200;">:</span> <span style="color: #400080;">UITableView</span>, cellForRowAtIndexPath indexPath<span style="color: #002200;">:</span> <span style="color: #400080;">NSIndexPath</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">-</span>&gt; <span style="color: #400080;">UITableViewCell</span> <span style="color: #002200;">&#123;</span><br>  <span style="color: #a61390;">let</span> cell <span style="color: #002200;">=</span> tableView.dequeueReusableCellWithIdentifier<span style="color: #002200;">&#40;</span><span style="color: #bf1d1a;">&quot;Cell&quot;</span>, forIndexPath<span style="color: #002200;">:</span> indexPath<span style="color: #002200;">&#41;</span><br>  <span style="color: #a61390;">let</span> candy<span style="color: #002200;">:</span> Candy<br>  <span style="color: #a61390;">if</span> searchController.active <span style="color: #002200;">&amp;&amp;</span> searchController.searchBar.text <span style="color: #002200;">!=</span> <span style="color: #bf1d1a;">&quot;&quot;</span> <span style="color: #002200;">&#123;</span><br>    candy <span style="color: #002200;">=</span> filteredCandies<span style="color: #002200;">&#91;</span>indexPath.row<span style="color: #002200;">&#93;</span><br>  <span style="color: #002200;">&#125;</span> <span style="color: #a61390;">else</span> <span style="color: #002200;">&#123;</span><br>    candy <span style="color: #002200;">=</span> candies<span style="color: #002200;">&#91;</span>indexPath.row<span style="color: #002200;">&#93;</span><br>  <span style="color: #002200;">&#125;</span><br>  cell.textLabel?.text <span style="color: #002200;">=</span> candy.name<br>  cell.detailTextLabel?.text <span style="color: #002200;">=</span> candy.category<br>  <span style="color: #a61390;">return</span> cell<br><span style="color: #002200;">&#125;</span></pre></td></tr></table></div>

<p>Both methods now refer to the <code>active</code> property of <code>searchController</code> to determine which array to display. </p><br><p>When the user clicks in the search field of the Search Bar, <code>active</code> will automatically be set to <code>true</code>. If the search controller is active, you then see if the user has actually typed something into the search field. If they have, the data returned is taken from the <code>filteredCandies</code> array. Otherwise, the data comes from the full list of items.</p><br><p>Recall that the search controller automatically handles showing and hiding the results table, so all your code has to do is provide the correct data (filtered or non-filtered) depending on the state of the controller and whether the user has searched for anything.</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2015/09/ragecomic.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2015/09/ragecomic.png" alt="ragecomic" width="651" height="481" class="aligncenter size-full wp-image-114198" srcset="https://cdn4.raywenderlich.com/wp-content/uploads/2015/09/ragecomic.png 651w, https://cdn4.raywenderlich.com/wp-content/uploads/2015/09/ragecomic-433x320.png 433w" sizes="(max-width: 651px) 100vw, 651px"></a></p><br><p>Build and run the app. You’ve got a functioning Search Bar that filters the rows of the main table. Huzzah! </p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2015/09/UISearchController-Filter.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2015/09/UISearchController-Filter-281x500.png" alt="UISearchController-Filter" width="281" height="500" class="aligncenter size-large wp-image-113864" srcset="https://cdn5.raywenderlich.com/wp-content/uploads/2015/09/UISearchController-Filter-281x500.png 281w, https://cdn5.raywenderlich.com/wp-content/uploads/2015/09/UISearchController-Filter-180x320.png 180w, https://cdn5.raywenderlich.com/wp-content/uploads/2015/09/UISearchController-Filter.png 750w" sizes="(max-width: 281px) 100vw, 281px"></a></p><br><p>Play with the app for a bit to see how you can search for various candies.</p><br><p>There&#8217;s still one more problem. When you select a row from the search results list, you may notice that the detail view shown can be of the wrong candy! Time to fix that.</p><br><h2>Sending Data to a Detail View</h2><br><p>When sending information to a detail view controller, you need to ensure that the view controller knows which context the user is working with: the full table list, or the search results. Still in <em>MasterViewController.swift</em>, in <code>prepareForSegue(_:sender:)</code>, find the following code:</p>

<div class="wp_codebox"><table><tr id="p1137729"><td class="code" id="p113772code9"><pre class="swift" style="font-family:monospace;"><span style="color: #a61390;">let</span> candy <span style="color: #002200;">=</span> candies<span style="color: #002200;">&#91;</span>indexPath.row<span style="color: #002200;">&#93;</span></pre></td></tr></table></div>

<p>Then replace it with the following:</p>

<div class="wp_codebox"><table><tr id="p11377210"><td class="code" id="p113772code10"><pre class="swift" style="font-family:monospace;"><span style="color: #a61390;">let</span> candy<span style="color: #002200;">:</span> Candy<br><span style="color: #a61390;">if</span> searchController.active <span style="color: #002200;">&amp;&amp;</span> searchController.searchBar.text <span style="color: #002200;">!=</span> <span style="color: #bf1d1a;">&quot;&quot;</span> <span style="color: #002200;">&#123;</span><br>  candy <span style="color: #002200;">=</span> filteredCandies<span style="color: #002200;">&#91;</span>indexPath.row<span style="color: #002200;">&#93;</span><br><span style="color: #002200;">&#125;</span> <span style="color: #a61390;">else</span> <span style="color: #002200;">&#123;</span><br>  candy <span style="color: #002200;">=</span> candies<span style="color: #002200;">&#91;</span>indexPath.row<span style="color: #002200;">&#93;</span><br><span style="color: #002200;">&#125;</span></pre></td></tr></table></div>

<p>Here you performed the same check that <code>tableView(<em>:numberOfRowsInSection:)</em></code> and <code>tableView(:cellForRowAtIndexPath:)</code> do, but now you&#8217;re providing the proper candy object when performing a segue to the detail view controller.</p><br><p>Build and run the code at this point and see how the app now navigates correctly to the Detail View from either the main table or the search table with ease.</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2015/09/CandySearch-DetailView.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2015/09/CandySearch-DetailView-281x500.png" alt="CandySearch-DetailView" width="281" height="500" class="aligncenter size-large wp-image-114436" srcset="https://cdn2.raywenderlich.com/wp-content/uploads/2015/09/CandySearch-DetailView-281x500.png 281w, https://cdn2.raywenderlich.com/wp-content/uploads/2015/09/CandySearch-DetailView-180x320.png 180w, https://cdn2.raywenderlich.com/wp-content/uploads/2015/09/CandySearch-DetailView.png 750w" sizes="(max-width: 281px) 100vw, 281px"></a></p><br><h2>Creating a Scope Bar to Filter Results</h2><br><p>If you wish to give your users another way to filter their results, you can add a <em>Scope Bar</em> in conjunction with your search bar in order to filter out items by their category. The categories you will filter on are the ones you assigned to the <code>Candy</code> object when you created the candies array: <em>Chocolate</em>, <em>Hard</em>, and <em>Other</em>.</p><br><p>First, you have to create a scope bar in <code>MasterViewController</code>. The scope bar is a segmented control that narrows down a search by only searching in certain scopes. A scope is really what you define it as. In this case it&#8217;s a candy&#8217;s category, but scopes could also be types, ranges, or something completely different.</p><br><p>Using the scope bar is as easy as implementing one additional delegate method.</p><br><p>In <em>MasterViewController.swift</em>, you&#8217;ll need to add another extension that conforms to <code>UISearchBarDelegate</code>. Add the following after your <code>UISearchResultsUpdating</code> extension:</p>

<div class="wp_codebox"><table><tr id="p11377211"><td class="code" id="p113772code11"><pre class="swift" style="font-family:monospace;">extension MasterViewController<span style="color: #002200;">:</span> <span style="color: #2a6f76;">UISearchBarDelegate</span> <span style="color: #002200;">&#123;</span><br>  <span style="color: #a61390;">func</span> searchBar<span style="color: #002200;">&#40;</span>searchBar<span style="color: #002200;">:</span> <span style="color: #400080;">UISearchBar</span>, selectedScopeButtonIndexDidChange selectedScope<span style="color: #002200;">:</span> <span style="color: #a61390;">Int</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    filterContentForSearchText<span style="color: #002200;">&#40;</span>searchBar.text<span style="color: #002200;">!</span>, scope<span style="color: #002200;">:</span> searchBar.scopeButtonTitles<span style="color: #002200;">!</span><span style="color: #002200;">&#91;</span>selectedScope<span style="color: #002200;">&#93;</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br><span style="color: #002200;">&#125;</span></pre></td></tr></table></div>

<p>This delegate methods gets called when the user switches the scope in the scope bar. When that happens, you want to redo the filtering, so you call <code>filterContentForSearchText(<em>:scope:)</em></code> with the new scope.</p><br><p>Now modify <code>filterContentForSearchText(:scope:)</code> to take the supplied scope into account:</p>

<div class="wp_codebox"><table><tr id="p11377212"><td class="code" id="p113772code12"><pre class="swift" style="font-family:monospace;"><span style="color: #a61390;">func</span> filterContentForSearchText<span style="color: #002200;">&#40;</span>searchText<span style="color: #002200;">:</span> <span style="color: #a61390;">String</span>, scope<span style="color: #002200;">:</span> <span style="color: #a61390;">String</span> <span style="color: #002200;">=</span> <span style="color: #bf1d1a;">&quot;All&quot;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>  filteredCandies <span style="color: #002200;">=</span> candies.<span style="color: #a61390;">filter</span> <span style="color: #002200;">&#123;</span> candy <span style="color: #a61390;">in</span><br>    <span style="color: #a61390;">let</span> categoryMatch <span style="color: #002200;">=</span> <span style="color: #002200;">&#40;</span>scope <span style="color: #002200;">==</span> <span style="color: #bf1d1a;">&quot;All&quot;</span><span style="color: #002200;">&#41;</span> || <span style="color: #002200;">&#40;</span>candy.category <span style="color: #002200;">==</span> scope<span style="color: #002200;">&#41;</span><br>    <span style="color: #a61390;">return</span>  categoryMatch <span style="color: #002200;">&amp;&amp;</span> candy.name.lowercaseString.containsString<span style="color: #002200;">&#40;</span>searchText.lowercaseString<span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  tableView.reloadData<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br><span style="color: #002200;">&#125;</span></pre></td></tr></table></div>

<p>This now checks to see if the scope provided is either set to &#8220;All&#8221; or it matches the category of the candy. Only when this is the case is the candy name tested to see if the candy should be added to the <code>filteredCandies</code>.</p><br><p>You&#8217;re almost there, but the scope filtering mechanism doesn&#8217;t quite work yet. You&#8217;ll need to modify <code>updateSearchResultsForSearchController(_:)</code> in the first class extension you created to send the currently selected scope:</p>

<div class="wp_codebox"><table><tr id="p11377213"><td class="code" id="p113772code13"><pre class="swift" style="font-family:monospace;"><span style="color: #a61390;">func</span> updateSearchResultsForSearchController<span style="color: #002200;">&#40;</span>searchController<span style="color: #002200;">:</span> UISearchController<span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>  <span style="color: #a61390;">let</span> searchBar <span style="color: #002200;">=</span> searchController.searchBar<br>  <span style="color: #a61390;">let</span> scope <span style="color: #002200;">=</span> searchBar.scopeButtonTitles<span style="color: #002200;">!</span><span style="color: #002200;">&#91;</span>searchBar.selectedScopeButtonIndex<span style="color: #002200;">&#93;</span><br>  filterContentForSearchText<span style="color: #002200;">&#40;</span>searchController.searchBar.text<span style="color: #002200;">!</span>, scope<span style="color: #002200;">:</span> scope<span style="color: #002200;">&#41;</span><br><span style="color: #002200;">&#125;</span></pre></td></tr></table></div>

<p>The only problem left is that the user doesn&#8217;t actually see a scope bar yet! To add the scope bar, navigate to <em>MasterViewController.swift</em>, after the search controller setup in <code>viewDidLoad()</code>, and add the following code:</p>

<div class="wp_codebox"><table><tr id="p11377214"><td class="code" id="p113772code14"><pre class="swift" style="font-family:monospace;">searchController.searchBar.scopeButtonTitles <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span><span style="color: #bf1d1a;">&quot;All&quot;</span>, <span style="color: #bf1d1a;">&quot;Chocolate&quot;</span>, <span style="color: #bf1d1a;">&quot;Hard&quot;</span>, <span style="color: #bf1d1a;">&quot;Other&quot;</span><span style="color: #002200;">&#93;</span><br>searchController.searchBar.delegate <span style="color: #002200;">=</span> <span style="color: #a61390;">self</span></pre></td></tr></table></div>

<p>This will add a scope bar to the search bar, with the titles that match the categories you assigned to your candy objects. You also include a catch-all category called <em>&#8220;All&#8221;</em> that you will use to ignore the candy category in the search altogether.</p><br><p>Now, when you type, the selected scope button will be used in conjunction with the search text.</p><br><p>Build and run your app. Try entering some search text, and changing the scope.</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2015/09/UISearchController-Filter-with-Scope.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2015/09/UISearchController-Filter-with-Scope-281x500.png" alt="UISearchController-Filter with Scope" width="281" height="500" class="aligncenter size-large wp-image-113863" srcset="https://cdn2.raywenderlich.com/wp-content/uploads/2015/09/UISearchController-Filter-with-Scope-281x500.png 281w, https://cdn2.raywenderlich.com/wp-content/uploads/2015/09/UISearchController-Filter-with-Scope-180x320.png 180w, https://cdn2.raywenderlich.com/wp-content/uploads/2015/09/UISearchController-Filter-with-Scope.png 750w" sizes="(max-width: 281px) 100vw, 281px"></a></p><br><p>Type in &#8220;caramel&#8221; with the scope set to All. It shows up in the list, but when you change the scope to Chocolate, &#8220;caramel&#8221; disappears because it&#8217;s not a chocolate.</p><br><h2>Where To Go From Here?</h2><br><p>Congratulations &#8211; you now have a working app that allows you to search directly from the main table view. Here is a <a href="http://www.raywenderlich.com/wp-content/uploads/2015/09/CandySearch.zip" target="_blank" rel="external">downloadable sample project</a> with all of the code from the above tutorial.</p><br><p>Table views are used in all kinds of apps, and offering a search option is a nice touch for usability. With <code>UISearchBar</code> and the <code>UISearchController</code>, iOS provides much of the functionality out of the box so there&#8217;s no excuse for not using it. The ability to search a large table view is something that today&#8217;s users expect; when they find it isn&#8217;t present, they won’t be happy campers.</p><br><div id="attachment_19061" style="width: 410px" class="wp-caption aligncenter"><img src="http://www.raywenderlich.com/wp-content/uploads/2012/07/nosearchfunction.jpg" alt="Don&#039;t let this happen to your users. Always give them a search option." width="400" height="361" class="size-full wp-image-19061" srcset="https://cdn2.raywenderlich.com/wp-content/uploads/2012/07/nosearchfunction.jpg 400w, https://cdn2.raywenderlich.com/wp-content/uploads/2012/07/nosearchfunction-250x225.jpg 250w, https://cdn2.raywenderlich.com/wp-content/uploads/2012/07/nosearchfunction-354x320.jpg 354w" sizes="(max-width: 400px) 100vw, 400px"><p class="wp-caption-text">Don&#8217;t let this happen to your users. Always give them a search option.</p></div><br><p>I hope to see you adding search capabilities to your table view apps in the future. If you have any questions or comments, please join the forum discussion below.</p>

</div>  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://yoursite.com/2016/09/14/UISearchController-使用指导/" data-title="UISearchController 使用指导 | 跳跳魔王的博客" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 

<div class="next">
<a href="/2016/09/08/项目结束后的一些思考/"  title="项目结束后的一些思考">
 <strong>下一篇：</strong><br/> 
 <span>项目结束后的一些思考
</span>
</a>
</div>

</nav>

	

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">Contents</strong>
 
 <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">1.</span> <span class="toc-text">Getting Started</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">2.</span> <span class="toc-text">Populating the Table View</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">3.</span> <span class="toc-text">Introducing UISearchController</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">3.1.</span> <span class="toc-text">UISearchResultsUpdating and Filtering</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">4.</span> <span class="toc-text">Sending Data to a Detail View</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">5.</span> <span class="toc-text">Creating a Scope Bar to Filter Results</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">6.</span> <span class="toc-text">Where To Go From Here?</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  


  

  

  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">Weibo</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=null&verifier=b3593ceb&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> 大家好,我是熙健的iOS工程师. <br/>
			这是我的博客,努力奋斗.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/2176287895" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2016 
		
		<a href="/about" target="_blank" title="跳跳魔王">跳跳魔王</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>









<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
