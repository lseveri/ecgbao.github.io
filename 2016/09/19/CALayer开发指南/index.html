
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>CALayer开发指南 | 跳跳魔王的博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="跳跳魔王">
    

    
    <meta name="description" content="也许你知道, 你在iOS程序上看到的一切都是视图。 有按钮视图, 列表视图, 滑块视图, 甚至是包含其他视图的父视图。不过你可能不知道,每个视图都由一个叫做图层的类支持 – 一个特定的 CALayer 。 通过这篇文章, 你会了解 CALayer 是什么, 如何工作的。 你还会看到10个用 CALayers 实现的炫酷效果, 比如几何图形, 渐变, 甚至是粒子系统。这篇文章假设你会用Swift开发">
<meta property="og:type" content="article">
<meta property="og:title" content="CALayer开发指南">
<meta property="og:url" content="http://yoursite.com/2016/09/19/CALayer开发指南/index.html">
<meta property="og:site_name" content="跳跳魔王的博客">
<meta property="og:description" content="也许你知道, 你在iOS程序上看到的一切都是视图。 有按钮视图, 列表视图, 滑块视图, 甚至是包含其他视图的父视图。不过你可能不知道,每个视图都由一个叫做图层的类支持 – 一个特定的 CALayer 。 通过这篇文章, 你会了解 CALayer 是什么, 如何工作的。 你还会看到10个用 CALayers 实现的炫酷效果, 比如几何图形, 渐变, 甚至是粒子系统。这篇文章假设你会用Swift开发">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/LayersScreenshot-316x320.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/Xcode-CreateOutlet-700x215.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CALayerPlayground-1-179x320.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CALayerPlayground-2-179x320.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/Xcode-AddTapGestureRecognizer-700x478.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/Xcode-CreateAction-700x253.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CALayerPlayground-3-179x320.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2015/01/CaLayerTour-e1421621716326.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CALayerTourScenes-700x415.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CALayer-250x250.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CALayer_5.5-180x320.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAScrollLayer.gif">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer-250x250.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer-MiddleTruncation.png.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer-StartTruncation.png.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer-EndTruncation.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer_5.5-180x320.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/AVPlayerItem.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/AVLayerPlayer_5.5-180x320.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/AxialGradientLayerType.gif">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAGradientLayer-250x250.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAGradientLayer_5.5-180x320.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAReplicatorLayer.gif">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAReplicatorLayer_5.5-180x320.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayer-250x250.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayer_5.5-180x320.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayerZoomedBlurry-250x250.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayerZoomed-250x250.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/windingRoad-480x300.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/XcodeTilingViewForImageStoryboard-480x286.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATiledImageLayer.gif">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAShapeLayerFillRules-480x256.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/RayWenderlichLogo-250x250.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/PaintCodeRayWenderlichLogo-480x265.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAShapeLayer_5.5-180x320.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATransformLayer-250x250.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATransformLayer_5.5-180x320.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAEmitterLayer2.gif">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAEmitterLayer_5.5-180x320.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/victorious-e1419192669236.png">
<meta property="og:updated_time" content="2016-10-24T09:51:38.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CALayer开发指南">
<meta name="twitter:description" content="也许你知道, 你在iOS程序上看到的一切都是视图。 有按钮视图, 列表视图, 滑块视图, 甚至是包含其他视图的父视图。不过你可能不知道,每个视图都由一个叫做图层的类支持 – 一个特定的 CALayer 。 通过这篇文章, 你会了解 CALayer 是什么, 如何工作的。 你还会看到10个用 CALayers 实现的炫酷效果, 比如几何图形, 渐变, 甚至是粒子系统。这篇文章假设你会用Swift开发">
<meta name="twitter:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/LayersScreenshot-316x320.png">

    
    <link rel="alternative" href="/atom.xml" title="跳跳魔王的博客" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="跳跳魔王的博客">跳跳魔王的博客</a></h1>
				<h2 class="blog-motto">每天进步一点点</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页</a></li>
					
						<li><a href="/archives">归档</a></li>
					
						<li><a href="/about">关于</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/09/19/CALayer开发指南/" title="CALayer开发指南" itemprop="url">CALayer开发指南</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="跳跳魔王" target="_blank" itemprop="author">跳跳魔王</a>
		
  <p class="article-time">
    <time datetime="2016-09-19T07:16:18.000Z" itemprop="datePublished"> 发表于 2016-09-19</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">1.</span> <span class="toc-text">开始</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">2.</span> <span class="toc-text">基本的 CALayer 属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">3.</span> <span class="toc-text">改变图层的外观</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">4.</span> <span class="toc-text">伟大的 CALayer 之旅</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">5.</span> <span class="toc-text">示例1: CALayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">6.</span> <span class="toc-text">示例2: CAScrollLayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">7.</span> <span class="toc-text">示例3: CATextLayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">8.</span> <span class="toc-text">示例4: AVPlayerLayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">9.</span> <span class="toc-text">示例5: CAGradientLayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">10.</span> <span class="toc-text">示例6: CAReplicatorLayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">11.</span> <span class="toc-text">示例7: CATiledLayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">12.</span> <span class="toc-text">示例8: CAShapeLayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">13.</span> <span class="toc-text">示例9: CATransformLayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">14.</span> <span class="toc-text">示例10: CAEmitterLayer</span></a></li></ol>
		
		</div>
		
		<html lang="en-US" class="no-js windows"><br><br><link rel="stylesheet" id="wpsqt-main-css" href="https://cdn3.raywenderlich.com/wp-content/plugins/wp-survey-and-quiz-tool/css/main.css?ver=4.5.2" type="text/css" media="all"><br><link rel="stylesheet" id="style-main-css" href="https://cdn4.raywenderlich.com/wp-content/themes/raywenderlich/style.min.css?ver=1471520796" type="text/css" media="all"><br><br><div id="attachment_114189" style="width: 260px" class="wp-caption alignright"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/LayersScreenshot-316x320.png" width="316" height="320" class="alignright size-medium wp-image-91873" srcset="https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/LayersScreenshot-316x320.png 316w, https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/LayersScreenshot-494x500.png 494w, https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/LayersScreenshot-32x32.png 32w, https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/LayersScreenshot-64x64.png 64w, https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/LayersScreenshot-96x96.png 96w, https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/LayersScreenshot.png 608w" sizes="(max-width: 316px) 100vw, 316px"></div><br><br><p>也许你知道, 你在iOS程序上看到的一切都是视图。 有按钮视图, 列表视图, 滑块视图, 甚至是包含其他视图的父视图。</p><br><p>不过你可能不知道,每个视图都由一个叫做图层的类支持 – 一个特定的 CALayer 。 </p><br><p>通过这篇文章, 你会了解 CALayer 是什么, 如何工作的。 你还会看到10个用 CALayers 实现的炫酷效果, 比如几何图形, 渐变, 甚至是粒子系统。</p><br><p>这篇文章假设你会用Swift开发iOS应用程序, 包括用故事板构造界面。 </p><br><br><h2>开始</h2><br><p>理解图层到底是什么的最容易的方法就是看他们怎么运行。 所以让我们从头创建一个简单的工程来玩转图层。</p><br><p>准备好写代码了吗? 不错! 启动 Xcode 并且:</p><br><ol><br><li>从菜单选择 <em>File\New\Project&#8230;</em> . </li><br><li>从对话框中选择 <em>iOS\Application\Single View Application</em> . </li><br><li>点击 <em>Next</em>, 输入 <em>CALayerPlayground</em> 作为产品名,输入机构名和标识符。 </li><br><li>选择 <em>Swift</em>作为开发语言同时选择  <em>Universal</em> . </li><br><li>不要选中 <em>Core Data</em> , 然后点击 <em>Next</em>. </li><br><li>给你的工程找个好位置 (我把工程放在一个叫 Source 的用户文件夹), 然后点击 <em>Create</em>.</li><br><p>好了, 现在文件创建好了,下一步是创建一个视图:</p><br><li>在 Project navigator, 选择 <em>Main.storyboard</em>. </li><br><li>从菜单中选择 <em>View\Assistant Editor\Show Assistant Editor</em> , 如果没有显示出来就选择 <em>View\Utilities\Show Object Library</em> . </li><br><li>也可以选择 <em>Editor\Canvas\Show Bounds Rectangles</em>, 这样你会看到将要加入scene的视图边界轮廓。 </li><br><li>从 Object library 中, 拖一个视图到 View Controller Scene. 选中它, 去 Size inspector (<em>View\Utilities\Show Size Inspector</em>)设置 <em>x</em> 和 <em>y</em> 为 <em>150</em> , <em>width</em> 和 <em>height</em> 为 <em>300</em>. </li><br><li>保持视图选中, 点击自动布局工具条上的 <em>Align</em> 按钮 (故事板右下方) 选中 <em>Horizontal Center in Container</em> 和 <em>Vertical Center in Container</em>, 两个值都设为 <em>0</em>, 然后点击 <em>Add 2 Constraints</em>. </li><br><li>点击 <em>Pin</em> 按钮, 选中 <em>Width</em> 和 <em>Height</em>, 确保两个值都设成 <em>300</em>, 点击 <em>Add 2 Constraints</em>.</li><br></ol><br><p>最后, 按住control拖住在 <em>ViewController.swift</em> 创建的视图, 拖到 <code>viewDidLoad()</code> 方法上面。 弹出提示给出的outlet 名字是 <em>viewForLayer</em>. 你的 Xcode 看起来是这样:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/Xcode-CreateOutlet.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/Xcode-CreateOutlet-700x215.png" alt="Xcode-CreateOutlet" width="700" height="215" class="aligncenter size-large wp-image-90649" srcset="https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/Xcode-CreateOutlet-700x215.png 700w, https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/Xcode-CreateOutlet-480x147.png 480w, https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/Xcode-CreateOutlet.png 1404w" sizes="(max-width: 700px) 100vw, 700px"></a></p><br><p>点击 <em>Connect</em> 创建 outlet. </p><br><p>用下面的代码替换 <em>ViewController.swift</em> 的内容:</p><br><br><div class="wp_codebox"><table><tr id="p904881"><td class="code" id="p90488code1"><pre class="swift" style="font-family:monospace;"><span style="color: #a61390;">import</span> UIKit<br>&nbsp;<br><span style="color: #a61390;">class</span> ViewController<span style="color: #002200;">:</span> <span style="color: #400080;">UIViewController</span> <span style="color: #002200;">&#123;</span><br>&nbsp;<br>  @IBOutlet weak <span style="color: #a61390;">var</span> viewForLayer<span style="color: #002200;">:</span> <span style="color: #400080;">UIView</span><span style="color: #002200;">!</span><br>&nbsp;<br>  <span style="color: #a61390;">var</span> l<span style="color: #002200;">:</span> <span style="color: #400080;">CALayer</span> <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">return</span> viewForLayer.layer<br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #a61390;">override</span> <span style="color: #a61390;">func</span> viewDidLoad<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">super</span>.viewDidLoad<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>    setUpLayer<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #a61390;">func</span> setUpLayer<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    l.backgroundColor <span style="color: #002200;">=</span> <span style="color: #400080;">UIColor</span>.blueColor<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span>.<span style="color: #400080;">CGColor</span><br>    l.borderWidth <span style="color: #002200;">=</span> <span style="color: #2400d9;">100.0</span><br>    l.borderColor <span style="color: #002200;">=</span> <span style="color: #400080;">UIColor</span>.redColor<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span>.<span style="color: #400080;">CGColor</span><br>    l.shadowOpacity <span style="color: #002200;">=</span> <span style="color: #2400d9;">0.7</span><br>    l.shadowRadius <span style="color: #002200;">=</span> <span style="color: #2400d9;">10.0</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br><span style="color: #002200;">&#125;</span></pre></td></tr></table></div><br><br><p>正如前面提到的, 每个视图都有一个图层, 你可以用 <code>yourView.layer</code> 获取这个图层。 这个代码首先做的是创建一个计算属性”l” (小写的 L) 来访问 <code>viewForLayer</code> 的图层, 这个可以节省你写后续代码的敲击。 </p><br><p> <code>setUpLayer</code> 负责给图层设置一些属性; 阴影, 蓝色的背景, 红色大边框。 稍后你会了解更多 <code>setUpLayer()</code> , 不过先编译运行模拟器来查看你的自定义图层 (我选的是 <em>iPhone 6</em>) :</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/CALayerPlayground-1.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CALayerPlayground-1-179x320.png" alt="CALayerPlayground-1" width="179" height="320" class="aligncenter size-medium wp-image-90653 bordered" srcset="https://cdn3.raywenderlich.com/wp-content/uploads/2014/12/CALayerPlayground-1-179x320.png 179w, https://cdn3.raywenderlich.com/wp-content/uploads/2014/12/CALayerPlayground-1-281x500.png 281w" sizes="(max-width: 179px) 100vw, 179px"></a></p><br><p>几行代码的效果很酷吧,  因为每个视图背后都有图层, 你可以在程序 <i>任意</i> 视图中做这些。 我们来仔细看一下。</p><br><h2>基本的 CALayer 属性</h2><br><p>CALayer 有几个属让你可以自定义它的外观。 回想一下你前面做过的:</p><br><ul><br><li>背景色从无到蓝色<br></li><li>把边框宽度从0改成100<br></li><li>把边框色从黑色变成红色<br></li><li>最后, 改变阴影透明度的值到0.7; 这会产生阴影效果, 你可以进一步把它的阴影半径从3改成10。</li><br></ul><br><p>CALayer 仅有几个属性可以设置。 我们再试两个。 在<code>setUpLayer()</code> 下添加下面几行代码:</p><br><br><div class="wp_codebox"><table><tr id="p904882"><td class="code" id="p90488code2"><pre class="swift" style="font-family:monospace;">l.contents <span style="color: #002200;">=</span> <span style="color: #400080;">UIImage</span><span style="color: #002200;">&#40;</span>named<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">&quot;star&quot;</span><span style="color: #002200;">&#41;</span>?.CGImage<br>l.contentsGravity <span style="color: #002200;">=</span> kCAGravityCenter</pre></td></tr></table></div><br><br><p> <code>contents</code> 属性允许你给图层内容设置图片, 所以这里你给它设了图片叫 &#8220;star&#8221;. 对于这个工作, 你要先把图片加到你的工程里,  <a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/star.png" title="Star image" download="star.png" target="_blank" rel="external">下载我做的星星图片</a> 然后添加到你的工程里。</p><br><p>编译运行程序, 欣赏一会这件艺术品: </p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/CALayerPlayground-2.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CALayerPlayground-2-179x320.png" alt="CALayerPlayground-2" width="179" height="320" class="aligncenter size-medium wp-image-90655 bordered" srcset="https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CALayerPlayground-2-179x320.png 179w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CALayerPlayground-2-281x500.png 281w" sizes="(max-width: 179px) 100vw, 179px"></a></p><br><p>注意星星是如何居中的 &#8211; 这是你因为把 <code>contentsGravity</code> 属性设置成了 <code>kCAGravityCenter</code>. 如你所愿, 你可以改变它的重心为上, 右上, 右, 右下, 下,左下, 左和左上。 </p><br><h2>改变图层的外观</h2><br><p>仅仅为了好玩, 我们添加一些手势来操作图层的外观。 在 Xcode 里, 拖一个点击手势到 <code>viewForLayer</code> . 仅供参考, 添加点击手势应该是这个样子的:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/Xcode-AddTapGestureRecognizer.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/Xcode-AddTapGestureRecognizer-700x478.png" alt="Xcode-AddTapGestureRecognizer" width="700" height="478" class="aligncenter size-large wp-image-90656" srcset="https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/Xcode-AddTapGestureRecognizer-700x478.png 700w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/Xcode-AddTapGestureRecognizer-468x320.png 468w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/Xcode-AddTapGestureRecognizer.png 1109w" sizes="(max-width: 700px) 100vw, 700px"></a></p><br><div class="note"><br><p><em>备注</em>: 如果你不熟悉手势, 可以查看 <a href="http://www.raywenderlich.com/76020/using-uigesturerecognizer-with-swift-tutorial" title="Using UIGestureRecognizer with Swift" target="_blank" rel="external"> Using UIGestureRecognizer with Swift</a>. </p><br></div><br><p>重复步骤添加一个捏合手势到 <code>viewForLayer</code> .</p><br><p>然后按住 control拖动每个手势到<em>ViewController.swift</em>, 一个接着一个, 把它们放<code>setUpLayer()</code> 和类的大括号之间。 </p><br><p>在弹出框里, 把连接按钮改成 <em>Action</em> 命名点击手势名为 <code>tapGestureRecognized</code> , 捏合手势名为 <code>pinchGestureRecognized</code>. 例如:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/Xcode-CreateAction.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/Xcode-CreateAction-700x253.png" alt="Xcode-CreateAction" width="700" height="253" class="aligncenter size-large wp-image-90658" srcset="https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/Xcode-CreateAction-700x253.png 700w, https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/Xcode-CreateAction-480x173.png 480w, https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/Xcode-CreateAction.png 1102w" sizes="(max-width: 700px) 100vw, 700px"></a></p><br><p>修改 <code>tapGestureRecognized(_:)</code> 像这样:</p><br><br><div class="wp_codebox"><table><tr id="p904883"><td class="code" id="p90488code3"><pre class="swift" style="font-family:monospace;">@IBAction <span style="color: #a61390;">func</span> tapGestureRecognized<span style="color: #002200;">&#40;</span>sender<span style="color: #002200;">:</span> <span style="color: #400080;">UITapGestureRecognizer</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>  l.shadowOpacity <span style="color: #002200;">=</span> l.shadowOpacity <span style="color: #002200;">==</span> <span style="color: #2400d9;">0.7</span> ? <span style="color: #2400d9;">0.0</span> <span style="color: #002200;">:</span> <span style="color: #2400d9;">0.7</span><br><span style="color: #002200;">&#125;</span></pre></td></tr></table></div><br><br><p>这是告诉 <code>viewForLayer</code> 点击时在0.7和0的阴影不透明度之间切换图层的阴影。 </p><br><p>你说的这个视图? 重写 CALayer&#8217;的 <code>hitTest(<em>:)</em></code> 方法也可以实现, 实际上在文章的后面你会看到这个方法。 不过这里是上面方法的逻辑:  hit testing 是图层唯一可以做的, 因为它不响应手势。 这就是为什么你要在视图上添加手势T。 </p><br><p>现在修改 <code>pinchGestureRecognized(:)</code> 像这样:</p><br><br><div class="wp_codebox"><table><tr id="p904884"><td class="code" id="p90488code4"><pre class="swift" style="font-family:monospace;">@IBAction <span style="color: #a61390;">func</span> pinchGestureRecognized<span style="color: #002200;">&#40;</span>sender<span style="color: #002200;">:</span> UIPinchGestureRecognizer<span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>  <span style="color: #a61390;">let</span> offset<span style="color: #002200;">:</span> <span style="color: #400080;">CGFloat</span> <span style="color: #002200;">=</span> sender.scale &lt; <span style="color: #2400d9;">1</span> ? <span style="color: #2400d9;">5.0</span> <span style="color: #002200;">:</span> <span style="color: #002200;">-</span><span style="color: #2400d9;">5.0</span><br>  <span style="color: #a61390;">let</span> oldFrame <span style="color: #002200;">=</span> l.frame<br>  <span style="color: #a61390;">let</span> oldOrigin <span style="color: #002200;">=</span> oldFrame.origin<br>  <span style="color: #a61390;">let</span> newOrigin <span style="color: #002200;">=</span> <span style="color: #400080;">CGPoint</span><span style="color: #002200;">&#40;</span>x<span style="color: #002200;">:</span> oldOrigin.x <span style="color: #002200;">+</span> offset, y<span style="color: #002200;">:</span> oldOrigin.y <span style="color: #002200;">+</span> offset<span style="color: #002200;">&#41;</span><br>  <span style="color: #a61390;">let</span> newSize <span style="color: #002200;">=</span> <span style="color: #400080;">CGSize</span><span style="color: #002200;">&#40;</span>width<span style="color: #002200;">:</span> oldFrame.width <span style="color: #002200;">+</span> <span style="color: #002200;">&#40;</span>offset <span style="color: #002200;"><em></em></span> <span style="color: #002200;">-</span><span style="color: #2400d9;">2.0</span><span style="color: #002200;">&#41;</span>, height<span style="color: #002200;">:</span> oldFrame.height <span style="color: #002200;">+</span> <span style="color: #002200;">&#40;</span>offset <span style="color: #002200;"></span> <span style="color: #002200;">-</span><span style="color: #2400d9;">2.0</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #a61390;">let</span> newFrame <span style="color: #002200;">=</span> <span style="color: #400080;">CGRect</span><span style="color: #002200;">&#40;</span>origin<span style="color: #002200;">:</span> newOrigin, size<span style="color: #002200;">:</span> newSize<span style="color: #002200;">&#41;</span><br>  <span style="color: #a61390;">if</span> newFrame.width &gt;<span style="color: #002200;">=</span> <span style="color: #2400d9;">100.0</span> <span style="color: #002200;">&amp;&amp;</span> newFrame.width &lt;<span style="color: #002200;">=</span> <span style="color: #2400d9;">300.0</span> <span style="color: #002200;">&#123;</span><br>    l.borderWidth <span style="color: #002200;">-=</span> offset<br>    l.cornerRadius <span style="color: #002200;">+=</span> <span style="color: #002200;">&#40;</span>offset <span style="color: #002200;">/</span> <span style="color: #2400d9;">2.0</span><span style="color: #002200;">&#41;</span><br>    l.frame <span style="color: #002200;">=</span> newFrame<br>  <span style="color: #002200;">&#125;</span><br><span style="color: #002200;">&#125;</span></pre></td></tr></table></div><br><br><p>你在这里基于用户捏合创建了正负偏移量, 然后调整图层区域的尺寸,边框的宽度和圆角半径。 </p><br><p>图层的圆角半径默认为0, 是个90度圆角的标准矩形。 增加半径创建圆角。 想把正方形变成圆吗? 把圆角半径设置为宽度的一半就可以了。 </p><br><p>注意,调整圆角半径并不会裁剪图层的内容 (星星图片) 除非图层的 <code>masksToBounds</code> 属性设置成 <code>true</code>.</p><br><p>编译运行, 试着单击和捏合视图:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/CALayerPlayground-3.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CALayerPlayground-3-179x320.png" alt="CALayerPlayground-3" width="179" height="320" class="aligncenter size-medium wp-image-90661 bordered" srcset="https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CALayerPlayground-3-179x320.png 179w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CALayerPlayground-3-281x500.png 281w" sizes="(max-width: 179px) 100vw, 179px"></a></p><br><p>嗨, 慢慢打磨,你可以成为一个不错的头像制造商! :]</p><br><h2>伟大的 CALayer 之旅</h2><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2015/01/CaLayerTour-e1421621716326.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2015/01/CaLayerTour-e1421621716326.png" alt="CaLayerTour" width="441" height="423" class="aligncenter size-full wp-image-93973" srcset="https://cdn4.raywenderlich.com/wp-content/uploads/2015/01/CaLayerTour-e1421621716326.png 441w, https://cdn4.raywenderlich.com/wp-content/uploads/2015/01/CaLayerTour-e1421621716326-334x320.png 334w, https://cdn4.raywenderlich.com/wp-content/uploads/2015/01/CaLayerTour-e1421621716326-32x32.png 32w" sizes="(max-width: 441px) 100vw, 441px"></a> </p><br><p>CALayer 已经多了一些属性和方法, 以及一些拥有特定属性和方法的子类。 </p><br><p>对于剩下的文章, 你会需要下面的:</p><br><ul><br><li><a href="http://bit.ly/AppStoreLayerPlayer" title="Layer Player on App Store" target="_blank">The Layer Player App</a></li><br><li><a href="http://bit.ly/LayerPlayer" title="Layer Player at GitHub" target="_blank">The Layer Player Source Code</a></li><br></ul><br><p>这个程序包含10种不同 CALayers 的示例, 这些示例你会在文章里学到。 这是10个示例的预览:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/CALayerTourScenes.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CALayerTourScenes-700x415.png" alt="CALayerTourScenes" width="700" height="415" class="aligncenter size-large wp-image-92164 bordered" srcset="https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/CALayerTourScenes-700x415.png 700w, https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/CALayerTourScenes-480x284.png 480w" sizes="(max-width: 700px) 100vw, 700px"></a></p><br><p>通过下面的例子, 我建议你在 CALayer 程序中玩玩,选择性的看一些源码。 剩余的文章你不需要编码, 坐下来阅读吧 :]</p><br><p>这里有一些很棒的示例你可以添加不同类型 CALayers 到你的工程。 希望你喜欢!</p><br><h2>示例1: CALayer</h2><br><p>你已经看过一个使用 CALayer 的示例, 并且设置了一些属性。 </p><br><p>这里有一些关于 CALayers 的事我还没有提及:</p><br><ul><br><li><em>图层可以有子图层</em>. 就像视图有子视图, 图层也有子图层。 你可以用这个实现一些炫酷的效果!</li><br><li><em>图层属性是动画的</em>. 当你改变一个图层的属性时, 默认它会随着时间产生动画。 你也可以按照自己的时机定制动画。</li><br><li><em>图层是轻量级的</em>. 图层比视图轻量级, 因此它们可以帮你实现更好的效果。</li><br><li><em>图层有很多有用的属性.</em> 你已经看到一些了, 不过让我们再看一些!</li><br></ul><br><p>如你早前看到的, 图层有很多有用的属性。 让我浏览完整的 CALayer 属性列表 &#8211; 一些你没有看过的但是很便捷的!</p><br><br><div class="wp_codebox"><table><tr id="p904885"><td class="code" id="p90488code5"><pre class="swift" style="font-family:monospace;"><span style="color: #11740a; font-style: italic;">// 1</span><br><span style="color: #a61390;">let</span> layer <span style="color: #002200;">=</span> <span style="color: #400080;">CALayer</span><span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>layer.frame <span style="color: #002200;">=</span> someView.bounds<br>&nbsp;<br><span style="color: #11740a; font-style: italic;">// 2</span><br>layer.contents <span style="color: #002200;">=</span> <span style="color: #400080;">UIImage</span><span style="color: #002200;">&#40;</span>named<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">&quot;star&quot;</span><span style="color: #002200;">&#41;</span>?.CGImage<br>layer.contentsGravity <span style="color: #002200;">=</span> kCAGravityCenter<br>&nbsp;<br><span style="color: #11740a; font-style: italic;">// 3</span><br>layer.magnificationFilter <span style="color: #002200;">=</span> kCAFilterLinear<br>layer.geometryFlipped <span style="color: #002200;">=</span> <span style="color: #a61390;">false</span><br>&nbsp;<br><span style="color: #11740a; font-style: italic;">// 4</span><br>layer.backgroundColor <span style="color: #002200;">=</span> <span style="color: #400080;">UIColor</span><span style="color: #002200;">&#40;</span>red<span style="color: #002200;">:</span> <span style="color: #2400d9;">11</span><span style="color: #002200;">/</span><span style="color: #2400d9;">255.0</span>, green<span style="color: #002200;">:</span> <span style="color: #2400d9;">86</span><span style="color: #002200;">/</span><span style="color: #2400d9;">255.0</span>, blue<span style="color: #002200;">:</span> <span style="color: #2400d9;">14</span><span style="color: #002200;">/</span><span style="color: #2400d9;">255.0</span>, alpha<span style="color: #002200;">:</span> <span style="color: #2400d9;">1.0</span><span style="color: #002200;">&#41;</span>.<span style="color: #400080;">CGColor</span><br>layer.opacity <span style="color: #002200;">=</span> <span style="color: #2400d9;">1.0</span><br>layer.hidden <span style="color: #002200;">=</span> <span style="color: #a61390;">false</span><br>layer.masksToBounds <span style="color: #002200;">=</span> <span style="color: #a61390;">false</span><br>&nbsp;<br><span style="color: #11740a; font-style: italic;">// 5</span><br>layer.cornerRadius <span style="color: #002200;">=</span> <span style="color: #2400d9;">100.0</span><br>layer.borderWidth <span style="color: #002200;">=</span> <span style="color: #2400d9;">12.0</span><br>layer.borderColor <span style="color: #002200;">=</span> <span style="color: #400080;">UIColor</span>.whiteColor<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span>.<span style="color: #400080;">CGColor</span><br>&nbsp;<br><span style="color: #11740a; font-style: italic;">// 6</span><br>layer.shadowOpacity <span style="color: #002200;">=</span> <span style="color: #2400d9;">0.75</span><br>layer.shadowOffset <span style="color: #002200;">=</span> <span style="color: #400080;">CGSize</span><span style="color: #002200;">&#40;</span>width<span style="color: #002200;">:</span> <span style="color: #2400d9;">0</span>, height<span style="color: #002200;">:</span> <span style="color: #2400d9;">3</span><span style="color: #002200;">&#41;</span><br>layer.shadowRadius <span style="color: #002200;">=</span> <span style="color: #2400d9;">3.0</span><br>someView.layer.addSublayer<span style="color: #002200;">&#40;</span>layer<span style="color: #002200;">&#41;</span></pre></td></tr></table></div><br><br><p>在上面的代码里:</p><br><ol><br><li>创建一个 CALayer 实例并把他设置成 <code>someView</code> 的边界.</li><br><li>给图层设置一张图片作为内容并居中。 注意用下面的图片数据  (<code>CGImage</code>) 赋值. </li><br><li>通过<code>contentsGravity</code>放大图片时使用过滤器, 可以同时改变大小 (resize, resize aspect, and resize aspect fill) 和 位置 (center, top, top-right, right, etc.). </li><br><p>前面的变化没有动画效果, 如果 <code>geometryFlipped</code> 没有设置成 <code>true</code>, 几何位置和阴影会是颠倒的。继续: </p><br><li>你设置了背景色是蕾最喜欢的绿色阴影 :] 并且让图层变的不透明可见。 同时, 你让视图不要遮挡它的内容, 意思是如果它的尺寸小于它的内容 (星星图), 图片不会被裁剪。 </li><br><li>图层的圆角半径设成宽度的一半可以创造圆形边框的视觉效果; 注意图层颜色用 Quartz 颜色赋值 (<code>CGColor</code>).</li><br><li>创建阴影同时设置 <code>shouldRasterize</code> 为 <code>true</code> (下面讨论), 然后把图层添加到视图结构。</li><br></ol><br><p>这是运行结果:</p><br><p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CALayer-250x250.png" alt="CALayer" width="250" height="250" class="aligncenter size-thumbnail wp-image-90712" srcset="https://cdn3.raywenderlich.com/wp-content/uploads/2014/12/CALayer-250x250.png 250w, https://cdn3.raywenderlich.com/wp-content/uploads/2014/12/CALayer-320x320.png 320w, https://cdn3.raywenderlich.com/wp-content/uploads/2014/12/CALayer-500x500.png 500w, https://cdn3.raywenderlich.com/wp-content/uploads/2014/12/CALayer-32x32.png 32w, https://cdn3.raywenderlich.com/wp-content/uploads/2014/12/CALayer-64x64.png 64w, https://cdn3.raywenderlich.com/wp-content/uploads/2014/12/CALayer-96x96.png 96w, https://cdn3.raywenderlich.com/wp-content/uploads/2014/12/CALayer-128x128.png 128w, https://cdn3.raywenderlich.com/wp-content/uploads/2014/12/CALayer.png 800w" sizes="(max-width: 250px) 100vw, 250px"></p><br><p>CALayer 有两个额外的属性可以提高性能: <code>shouldRasterize</code> 和 <code>drawsAsynchronously</code>. </p><br><p><code>shouldRasterize</code> 默认是 <code>false</code> , 当被设置成 <code>true</code> 它可以提升性能高, 因为图层内容只需要渲染一次就够了。 对于在屏幕上展示动画而又不需要改变外观的对象来说这是完美的。 </p><br><p><code>drawsAsynchronously</code> 是 <code>shouldRasterize</code> 相反的一种属性。 它的值默认也是 <code>false</code> . 把它设置成 <code>true</code> ,在内容必须重复绘制时能提升性能, 比如当你使用发射器图层不断渲染动画颗粒的时候。) </p><br><div class="note"><br><p><em>一个警告</em>: 把图层的 <code>shouldRasterize</code> 或者 <code>drawsAsynchronously</code> 值设置成true 之前要考虑清楚它的影响。 比较值为真假时候的性能,这样你会明白是否需要开启这些特性去提升性能。 如果滥用, 性能可能会急剧下降。<br></p></div><br><p>现在暂时转移注意力到 Layer Player. 它包含可以操作CALayer 属性的很多控件:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/CALayer_5.5.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CALayer_5.5-180x320.png" alt="CALayer_5.5" width="180" height="320" class="aligncenter size-medium wp-image-91212 bordered" srcset="https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/CALayer_5.5-180x320.png 180w, https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/CALayer_5.5-281x500.png 281w, https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/CALayer_5.5.png 1242w" sizes="(max-width: 180px) 100vw, 180px"></a></p><br><p>玩玩这些控件; 这是感受 CALayer 可以做什么的一种很好的方式!</p><br><div class="note"><em>备注:</em> 图层不是响应链的一部分,所以它不能响应触碰或者视图那种手势, 就像你在 CALayerPlayground 示例中看到的那样。 <p></p><br><p>不过, 你可以敲击测试它们, 你会在 CATransformLayer 中看到示例代码。 你也可以往图层添加自定义动画, 这些动画会在 CAReplicatorLayer 中看到。</p></div><br><h2>示例2: CAScrollLayer</h2><br><p>CAScrollLayer 显示滚动图层的一部分。 它很基础,不能响应用户的触摸甚至不能确定滚动图层的边界, 所以它可以无限做类似防止滚出边界这种很酷的事! :] </p><br><p>UIScrollView 不用 CAScrollLayer 来做这件事, 取而代之的直接改变它的图层边界。 </p><br><p>用 CAScrollLayer 可以做的是设置它的滚动模式为水平或者垂直, 你可以编程让它滚动到特定的位置或区域:</p><br><br><div class="wp_codebox"><table><tr id="p904886"><td class="code" id="p90488code6"><pre class="swift" style="font-family:monospace;"><span style="color: #11740a; font-style: italic;">// In ScrollingView.swift</span><br><span style="color: #a61390;">import</span> UIKit<br>&nbsp;<br><span style="color: #a61390;">class</span> ScrollingView<span style="color: #002200;">:</span> <span style="color: #400080;">UIView</span> <span style="color: #002200;">&#123;</span><br>  <span style="color: #11740a; font-style: italic;">// 1</span><br>  <span style="color: #a61390;">override</span> <span style="color: #a61390;">class</span> <span style="color: #a61390;">func</span> layerClass<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">-</span>&gt; AnyClass <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">return</span> CAScrollLayer.<span style="color: #a61390;">self</span><br>  <span style="color: #002200;">&#125;</span><br><span style="color: #002200;">&#125;</span><br>&nbsp;<br><span style="color: #11740a; font-style: italic;">// In CAScrollLayerViewController.swift</span><br><span style="color: #a61390;">import</span> UIKit<br>&nbsp;<br><span style="color: #a61390;">class</span> CAScrollLayerViewController<span style="color: #002200;">:</span> <span style="color: #400080;">UIViewController</span> <span style="color: #002200;">&#123;</span><br>  @IBOutlet weak <span style="color: #a61390;">var</span> scrollingView<span style="color: #002200;">:</span> ScrollingView<span style="color: #002200;">!</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 2</span><br>  <span style="color: #a61390;">var</span> scrollingViewLayer<span style="color: #002200;">:</span> CAScrollLayer <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">return</span> scrollingView.layer <span style="color: #a61390;">as</span> CAScrollLayer<br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #a61390;">override</span> <span style="color: #a61390;">func</span> viewDidLoad<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">super</span>.viewDidLoad<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>    <span style="color: #11740a; font-style: italic;">// 3</span><br>    scrollingViewLayer.scrollMode <span style="color: #002200;">=</span> kCAScrollBoth<br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  @IBAction <span style="color: #a61390;">func</span> tapRecognized<span style="color: #002200;">&#40;</span>sender<span style="color: #002200;">:</span> <span style="color: #400080;">UITapGestureRecognizer</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    <span style="color: #11740a; font-style: italic;">// 4</span><br>    <span style="color: #a61390;">var</span> newPoint <span style="color: #002200;">=</span> <span style="color: #400080;">CGPoint</span><span style="color: #002200;">&#40;</span>x<span style="color: #002200;">:</span> <span style="color: #2400d9;">250</span>, y<span style="color: #002200;">:</span> <span style="color: #2400d9;">250</span><span style="color: #002200;">&#41;</span><br>    <span style="color: #400080;">UIView</span>.animateWithDuration<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">0.3</span>, delay<span style="color: #002200;">:</span> <span style="color: #2400d9;">0</span>, options<span style="color: #002200;">:</span> .CurveEaseInOut, animations<span style="color: #002200;">:</span> <span style="color: #002200;">&#123;</span><br>      <span style="color: #002200;">&#91;</span>unowned <span style="color: #a61390;">self</span><span style="color: #002200;">&#93;</span> <span style="color: #a61390;">in</span><br>      <span style="color: #a61390;">self</span>.scrollingViewLayer.scrollToPoint<span style="color: #002200;">&#40;</span>newPoint<span style="color: #002200;">&#41;</span><br>      <span style="color: #002200;">&#125;</span>, completion<span style="color: #002200;">:</span> <span style="color: #a61390;">nil</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br><span style="color: #002200;">&#125;</span></pre></td></tr></table></div><br><br><p>上面的代码:</p><br><ol><br><li>自定义 <code>UIView</code> 子类通过重写 <code>layerClass()</code> 来返回 <code>CAScrollLayer</code>; 这是创建一个新图层并且添加它作为一个子图层的一种选择, 就像示例做的一样。 </li><br><li>一个计算属性用来组织和自定义视图滚动图层的工作。</li><br><li>滚动设置为支持水平和垂直。 </li><br><li>当一个点击被识别后, 新的位置被创建, 滚动图层在一个 <code>UIView</code> 动画中滚动到那个位置。 备注: <code>scrollToPoint(<em>:)</em></code> 和 <code>scrollToRect(:)</code> 不会自动发生动画。 </li><br></ol><br><p>案例学习: 一个ScrollingView 实例, 它包含一个图片视图,这个视图的图片比滚动视图的边界还大。 当你执行上面的代码并单击视图, 可能是这样:</p><br><p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAScrollLayer.gif" alt="CAScrollLayer" width="250" height="250" class="aligncenter size-full wp-image-90738" srcset="https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/CAScrollLayer.gif 250w, https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/CAScrollLayer-32x32.gif 32w, https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/CAScrollLayer-64x64.gif 64w, https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/CAScrollLayer-96x96.gif 96w, https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/CAScrollLayer-128x128.gif 128w" sizes="(max-width: 250px) 100vw, 250px"></p><br><p>Layer Player 包含很多锁定水平和垂直滚动的控件。 </p><br><p>有一些经验规则决定用或不用 CAScrollLayer:</p><br><ul><br><li><em>如果只是想要轻量级并且需要编程实现滚动</em>: 考虑使用 CAScrollLayer.</li><br><li><em>如果你想让用户滚动</em>: 最好用 UIScrollView. 想了解更多, 查看 <a href="http://www.raywenderlich.com/93104/video-tutorial-swift-scroll-view-school-part-0-introduction" target="_blank" rel="external">18-part video tutorial series</a> .</li><br><li><em>如果你在滚动一个很大的图</em>: 考虑使用 CATiledLayer (更多信息在下面)。</li><br></ul><br><h2>示例3: CATextLayer</h2><br><p>CATextLayer 提供简单快速的纯文本或者属性字符串渲染。 不像 UILabel, CATextLayer 没有指定的 UIFont, 只有 CTFontRef 或 CGFontRef. </p><br><p>下面这块代码一样, 像动态变化一样去操作字体，字体大小，颜色，对齐方式，包围和截断:</p><br><br><div class="wp_codebox"><table><tr id="p904887"><td class="code" id="p90488code7"><pre class="swift" style="font-family:monospace;"><span style="color: #11740a; font-style: italic;">// 1</span><br><span style="color: #a61390;">let</span> textLayer <span style="color: #002200;">=</span> CATextLayer<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>textLayer.frame <span style="color: #002200;">=</span> someView.bounds<br>&nbsp;<br><span style="color: #11740a; font-style: italic;">// 2</span><br><span style="color: #a61390;">var</span> string <span style="color: #002200;">=</span> <span style="color: #bf1d1a;">&quot;&quot;</span><br><span style="color: #a61390;">for</span> _ <span style="color: #a61390;">in</span> <span style="color: #2400d9;">1</span>…20 <span style="color: #002200;">&#123;</span><br>  string <span style="color: #002200;">+=</span> <span style="color: #bf1d1a;">&quot;Lorem ipsum dolor sit amet, consectetur adipiscing elit. Fusce auctor arcu quis velit congue dictum. &quot;</span><br><span style="color: #002200;">&#125;</span><br>&nbsp;<br>textLayer.string <span style="color: #002200;">=</span> string<br>&nbsp;<br><span style="color: #11740a; font-style: italic;">// 3</span><br><span style="color: #a61390;">let</span> fontName<span style="color: #002200;">:</span> CFStringRef <span style="color: #002200;">=</span> <span style="color: #bf1d1a;">&quot;Noteworthy-Light&quot;</span><br>textLayer.font <span style="color: #002200;">=</span> CTFontCreateWithName<span style="color: #002200;">&#40;</span>fontName, fontSize, <span style="color: #a61390;">nil</span><span style="color: #002200;">&#41;</span><br>&nbsp;<br><span style="color: #11740a; font-style: italic;">// 4</span><br>textLayer.foregroundColor <span style="color: #002200;">=</span> <span style="color: #400080;">UIColor</span>.darkGrayColor<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span>.<span style="color: #400080;">CGColor</span><br>textLayer.wrapped <span style="color: #002200;">=</span> <span style="color: #a61390;">true</span><br>textLayer.alignmentMode <span style="color: #002200;">=</span> kCAAlignmentLeft<br>textLayer.contentsScale <span style="color: #002200;">=</span> UIScreen.mainScreen<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span>.scale<br>someView.layer.addSublayer<span style="color: #002200;">&#40;</span>textLayer<span style="color: #002200;">&#41;</span></pre></td></tr></table></div><br><br><p>解释上面的代码:</p><br><ol><br><li>创建一个 CATextLayer 实例并把它的区域设置成<code>someView</code>的区域。 </li><br><li>创建一个重复的字符串并把它设置到文字层。 </li><br><li>创建一个字体并把设置到文字层。 </li><br><li>设置文字层包围和左对齐, (你可以选择设成 natural, right, center 和 justified.),  <code>contentsScale</code> 设置成跟随屏幕, 然后把图层添加到视图层级中。</li><br></ol><br><p>所有图层类, 不仅仅是 CATextLayer, 默认按照1倍因子渲染。 连接到视图的时候, 图层按照当前屏幕自动设置 <code>contentsScale</code> 合适的比例。 手动创建的图层需要显示设置 <code>contentsScale</code> , 否则缩放比例是1，你在视网膜屏幕看到的是模糊的文字。</p><br><p>如果添加到正方形的 <code>someView</code>, 创建的文字图层会像下面这样:</p><br><p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer-250x250.png" alt="CATextLayer" width="250" height="250" class="aligncenter size-thumbnail wp-image-90750" srcset="https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer-250x250.png 250w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer-320x320.png 320w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer-500x500.png 500w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer-32x32.png 32w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer-64x64.png 64w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer-96x96.png 96w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer-128x128.png 128w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer.png 800w" sizes="(max-width: 250px) 100vw, 250px"></p><br><p>Truncation is a setting you can play with, and it&#8217;s nice when you&#8217;d like to represent clipped text with an ellipsis. Truncation defaults to none and can be set to start, end and middle:</p><br><p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer-MiddleTruncation.png.png" alt="CATextLayer-MiddleTruncation.png" width="250" height="26" class="aligncenter size-full wp-image-90764"></p><br><p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer-StartTruncation.png.png" alt="CATextLayer-StartTruncation.png" width="250" height="26" class="aligncenter size-full wp-image-90765"></p><br><p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer-EndTruncation.png" alt="CATextLayer-EndTruncation" width="250" height="26" class="aligncenter size-full wp-image-90763"></p><br><p>Layer Player has controls to change many of CATextLayer&#8217;s properties:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer_5.5.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer_5.5-180x320.png" alt="CATextLayer_5.5" width="180" height="320" class="aligncenter size-medium wp-image-91214 bordered" srcset="https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer_5.5-180x320.png 180w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer_5.5-281x500.png 281w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer_5.5.png 1242w" sizes="(max-width: 180px) 100vw, 180px"></a></p><br><h2>示例4: AVPlayerLayer</h2><br><p>AVPlayerLayer adds a sweet layer goodness to AVFoundation. It holds an AVPlayer to play AV media files (AVPlayerItems). Here&#8217;s an example of creating an AVPlayerLayer:</p><br><br><div class="wp_codebox"><table><tr id="p904888"><td class="code" id="p90488code8"><pre class="swift" style="font-family:monospace;"><span style="color: #a61390;">override</span> <span style="color: #a61390;">func</span> viewDidLoad<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>  <span style="color: #a61390;">super</span>.viewDidLoad<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #11740a; font-style: italic;">// 1</span><br>  <span style="color: #a61390;">let</span> playerLayer <span style="color: #002200;">=</span> AVPlayerLayer<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>  playerLayer.frame <span style="color: #002200;">=</span> someView.bounds<br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 2</span><br>  <span style="color: #a61390;">let</span> url <span style="color: #002200;">=</span> <span style="color: #400080;">NSBundle</span>.mainBundle<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span>.URLForResource<span style="color: #002200;">&#40;</span><span style="color: #bf1d1a;">&quot;someVideo&quot;</span>, withExtension<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">&quot;m4v&quot;</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #a61390;">let</span> player <span style="color: #002200;">=</span> AVPlayer<span style="color: #002200;">&#40;</span>URL<span style="color: #002200;">:</span> url<span style="color: #002200;">&#41;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 3</span><br>  player.actionAtItemEnd <span style="color: #002200;">=</span> .None<br>  playerLayer.player <span style="color: #002200;">=</span> player<br>  someView.layer.addSublayer<span style="color: #002200;">&#40;</span>playerLayer<span style="color: #002200;">&#41;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 4</span><br>  <span style="color: #400080;">NSNotificationCenter</span>.defaultCenter<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span>.addObserver<span style="color: #002200;">&#40;</span><span style="color: #a61390;">self</span>, selector<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">&quot;playerDidReachEndNotificationHandler:&quot;</span>, name<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">&quot;AVPlayerItemDidPlayToEndTimeNotification&quot;</span>, object<span style="color: #002200;">:</span> player.currentItem<span style="color: #002200;">&#41;</span><br><span style="color: #002200;">&#125;</span><br>&nbsp;<br><span style="color: #a61390;">deinit</span> <span style="color: #002200;">&#123;</span><br>  <span style="color: #400080;">NSNotificationCenter</span>.defaultCenter<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span>.removeObserver<span style="color: #002200;">&#40;</span><span style="color: #a61390;">self</span><span style="color: #002200;">&#41;</span><br><span style="color: #002200;">&#125;</span><br>&nbsp;<br><span style="color: #11740a; font-style: italic;">// 5</span><br>@IBAction <span style="color: #a61390;">func</span> playButtonTapped<span style="color: #002200;">&#40;</span>sender<span style="color: #002200;">:</span> <span style="color: #400080;">UIButton</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>  <span style="color: #a61390;">if</span> playButton.titleLabel?.text <span style="color: #002200;">==</span> <span style="color: #bf1d1a;">&quot;Play&quot;</span> <span style="color: #002200;">&#123;</span><br>    player.play<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>    playButton.setTitle<span style="color: #002200;">&#40;</span><span style="color: #bf1d1a;">&quot;Pause&quot;</span>, forState<span style="color: #002200;">:</span> .Normal<span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span> <span style="color: #a61390;">else</span> <span style="color: #002200;">&#123;</span><br>    player.pause<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>    playButton.setTitle<span style="color: #002200;">&#40;</span><span style="color: #bf1d1a;">&quot;Play&quot;</span>, forState<span style="color: #002200;">:</span> .Normal<span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  updatePlayButtonTitle<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>  updateRateSegmentedControl<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br><span style="color: #002200;">&#125;</span><br>&nbsp;<br><span style="color: #11740a; font-style: italic;">// 6</span><br><span style="color: #a61390;">func</span> playerDidReachEndNotificationHandler<span style="color: #002200;">&#40;</span>notification<span style="color: #002200;">:</span> <span style="color: #400080;">NSNotification</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>  <span style="color: #a61390;">let</span> playerItem <span style="color: #002200;">=</span> notification.object <span style="color: #a61390;">as</span> AVPlayerItem<br>  playerItem.seekToTime<span style="color: #002200;">&#40;</span>kCMTimeZero<span style="color: #002200;">&#41;</span><br><span style="color: #002200;">&#125;</span></pre></td></tr></table></div><br><br><p>A breakdown of the above code:</p><br><ol><br><li>Creates a new player layer and sets its frame.</li><br><li>Creates a player with an AV asset. </li><br><li>Tells the player to do nothing when it finishes playing; additional options include pausing or advancing to the next asset, if applicable. </li><br><li>Registers for AVPlayer&#8217;s notification when it finishes playing an asset (and remove the controller as an observer in deinit). </li><br><li>When the play button is tapped, it toggles controls to play the AV asset and set the button&#8217;s title.</li><br></ol><br><p>Note this is just a simple example just to get you started. In a real project, it would generally not be advisable to pivot on a button&#8217;s title text.</p><br><p>The AVPlayerLayer and its AVPlayer created above would be visually represented by the first frame of the AVPlayerItem instance, like this:</p><br><p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/AVPlayerItem.png" alt="AVPlayerItem" width="250" height="141" class="aligncenter size-full wp-image-91221"></p><br><p>AVPlayerLayer has a couple additional properties:</p><br><ul><br><li><code>videoGravity</code> sets the resizing behavior of the video display. </li><br><li><code>readyForDisplay</code> checks if the video is ready for display. </li><br></ul><br><p><code>AVPlayer</code>, on the other hand, has quite a few additional properties and methods. One to note is <code>rate</code>, which is the playback rate from 0 to 1. Zero means to pause, and 1 means the video plays at regular speed (1x). </p><br><p>However, setting <code>rate</code> also instructs playback to commence at that rate. In other words, calling <code>pause()</code> and setting <code>rate</code> to 0 does the same thing, as calling <code>play()</code> and setting <code>rate</code> to 1.</p><br><p>So what about fast forward, slow motion or playing in reverse? AVPlayerLayer has you covered. Setting <code>rate</code> to anything higher than 1 is equivalent to asking the player to commence playback at that number times regular speed, for instance, setting <code>rate</code> to 2 means double-speed. </p><br><p>As you might assume, setting <code>rate</code> to a negative number instructs playback to commence at that number times regular speed in reverse. </p><br><p>Before playback occurs at any rate other than regular speed (forward), however, the appropriate method is called on the AVPlayerItem instance to verify that it can be played back at that rate: </p><br><ul><br><li><code>canPlayFastForward()</code> for higher than 1</li><br><li><code>canPlaySlowForward()</code> for between 0 and 1</li><br><li><code>canPlayReverse()</code> for -1</li><br><li><code>canPlaySlowReverse()</code> for between -1 and 0</li><br><li><code>canPlayFastReverse()</code> for lower than -1 </li><br></ul><br><p>Most videos can typically play at various forward speeds, but it&#8217;s less typical that they can  play in reverse. Layer Player also includes playback controls:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/AVLayerPlayer_5.5.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/AVLayerPlayer_5.5-180x320.png" alt="AVLayerPlayer_5.5" width="180" height="320" class="aligncenter size-medium wp-image-91216 bordered" srcset="https://cdn3.raywenderlich.com/wp-content/uploads/2014/12/AVLayerPlayer_5.5-180x320.png 180w, https://cdn3.raywenderlich.com/wp-content/uploads/2014/12/AVLayerPlayer_5.5-281x500.png 281w, https://cdn3.raywenderlich.com/wp-content/uploads/2014/12/AVLayerPlayer_5.5.png 1242w" sizes="(max-width: 180px) 100vw, 180px"></a></p><br><h2>示例5: CAGradientLayer</h2><br><p>CAGradientLayer makes it easy to blend two or more colors together, making it especially well suited to backgrounds. To configure it, you assign an array of CGColors, as well as a <code>startPoint</code> and an <code>endPoint</code> to specify where the gradient layer should begin and end. </p><br><p>Bear in mind, <code>startPoint</code> and <code>endPoint</code> are not explicit points. Rather, they are defined in the unit coordinate space and then mapped to the layer&#8217;s bounds when drawn. In other words, an x value of 1 means the point is at the right edge of the layer, and a y value of 1 means the point is at the bottom edge of the layer. </p><br><p>CAGradientLayer has a <code>type</code> property, although <code>kCAGradientLayerAxial</code> is the only option, and it transitions through each color in the array linearly. </p><br><p>This means that if you draw a line (A) between <code>startPoint</code> and <code>endPoint</code>, the gradations would occur along an imaginary line (B) that is perpendicular to A, and all points along B would be the same color:</p><br><p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/AxialGradientLayerType.gif" alt="AxialGradientLayerType" width="300" class="aligncenter size-full wp-image-91240"></p><br><p>Alternatively, you can control the <code>locations</code> property with an array of values between 0 and 1 that specify relative stops where the gradient layer should use the next color in the <code>colors</code> array. </p><br><p>If left unspecified the stop locations default to evenly spaced. If <code>locations</code> is set, though, its count must match <code>colors</code> count, or else bad things will happen. :[</p><br><p>Here&#8217;s an example of how to  create a gradient layer:</p><br><br><div class="wp_codebox"><table><tr id="p904889"><td class="code" id="p90488code9"><pre class="swift" style="font-family:monospace;"><span style="color: #a61390;">let</span> gradientLayer <span style="color: #002200;">=</span> CAGradientLayer<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>gradientLayer.frame <span style="color: #002200;">=</span> someView.bounds<br>gradientLayer.colors <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>cgColorForRed<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">209.0</span>, green<span style="color: #002200;">:</span> <span style="color: #2400d9;">0.0</span>, blue<span style="color: #002200;">:</span> <span style="color: #2400d9;">0.0</span><span style="color: #002200;">&#41;</span>,<br>  cgColorForRed<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">255.0</span>, green<span style="color: #002200;">:</span> <span style="color: #2400d9;">102.0</span>, blue<span style="color: #002200;">:</span> <span style="color: #2400d9;">34.0</span><span style="color: #002200;">&#41;</span>,<br>  cgColorForRed<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">255.0</span>, green<span style="color: #002200;">:</span> <span style="color: #2400d9;">218.0</span>, blue<span style="color: #002200;">:</span> <span style="color: #2400d9;">33.0</span><span style="color: #002200;">&#41;</span>,<br>  cgColorForRed<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">51.0</span>, green<span style="color: #002200;">:</span> <span style="color: #2400d9;">221.0</span>, blue<span style="color: #002200;">:</span> <span style="color: #2400d9;">0.0</span><span style="color: #002200;">&#41;</span>,<br>  cgColorForRed<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">17.0</span>, green<span style="color: #002200;">:</span> <span style="color: #2400d9;">51.0</span>, blue<span style="color: #002200;">:</span> <span style="color: #2400d9;">204.0</span><span style="color: #002200;">&#41;</span>,<br>  cgColorForRed<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">34.0</span>, green<span style="color: #002200;">:</span> <span style="color: #2400d9;">0.0</span>, blue<span style="color: #002200;">:</span> <span style="color: #2400d9;">102.0</span><span style="color: #002200;">&#41;</span>,<br>  cgColorForRed<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">51.0</span>, green<span style="color: #002200;">:</span> <span style="color: #2400d9;">0.0</span>, blue<span style="color: #002200;">:</span> <span style="color: #2400d9;">68.0</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#93;</span><br>gradientLayer.startPoint <span style="color: #002200;">=</span> <span style="color: #400080;">CGPoint</span><span style="color: #002200;">&#40;</span>x<span style="color: #002200;">:</span> <span style="color: #2400d9;">0</span>, y<span style="color: #002200;">:</span> <span style="color: #2400d9;">0</span><span style="color: #002200;">&#41;</span><br>gradientLayer.endPoint <span style="color: #002200;">=</span> <span style="color: #400080;">CGPoint</span><span style="color: #002200;">&#40;</span>x<span style="color: #002200;">:</span> <span style="color: #2400d9;">0</span>, y<span style="color: #002200;">:</span> <span style="color: #2400d9;">1</span><span style="color: #002200;">&#41;</span><br>someView.layer.addSublayer<span style="color: #002200;">&#40;</span>gradientLayer<span style="color: #002200;">&#41;</span><br>&nbsp;<br><span style="color: #a61390;">func</span> cgColorForRed<span style="color: #002200;">&#40;</span>red<span style="color: #002200;">:</span> <span style="color: #400080;">CGFloat</span>, green<span style="color: #002200;">:</span> <span style="color: #400080;">CGFloat</span>, blue<span style="color: #002200;">:</span> <span style="color: #400080;">CGFloat</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">-</span>&gt; <span style="color: #a61390;">AnyObject</span> <span style="color: #002200;">&#123;</span><br>  <span style="color: #a61390;">return</span> <span style="color: #400080;">UIColor</span><span style="color: #002200;">&#40;</span>red<span style="color: #002200;">:</span> red<span style="color: #002200;">/</span><span style="color: #2400d9;">255.0</span>, green<span style="color: #002200;">:</span> green<span style="color: #002200;">/</span><span style="color: #2400d9;">255.0</span>, blue<span style="color: #002200;">:</span> blue<span style="color: #002200;">/</span><span style="color: #2400d9;">255.0</span>, alpha<span style="color: #002200;">:</span> <span style="color: #2400d9;">1.0</span><span style="color: #002200;">&#41;</span>.<span style="color: #400080;">CGColor</span> <span style="color: #a61390;">as</span> <span style="color: #a61390;">AnyObject</span><br><span style="color: #002200;">&#125;</span></pre></td></tr></table></div><br><br><p>In the above code, you create a gradient layer, match its frame to the bounds of <code>someView</code>, assign an array of colors, set start and end points, and add the gradient layer to the view hierarchy. Here&#8217;s what it would look like:</p><br><p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAGradientLayer-250x250.png" alt="CAGradientLayer" width="250" height="250" class="aligncenter size-thumbnail wp-image-91248 bordered" srcset="https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CAGradientLayer-250x250.png 250w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CAGradientLayer-320x320.png 320w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CAGradientLayer-500x500.png 500w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CAGradientLayer-32x32.png 32w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CAGradientLayer-64x64.png 64w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CAGradientLayer-96x96.png 96w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CAGradientLayer-128x128.png 128w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CAGradientLayer.png 609w" sizes="(max-width: 250px) 100vw, 250px"></p><br><p>So colorful! Next, you&#8217;ll program a butterfly that comes fluttering out of the app to tickle your nose. :]</p><br><p>Layer Player provides you controls to change start and end points, colors and locations:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAGradientLayer_5.5.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAGradientLayer_5.5-180x320.png" alt="CAGradientLayer_5.5" width="180" height="320" class="aligncenter size-medium wp-image-91244 bordered" srcset="https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/CAGradientLayer_5.5-180x320.png 180w, https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/CAGradientLayer_5.5-281x500.png 281w, https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/CAGradientLayer_5.5.png 1242w" sizes="(max-width: 180px) 100vw, 180px"></a></p><br><h2>示例6: CAReplicatorLayer</h2><br><p>CAReplicatorLayer duplicates a layer a specified number of times, which can allow you to create some cool effects. </p><br><p>Each layer copy can have it&#8217;s own color and positioning changes, and its drawing can be delayed to give an animation effect to the overall replicator layer. Depth can also be preserved to give the replicator layer a 3D effect. Here&#8217;s an example:</p><br><br><div class="wp_codebox"><table><tr id="p9048810"><td class="code" id="p90488code10"><pre class="swift" style="font-family:monospace;"><span style="color: #11740a; font-style: italic;">// 1</span><br><span style="color: #a61390;">let</span> replicatorLayer <span style="color: #002200;">=</span> CAReplicatorLayer<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>replicatorLayer.frame <span style="color: #002200;">=</span> someView.bounds<br>&nbsp;<br><span style="color: #11740a; font-style: italic;">// 2</span><br>replicatorLayer.instanceCount <span style="color: #002200;">=</span> <span style="color: #2400d9;">30</span><br>replicatorLayer.instanceDelay <span style="color: #002200;">=</span> CFTimeInterval<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">1</span> <span style="color: #002200;">/</span> <span style="color: #2400d9;">30.0</span><span style="color: #002200;">&#41;</span><br>replicatorLayer.preservesDepth <span style="color: #002200;">=</span> <span style="color: #a61390;">false</span><br>replicatorLayer.instanceColor <span style="color: #002200;">=</span> <span style="color: #400080;">UIColor</span>.whiteColor<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span>.<span style="color: #400080;">CGColor</span><br>&nbsp;<br><span style="color: #11740a; font-style: italic;">// 3</span><br>replicatorLayer.instanceRedOffset <span style="color: #002200;">=</span> <span style="color: #2400d9;">0.0</span><br>replicatorLayer.instanceGreenOffset <span style="color: #002200;">=</span> <span style="color: #002200;">-</span><span style="color: #2400d9;">0.5</span><br>replicatorLayer.instanceBlueOffset <span style="color: #002200;">=</span> <span style="color: #002200;">-</span><span style="color: #2400d9;">0.5</span><br>replicatorLayer.instanceAlphaOffset <span style="color: #002200;">=</span> <span style="color: #2400d9;">0.0</span><br>&nbsp;<br><span style="color: #11740a; font-style: italic;">// 4</span><br><span style="color: #a61390;">let</span> angle <span style="color: #002200;">=</span> <span style="color: #a61390;">Float</span><span style="color: #002200;">&#40;</span>M_PI <span style="color: #002200;"><em></em></span> <span style="color: #2400d9;">2.0</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">/</span> <span style="color: #2400d9;">30</span><br>replicatorLayer.instanceTransform <span style="color: #002200;">=</span> CATransform3DMakeRotation<span style="color: #002200;">&#40;</span><span style="color: #400080;">CGFloat</span><span style="color: #002200;">&#40;</span>angle<span style="color: #002200;">&#41;</span>, <span style="color: #2400d9;">0.0</span>, <span style="color: #2400d9;">0.0</span>, <span style="color: #2400d9;">1.0</span><span style="color: #002200;">&#41;</span><br>someView.layer.addSublayer<span style="color: #002200;">&#40;</span>replicatorLayer<span style="color: #002200;">&#41;</span><br>&nbsp;<br><span style="color: #11740a; font-style: italic;">// 5</span><br><span style="color: #a61390;">let</span> instanceLayer <span style="color: #002200;">=</span> <span style="color: #400080;">CALayer</span><span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br><span style="color: #a61390;">let</span> layerWidth<span style="color: #002200;">:</span> <span style="color: #400080;">CGFloat</span> <span style="color: #002200;">=</span> <span style="color: #2400d9;">10.0</span><br><span style="color: #a61390;">let</span> midX <span style="color: #002200;">=</span> CGRectGetMidX<span style="color: #002200;">&#40;</span>someView.bounds<span style="color: #002200;">&#41;</span> <span style="color: #002200;">-</span> layerWidth <span style="color: #002200;">/</span> <span style="color: #2400d9;">2.0</span><br>instanceLayer.frame <span style="color: #002200;">=</span> <span style="color: #400080;">CGRect</span><span style="color: #002200;">&#40;</span>x<span style="color: #002200;">:</span> midX, y<span style="color: #002200;">:</span> <span style="color: #2400d9;">0.0</span>, width<span style="color: #002200;">:</span> layerWidth, height<span style="color: #002200;">:</span> layerWidth <span style="color: #002200;"></span> <span style="color: #2400d9;">3.0</span><span style="color: #002200;">&#41;</span><br>instanceLayer.backgroundColor <span style="color: #002200;">=</span> <span style="color: #400080;">UIColor</span>.whiteColor<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span>.<span style="color: #400080;">CGColor</span><br>replicatorLayer.addSublayer<span style="color: #002200;">&#40;</span>instanceLayer<span style="color: #002200;">&#41;</span><br>&nbsp;<br><span style="color: #11740a; font-style: italic;">// 6</span><br><span style="color: #a61390;">let</span> fadeAnimation <span style="color: #002200;">=</span> <span style="color: #400080;">CABasicAnimation</span><span style="color: #002200;">&#40;</span>keyPath<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">&quot;opacity&quot;</span><span style="color: #002200;">&#41;</span><br>fadeAnimation.fromValue <span style="color: #002200;">=</span> <span style="color: #2400d9;">1.0</span><br>fadeAnimation.toValue <span style="color: #002200;">=</span> <span style="color: #2400d9;">0.0</span><br>fadeAnimation.duration <span style="color: #002200;">=</span> <span style="color: #2400d9;">1</span><br>fadeAnimation.repeatCount <span style="color: #002200;">=</span> <span style="color: #a61390;">Float</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">Int</span>.<span style="color: #a61390;">max</span><span style="color: #002200;">&#41;</span><br>&nbsp;<br><span style="color: #11740a; font-style: italic;">// 7</span><br>instanceLayer.opacity <span style="color: #002200;">=</span> <span style="color: #2400d9;">0.0</span><br>instanceLayer.addAnimation<span style="color: #002200;">&#40;</span>fadeAnimation, forKey<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">&quot;FadeAnimation&quot;</span><span style="color: #002200;">&#41;</span></pre></td></tr></table></div><br><br><p>What the above code does:</p><br><ol><br><li>Creates an instance of CAReplicatorLayer and sets its frame set to <code>someView</code>&#8216;s bounds. </li><br><li>Sets the replicator layer&#8217;s number of copies (<code>instanceCount</code>) and drawing delay. Also sets the replicator layer to be 2D (<code>preservesDepth = false</code>) and its instance color to white. </li><br><li>Adds red/green/blue offsets to the color values of each successive replicated instance. Each defaults to 0, and that effectively preserves color value across all instances. However, in this case, the instance color was originally set to white, meaning red, green and blue are 1.0 already. Hence, setting red to 0 and the green and blue offset values to a negative number allows red to be the prominent color. Similarly, the alpha offset is added to the alpha of each successive replicated instance. </li><br><li>Creates a transform to rotate each successive instance around a circle. </li><br><li>Creates an instance layer for the replicator layer to use and sets its frame so the first instance will be drawn at center x and at the top of <code>someView</code>&#8216;s bounds. This block also sets the instance&#8217;s color and adds the instance layer to the replicator layer. </li><br><li>Makes a fade animation to animate opacity from 1 (opaque) to 0 (transparent). </li><br><li>Sets the instance layer&#8217;s opacity to 0 so that it is transparent until each instance is drawn and its color and alpha values are set.</li><br></ol><br><p>And here&#8217;s what that code would get you:</p><br><p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAReplicatorLayer.gif" alt="CAReplicatorLayer" width="250" height="250" class="aligncenter size-full wp-image-91334" srcset="https://cdn3.raywenderlich.com/wp-content/uploads/2014/12/CAReplicatorLayer.gif 250w, https://cdn3.raywenderlich.com/wp-content/uploads/2014/12/CAReplicatorLayer-32x32.gif 32w, https://cdn3.raywenderlich.com/wp-content/uploads/2014/12/CAReplicatorLayer-64x64.gif 64w, https://cdn3.raywenderlich.com/wp-content/uploads/2014/12/CAReplicatorLayer-96x96.gif 96w, https://cdn3.raywenderlich.com/wp-content/uploads/2014/12/CAReplicatorLayer-128x128.gif 128w" sizes="(max-width: 250px) 100vw, 250px"></p><br><p>Layer Player includes controls to manipulate most of these properties:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAReplicatorLayer_5.5.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAReplicatorLayer_5.5-180x320.png" alt="CAReplicatorLayer_5.5" width="180" height="320" class="aligncenter size-medium wp-image-91349 bordered" srcset="https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CAReplicatorLayer_5.5-180x320.png 180w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CAReplicatorLayer_5.5-281x500.png 281w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CAReplicatorLayer_5.5.png 1242w" sizes="(max-width: 180px) 100vw, 180px"></a></p><br><h2>示例7: CATiledLayer</h2><br><p>CATiledLayer asynchronously draws layer content in tiles. This is great for very large images or other sets of content where you are only looking at small bits at a time, because you can start seeing your content without having to load it all into memory at once.</p><br><p>There are a couple of ways to handle the drawing. One is to override UIView and use a CATiledLayer to repeatedly draw tiles to fill up view&#8217;s background, like this:</p><br><br><div class="wp_codebox"><table><tr id="p9048811"><td class="code" id="p90488code11"><pre class="swift" style="font-family:monospace;"><span style="color: #11740a; font-style: italic;">// In ViewController.swift</span><br><span style="color: #a61390;">import</span> UIKit<br>&nbsp;<br><span style="color: #a61390;">class</span> ViewController<span style="color: #002200;">:</span> <span style="color: #400080;">UIViewController</span> <span style="color: #002200;">&#123;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 1</span><br>  @IBOutlet weak <span style="color: #a61390;">var</span> tiledBackgroundView<span style="color: #002200;">:</span> TiledBackgroundView<span style="color: #002200;">!</span><br>&nbsp;<br><span style="color: #002200;">&#125;</span><br>&nbsp;<br><span style="color: #11740a; font-style: italic;">// In TiledBackgroundView.swift</span><br><span style="color: #a61390;">import</span> UIKit<br>&nbsp;<br><span style="color: #a61390;">class</span> TiledBackgroundView<span style="color: #002200;">:</span> <span style="color: #400080;">UIView</span> <span style="color: #002200;">&#123;</span><br>&nbsp;<br>  <span style="color: #a61390;">let</span> sideLength <span style="color: #002200;">=</span> <span style="color: #400080;">CGFloat</span><span style="color: #002200;">&#40;</span><span style="color: #2400d9;">50.0</span><span style="color: #002200;">&#41;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 2</span><br>  <span style="color: #a61390;">override</span> <span style="color: #a61390;">class</span> <span style="color: #a61390;">func</span> layerClass<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">-</span>&gt; AnyClass <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">return</span> CATiledLayer.<span style="color: #a61390;">self</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 3</span><br>  required <span style="color: #a61390;">init</span><span style="color: #002200;">&#40;</span>coder aDecoder<span style="color: #002200;">:</span> <span style="color: #400080;">NSCoder</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">super</span>.<span style="color: #a61390;">init</span><span style="color: #002200;">&#40;</span>coder<span style="color: #002200;">:</span> aDecoder<span style="color: #002200;">&#41;</span><br>    srand48<span style="color: #002200;">&#40;</span><span style="color: #a61390;">Int</span><span style="color: #002200;">&#40;</span><span style="color: #400080;">NSDate</span><span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span>.timeIntervalSince1970<span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    <span style="color: #a61390;">let</span> layer <span style="color: #002200;">=</span> <span style="color: #a61390;">self</span>.layer <span style="color: #a61390;">as</span> CATiledLayer<br>    <span style="color: #a61390;">let</span> scale <span style="color: #002200;">=</span> UIScreen.mainScreen<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span>.scale<br>    layer.contentsScale <span style="color: #002200;">=</span> scale<br>    layer.tileSize <span style="color: #002200;">=</span> <span style="color: #400080;">CGSize</span><span style="color: #002200;">&#40;</span>width<span style="color: #002200;">:</span> sideLength <span style="color: #002200;"><em></em></span> scale, height<span style="color: #002200;">:</span> sideLength <span style="color: #002200;"></span> scale<span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 4</span><br>  <span style="color: #a61390;">override</span> <span style="color: #a61390;">func</span> drawRect<span style="color: #002200;">&#40;</span>rect<span style="color: #002200;">:</span> <span style="color: #400080;">CGRect</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">let</span> context <span style="color: #002200;">=</span> <span style="color: #400080;">UIGraphicsGetCurrentContext</span><span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>    <span style="color: #a61390;">var</span> red <span style="color: #002200;">=</span> <span style="color: #400080;">CGFloat</span><span style="color: #002200;">&#40;</span>drand48<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    <span style="color: #a61390;">var</span> green <span style="color: #002200;">=</span> <span style="color: #400080;">CGFloat</span><span style="color: #002200;">&#40;</span>drand48<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    <span style="color: #a61390;">var</span> blue <span style="color: #002200;">=</span> <span style="color: #400080;">CGFloat</span><span style="color: #002200;">&#40;</span>drand48<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    CGContextSetRGBFillColor<span style="color: #002200;">&#40;</span>context, red, green, blue, <span style="color: #2400d9;">1.0</span><span style="color: #002200;">&#41;</span><br>    CGContextFillRect<span style="color: #002200;">&#40;</span>context, rect<span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br><span style="color: #002200;">&#125;</span></pre></td></tr></table></div><br><br><p>Here&#8217;s what&#8217;s happening in the above code:</p><br><ol><br><li><code>tiledBackgroundView</code> is positioned at (150, 150) with width and height of 300. </li><br><li><code>layerClass()</code> is overridden so the layer for this view is created as an instance of CATiledLayer. </li><br><li>Seeds the <code>rand48()</code> function that will be used to generate random colors in <code>drawRect()</code>. Then scales the contents of the layer (cast as a CATiledLayer) to match the screen&#8217;s scale and its tile size set. </li><br><li>Overrides <code>drawRect()</code> to fill the view with tiled layers with random colors.</li><br></ol><br><p>Ultimately, the above code draws a 6&#215;6 grid of randomly colored square tiles, like this:</p><br><p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayer-250x250.png" alt="CATiledLayer" width="250" height="250" class="aligncenter size-thumbnail wp-image-91465" srcset="https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayer-250x250.png 250w, https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayer-320x320.png 320w, https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayer-32x32.png 32w, https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayer-64x64.png 64w, https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayer-96x96.png 96w, https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayer-128x128.png 128w, https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayer.png 451w" sizes="(max-width: 250px) 100vw, 250px"></p><br><p>Layer Player expands upon this usage by also drawing a path on top of the tiled layer background:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayer_5.5.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayer_5.5-180x320.png" alt="CATiledLayer_5.5" width="180" height="320" class="aligncenter size-medium wp-image-91469 bordered" srcset="https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayer_5.5-180x320.png 180w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayer_5.5-281x500.png 281w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayer_5.5.png 1242w" sizes="(max-width: 180px) 100vw, 180px"></a></p><br><p>The star in the above screenshot becomes blurry as you zoom in on the view:</p><br><p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayerZoomedBlurry-250x250.png" alt="CATiledLayerZoomedBlurry" width="250" height="250" class="aligncenter size-thumbnail wp-image-91473" srcset="https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayerZoomedBlurry-250x250.png 250w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayerZoomedBlurry-320x320.png 320w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayerZoomedBlurry-32x32.png 32w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayerZoomedBlurry-64x64.png 64w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayerZoomedBlurry-96x96.png 96w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayerZoomedBlurry-128x128.png 128w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayerZoomedBlurry.png 374w" sizes="(max-width: 250px) 100vw, 250px"></p><br><p>This blurriness is the result of levels of detail maintained by the layer. CATiledLayer has two properties, <code>levelsOfDetail</code> and <code>levelsOfDetailBias</code>. </p><br><p><code>levelsOfDetail</code>, as its name aptly applies, is the number of levels of detail maintained by the layer. It defaults to 1, and each incremental level caches at half the resolution of the previous level. The maximum <code>levelsOfDetail</code> value for a layer is that which its bottom-most level of detail has at least a single pixel. </p><br><p><code>levelsOfDetailBias</code>, on the other hand, is the number of <i>magnified</i> levels of detail cached by this layer. It defaults to 0, meaning no additional magnified levels will be cached, and each incremental level will be cached at double the preceding level&#8217;s resolution. </p><br><p>For example, increasing the <code>levelsOfDetailBias</code> to 5 for the blurry tiled layer above would result in caching levels magnified at 2x, 4x, 8x, 16x and 32x, and the zoomed in layer would look like this:</p><br><p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayerZoomed-250x250.png" alt="CATiledLayerZoomed" width="250" height="250" class="aligncenter size-thumbnail wp-image-91475" srcset="https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayerZoomed-250x250.png 250w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayerZoomed-320x320.png 320w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayerZoomed-32x32.png 32w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayerZoomed-64x64.png 64w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayerZoomed-96x96.png 96w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayerZoomed-128x128.png 128w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayerZoomed.png 374w" sizes="(max-width: 250px) 100vw, 250px"></p><br><p>Pretty cool, eh? But wait, there&#8217;s more! </p><br><p>CATiledLayer slices and dices and&#8230;sorry, had a flashback to the <a href="https://www.youtube.com/watch?v=abLB7aTmnE4" title="Original Ginsu infomercial" target="_blank" rel="external">Ginsu knife infomercial</a> for a second there. :] </p><br><p>But seriously, CATiledLayer has another, dare I say <i>more</i> useful purpose than a Ginsu knife: asynchronously drawing tiles of a very large image, for example, within a scroll view. </p><br><p>You have to provide the tiles and logic to tell the tiled layer which tiles to grab as the user scrolls around, but the performance gain here is remarkable. </p><br><p>Layer Player includes a UIImage extension in a file named <a href="https://github.com/scotteg/LayerPlayer/blob/master/LayerPlayer/UIImage%2BTileCutter.swift" title="UIImage+TileCutter.swift" target="_blank">UIImage+TileCutter.swift</a>. Fellow tutorial team member <a href="http://www.raywenderlich.com/u/nicklockwood" title="Nick Lockwood" target="_blank" rel="external">Nick Lockwood</a> adapted this code for his Terminal app, which he provided in his excellent book, <i>iOS Core Animation: Advanced Techniques</i>. </p><br><p>Its job is to slice and dice the source image into square tiles of the specified size, named according to the column and row location of each tile; for example, windingRoad_6_2.png for the tile at column 7, row 3 (zero-indexed):</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/windingRoad.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/windingRoad-480x300.png" alt="windingRoad" width="480" height="300" class="aligncenter size-medium wp-image-91653" srcset="https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/windingRoad-480x300.png 480w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/windingRoad-700x437.png 700w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/windingRoad.png 1200w" sizes="(max-width: 480px) 100vw, 480px"></a></p><br><p>With those tiles in place, a custom UIView subclass can be created to draw those tile layers:</p><br><br><div class="wp_codebox"><table><tr id="p9048812"><td class="code" id="p90488code12"><pre class="swift" style="font-family:monospace;"><span style="color: #a61390;">import</span> UIKit<br>&nbsp;<br><span style="color: #a61390;">class</span> TilingViewForImage<span style="color: #002200;">:</span> <span style="color: #400080;">UIView</span> <span style="color: #002200;">&#123;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 1</span><br>  <span style="color: #a61390;">let</span> sideLength <span style="color: #002200;">=</span> <span style="color: #400080;">CGFloat</span><span style="color: #002200;">&#40;</span><span style="color: #2400d9;">640.0</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #a61390;">let</span> fileName <span style="color: #002200;">=</span> <span style="color: #bf1d1a;">&quot;windingRoad&quot;</span><br>  <span style="color: #a61390;">let</span> cachesPath <span style="color: #002200;">=</span> NSSearchPathForDirectoriesInDomains<span style="color: #002200;">&#40;</span>.CachesDirectory, .UserDomainMask, <span style="color: #a61390;">true</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#91;</span><span style="color: #2400d9;">0</span><span style="color: #002200;">&#93;</span> <span style="color: #a61390;">as</span> <span style="color: #a61390;">String</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 2</span><br>  <span style="color: #a61390;">override</span> <span style="color: #a61390;">class</span> <span style="color: #a61390;">func</span> layerClass<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">-</span>&gt; AnyClass <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">return</span> CATiledLayer.<span style="color: #a61390;">self</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 3</span><br>  required <span style="color: #a61390;">init</span><span style="color: #002200;">&#40;</span>coder aDecoder<span style="color: #002200;">:</span> <span style="color: #400080;">NSCoder</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">super</span>.<span style="color: #a61390;">init</span><span style="color: #002200;">&#40;</span>coder<span style="color: #002200;">:</span> aDecoder<span style="color: #002200;">&#41;</span><br>    <span style="color: #a61390;">let</span> layer <span style="color: #002200;">=</span> <span style="color: #a61390;">self</span>.layer <span style="color: #a61390;">as</span> CATiledLayer<br>    layer.tileSize <span style="color: #002200;">=</span> <span style="color: #400080;">CGSize</span><span style="color: #002200;">&#40;</span>width<span style="color: #002200;">:</span> sideLength, height<span style="color: #002200;">:</span> sideLength<span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 4</span><br>  <span style="color: #a61390;">override</span> <span style="color: #a61390;">func</span> drawRect<span style="color: #002200;">&#40;</span>rect<span style="color: #002200;">:</span> <span style="color: #400080;">CGRect</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">let</span> firstColumn <span style="color: #002200;">=</span> <span style="color: #a61390;">Int</span><span style="color: #002200;">&#40;</span>CGRectGetMinX<span style="color: #002200;">&#40;</span>rect<span style="color: #002200;">&#41;</span> <span style="color: #002200;">/</span> sideLength<span style="color: #002200;">&#41;</span><br>    <span style="color: #a61390;">let</span> lastColumn <span style="color: #002200;">=</span> <span style="color: #a61390;">Int</span><span style="color: #002200;">&#40;</span>CGRectGetMaxX<span style="color: #002200;">&#40;</span>rect<span style="color: #002200;">&#41;</span> <span style="color: #002200;">/</span> sideLength<span style="color: #002200;">&#41;</span><br>    <span style="color: #a61390;">let</span> firstRow <span style="color: #002200;">=</span> <span style="color: #a61390;">Int</span><span style="color: #002200;">&#40;</span>CGRectGetMinY<span style="color: #002200;">&#40;</span>rect<span style="color: #002200;">&#41;</span> <span style="color: #002200;">/</span> sideLength<span style="color: #002200;">&#41;</span><br>    <span style="color: #a61390;">let</span> lastRow <span style="color: #002200;">=</span> <span style="color: #a61390;">Int</span><span style="color: #002200;">&#40;</span>CGRectGetMaxY<span style="color: #002200;">&#40;</span>rect<span style="color: #002200;">&#41;</span> <span style="color: #002200;">/</span> sideLength<span style="color: #002200;">&#41;</span><br>&nbsp;<br>    <span style="color: #a61390;">for</span> row <span style="color: #a61390;">in</span> firstRow…lastRow <span style="color: #002200;">&#123;</span><br>      <span style="color: #a61390;">for</span> column <span style="color: #a61390;">in</span> firstColumn…lastColumn <span style="color: #002200;">&#123;</span><br>        <span style="color: #a61390;">if</span> <span style="color: #a61390;">let</span> tile <span style="color: #002200;">=</span> imageForTileAtColumn<span style="color: #002200;">&#40;</span>column, row<span style="color: #002200;">:</span> row<span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>          <span style="color: #a61390;">let</span> x <span style="color: #002200;">=</span> sideLength <span style="color: #002200;"><em></em></span> <span style="color: #400080;">CGFloat</span><span style="color: #002200;">&#40;</span>column<span style="color: #002200;">&#41;</span><br>          <span style="color: #a61390;">let</span> y <span style="color: #002200;">=</span> sideLength <span style="color: #002200;"></span> <span style="color: #400080;">CGFloat</span><span style="color: #002200;">&#40;</span>row<span style="color: #002200;">&#41;</span><br>          <span style="color: #a61390;">let</span> point <span style="color: #002200;">=</span> <span style="color: #400080;">CGPoint</span><span style="color: #002200;">&#40;</span>x<span style="color: #002200;">:</span> x, y<span style="color: #002200;">:</span> y<span style="color: #002200;">&#41;</span><br>          <span style="color: #a61390;">let</span> size <span style="color: #002200;">=</span> <span style="color: #400080;">CGSize</span><span style="color: #002200;">&#40;</span>width<span style="color: #002200;">:</span> sideLength, height<span style="color: #002200;">:</span> sideLength<span style="color: #002200;">&#41;</span><br>          <span style="color: #a61390;">var</span> tileRect <span style="color: #002200;">=</span> <span style="color: #400080;">CGRect</span><span style="color: #002200;">&#40;</span>origin<span style="color: #002200;">:</span> point, size<span style="color: #002200;">:</span> size<span style="color: #002200;">&#41;</span><br>          tileRect <span style="color: #002200;">=</span> CGRectIntersection<span style="color: #002200;">&#40;</span>bounds, tileRect<span style="color: #002200;">&#41;</span><br>          tile.drawInRect<span style="color: #002200;">&#40;</span>tileRect<span style="color: #002200;">&#41;</span><br>        <span style="color: #002200;">&#125;</span><br>      <span style="color: #002200;">&#125;</span><br>    <span style="color: #002200;">&#125;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #a61390;">func</span> imageForTileAtColumn<span style="color: #002200;">&#40;</span>column<span style="color: #002200;">:</span> <span style="color: #a61390;">Int</span>, row<span style="color: #002200;">:</span> <span style="color: #a61390;">Int</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">-</span>&gt; <span style="color: #400080;">UIImage</span>? <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">let</span> filePath <span style="color: #002200;">=</span> <span style="color: #bf1d1a;">&quot;<span style="color: #2400d9;">(</span>cachesPath)/<span style="color: #2400d9;">(</span>fileName)<em><span style="color: #2400d9;">(</span>column)</em><span style="color: #2400d9;">(</span>row)&quot;</span><br>    <span style="color: #a61390;">return</span> <span style="color: #400080;">UIImage</span><span style="color: #002200;">&#40;</span>contentsOfFile<span style="color: #002200;">:</span> filePath<span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br><span style="color: #002200;">&#125;</span></pre></td></tr></table></div><br><br><p>The above code:</p><br><ol><br><li>Creates properties for length of the tile side, base image filename, and the path to the caches directory where the TileCutter extension saves tiles. </li><br><li>Overrides <code>layerClass()</code> to return CATiledLayer. </li><br><li>Implements <code>init(_:)</code>, in the view&#8217;s layer, casts it as a tiled layer and sets its tile size. Note that it is not necessary to match <code>contentsScale</code> to the screen scale, because you&#8217;re working with the backing layer of the view directly vs. creating a new layer and adding it as a sublayer. </li><br><li>Overrides <code>drawRect()</code> to draw each tile according to its column and row position.</li><br></ol><br><p>Then a view of that subclass type, sized to the original image&#8217;s dimensions can be added to a scroll view:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/XcodeTilingViewForImageStoryboard.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/XcodeTilingViewForImageStoryboard-480x286.png" alt="XcodeTilingViewForImageStoryboard" width="480" height="286" class="aligncenter size-medium wp-image-91656" srcset="https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/XcodeTilingViewForImageStoryboard-480x286.png 480w, https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/XcodeTilingViewForImageStoryboard-700x417.png 700w, https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/XcodeTilingViewForImageStoryboard.png 1235w" sizes="(max-width: 480px) 100vw, 480px"></a></p><br><p>And voilà, you have buttery smooth scrolling of a large image (5120 x 3200 in this case), thanks to CATiledLayer:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATiledImageLayer.gif" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATiledImageLayer.gif" alt="CATiledImageLayer" width="332" height="500" class="aligncenter size-full wp-image-91663"></a></p><br><p>As you can see in the above animation, though, there is noticeable blockiness when fast-scrolling as individual tiles are drawn. Minimize this behavior by using smaller tiles (the tiles used in the above example were cut to 640 x 640) and by creating a custom CATiledLayer subclass and overriding <code>fadeDuration()</code> to return 0:</p><br><br><div class="wp_codebox"><table><tr id="p9048813"><td class="code" id="p90488code13"><pre class="swift" style="font-family:monospace;"><span style="color: #a61390;">class</span> TiledLayer<span style="color: #002200;">:</span> CATiledLayer <span style="color: #002200;">&#123;</span><br>&nbsp;<br>  <span style="color: #a61390;">override</span> <span style="color: #a61390;">class</span> <span style="color: #a61390;">func</span> fadeDuration<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">-</span>&gt; CFTimeInterval <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">return</span> <span style="color: #2400d9;">0.0</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br><span style="color: #002200;">&#125;</span></pre></td></tr></table></div><br><br><h2>示例8: CAShapeLayer</h2><br><p>CAShapeLayer makes use of scalable vector paths to draw, and it&#8217;s much faster than using images. Another part of the win here is that you&#8217;ll no longer need to provide images at regular, @2x and @3x sizes. w00t!</p><br><p>Additionally, you have a variety of properties at your disposal to customize line thickness, color, dashing, how lines join other lines, if the line intersects itself to form a closed area, and if that area should be filled and with what color. Here&#8217;s an example:</p><br><br><div class="wp_codebox"><table><tr id="p9048814"><td class="code" id="p90488code14"><pre class="swift" style="font-family:monospace;"><span style="color: #a61390;">import</span> UIKit<br>&nbsp;<br><span style="color: #a61390;">class</span> ViewController<span style="color: #002200;">:</span> <span style="color: #400080;">UIViewController</span> <span style="color: #002200;">&#123;</span><br>&nbsp;<br>  @IBOutlet weak <span style="color: #a61390;">var</span> someView<span style="color: #002200;">:</span> <span style="color: #400080;">UIView</span><span style="color: #002200;">!</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 1</span><br>  <span style="color: #a61390;">let</span> rwColor <span style="color: #002200;">=</span> <span style="color: #400080;">UIColor</span><span style="color: #002200;">&#40;</span>red<span style="color: #002200;">:</span> <span style="color: #2400d9;">11</span><span style="color: #002200;">/</span><span style="color: #2400d9;">255.0</span>, green<span style="color: #002200;">:</span> <span style="color: #2400d9;">86</span><span style="color: #002200;">/</span><span style="color: #2400d9;">255.0</span>, blue<span style="color: #002200;">:</span> <span style="color: #2400d9;">14</span><span style="color: #002200;">/</span><span style="color: #2400d9;">255.0</span>, alpha<span style="color: #002200;">:</span> <span style="color: #2400d9;">1.0</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #a61390;">let</span> rwPath <span style="color: #002200;">=</span> <span style="color: #400080;">UIBezierPath</span><span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #a61390;">let</span> rwLayer <span style="color: #002200;">=</span> CAShapeLayer<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 2</span><br>  <span style="color: #a61390;">func</span> setUpRWPath<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    rwPath.moveToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">0.22</span>, <span style="color: #2400d9;">124.79</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.addLineToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">0.22</span>, <span style="color: #2400d9;">249.57</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.addLineToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">124.89</span>, <span style="color: #2400d9;">249.57</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.addLineToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">249.57</span>, <span style="color: #2400d9;">249.57</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.addLineToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">249.57</span>, <span style="color: #2400d9;">143.79</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.addCurveToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">249.37</span>, <span style="color: #2400d9;">38.25</span><span style="color: #002200;">&#41;</span>, controlPoint1<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">249.57</span>, <span style="color: #2400d9;">85.64</span><span style="color: #002200;">&#41;</span>, controlPoint2<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">249.47</span>, <span style="color: #2400d9;">38.15</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.addCurveToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">206.47</span>, <span style="color: #2400d9;">112.47</span><span style="color: #002200;">&#41;</span>, controlPoint1<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">249.27</span>, <span style="color: #2400d9;">38.35</span><span style="color: #002200;">&#41;</span>, controlPoint2<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">229.94</span>, <span style="color: #2400d9;">71.76</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.addCurveToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">163.46</span>, <span style="color: #2400d9;">186.84</span><span style="color: #002200;">&#41;</span>, controlPoint1<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">182.99</span>, <span style="color: #2400d9;">153.19</span><span style="color: #002200;">&#41;</span>, controlPoint2<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">163.61</span>, <span style="color: #2400d9;">186.65</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.addCurveToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">146.17</span>, <span style="color: #2400d9;">156.99</span><span style="color: #002200;">&#41;</span>, controlPoint1<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">163.27</span>, <span style="color: #2400d9;">187.03</span><span style="color: #002200;">&#41;</span>, controlPoint2<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">155.48</span>, <span style="color: #2400d9;">173.59</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.addCurveToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">128.79</span>, <span style="color: #2400d9;">127.08</span><span style="color: #002200;">&#41;</span>, controlPoint1<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">136.82</span>, <span style="color: #2400d9;">140.43</span><span style="color: #002200;">&#41;</span>, controlPoint2<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">129.03</span>, <span style="color: #2400d9;">126.94</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.addCurveToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">109.31</span>, <span style="color: #2400d9;">157.77</span><span style="color: #002200;">&#41;</span>, controlPoint1<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">128.59</span>, <span style="color: #2400d9;">127.18</span><span style="color: #002200;">&#41;</span>, controlPoint2<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">119.83</span>, <span style="color: #2400d9;">141.01</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.addCurveToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">89.83</span>, <span style="color: #2400d9;">187.86</span><span style="color: #002200;">&#41;</span>, controlPoint1<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">98.79</span>, <span style="color: #2400d9;">174.52</span><span style="color: #002200;">&#41;</span>, controlPoint2<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">90.02</span>, <span style="color: #2400d9;">188.06</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.addCurveToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">56.52</span>, <span style="color: #2400d9;">108.28</span><span style="color: #002200;">&#41;</span>, controlPoint1<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">89.24</span>, <span style="color: #2400d9;">187.23</span><span style="color: #002200;">&#41;</span>, controlPoint2<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">56.56</span>, <span style="color: #2400d9;">109.11</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.addCurveToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">64.02</span>, <span style="color: #2400d9;">102.25</span><span style="color: #002200;">&#41;</span>, controlPoint1<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">56.47</span>, <span style="color: #2400d9;">107.75</span><span style="color: #002200;">&#41;</span>, controlPoint2<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">59.24</span>, <span style="color: #2400d9;">105.56</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.addCurveToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">101.42</span>, <span style="color: #2400d9;">67.57</span><span style="color: #002200;">&#41;</span>, controlPoint1<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">81.99</span>, <span style="color: #2400d9;">89.78</span><span style="color: #002200;">&#41;</span>, controlPoint2<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">93.92</span>, <span style="color: #2400d9;">78.72</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.addCurveToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">108.38</span>, <span style="color: #2400d9;">30.65</span><span style="color: #002200;">&#41;</span>, controlPoint1<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">110.28</span>, <span style="color: #2400d9;">54.47</span><span style="color: #002200;">&#41;</span>, controlPoint2<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">113.01</span>, <span style="color: #2400d9;">39.96</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.addCurveToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">10.35</span>, <span style="color: #2400d9;">0.41</span><span style="color: #002200;">&#41;</span>, controlPoint1<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">99.66</span>, <span style="color: #2400d9;">13.17</span><span style="color: #002200;">&#41;</span>, controlPoint2<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">64.11</span>, <span style="color: #2400d9;">2.16</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.addLineToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">0.22</span>, <span style="color: #2400d9;">0.07</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.addLineToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">0.22</span>, <span style="color: #2400d9;">124.79</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.closePath<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 3</span><br>  <span style="color: #a61390;">func</span> setUpRWLayer<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    rwLayer.path <span style="color: #002200;">=</span> rwPath.CGPath<br>    rwLayer.fillColor <span style="color: #002200;">=</span> rwColor.<span style="color: #400080;">CGColor</span><br>    rwLayer.fillRule <span style="color: #002200;">=</span> kCAFillRuleNonZero<br>    rwLayer.lineCap <span style="color: #002200;">=</span> kCALineCapButt<br>    rwLayer.lineDashPattern <span style="color: #002200;">=</span> <span style="color: #a61390;">nil</span><br>    rwLayer.lineDashPhase <span style="color: #002200;">=</span> <span style="color: #2400d9;">0.0</span><br>    rwLayer.lineJoin <span style="color: #002200;">=</span> kCALineJoinMiter<br>    rwLayer.lineWidth <span style="color: #002200;">=</span> <span style="color: #2400d9;">1.0</span><br>    rwLayer.miterLimit <span style="color: #002200;">=</span> <span style="color: #2400d9;">10.0</span><br>    rwLayer.strokeColor <span style="color: #002200;">=</span> rwColor.<span style="color: #400080;">CGColor</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #a61390;">override</span> <span style="color: #a61390;">func</span> viewDidLoad<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">super</span>.viewDidLoad<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>&nbsp;<br>    <span style="color: #11740a; font-style: italic;">// 4</span><br>    setUpRWPath<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>    setUpRWLayer<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>    someView.layer.addSublayer<span style="color: #002200;">&#40;</span>rwLayer<span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br><span style="color: #002200;">&#125;</span></pre></td></tr></table></div><br><br><p>Here&#8217;s the lowdown on the above code:</p><br><ol><br><li>Creates color, path, and shape layer objects.</li><br><li>Draws the shape layer&#8217;s path. If writing this sort of boilerplate drawing code is not your cup of tea, check out <a href="http://www.paintcodeapp.com" target="_blank" rel="external">PaintCode</a>; it generates the code for you by letting you draw using intuitive visual controls or import existing vector (SVG) or Photoshop (PSD) files. </li><br><li>Sets up the shape layer. Its path is set to the CGPath of the path drawn in step 2, its fill color to the CGColor of the color created in step 1, and the fill rule is explicitly set to the default value of non-zero.<br><ul><br><li>The only other option is even-odd, and for this shape that has no intersecting paths the fill rule makes little difference. </li><br><li>The non-zero rule counts left-to-right paths as +1 and right-to-left paths as -1; it adds up all values for paths and if the total is greater than 0, it fills the shape(s) formed by the paths. </li><br><li>Essentially, non-zero fills all points inside the shape. </li><br><li>The even-odd rule counts the total number of <i>path crossings</i> that form a shape and if the count is odd, that shape is filled. This is definitely a case when a picture is worth a thousand words. </li><br><p>The number of path crossings in the even-odd diagram that form the pentagon shape is even, so the pentagon is not filled, whereas the number path crossings that form each triangle is odd, so the triangles are filled.<br><br><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAShapeLayerFillRules.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAShapeLayerFillRules-480x256.png" alt="CAShapeLayerFillRules" width="480" height="256" class="aligncenter size-medium wp-image-91890" srcset="https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CAShapeLayerFillRules-480x256.png 480w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CAShapeLayerFillRules.png 676w" sizes="(max-width: 480px) 100vw, 480px"></a></p></ul></li><br><li>Calls the path drawing and layer set up code, and then it adds the layer to the view hierarchy. </li><br></ol><br><p>This code draws the raywenderlich.com logo:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/RayWenderlichLogo.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/RayWenderlichLogo-250x250.png" alt="RayWenderlichLogo" width="250" height="250" class="aligncenter size-thumbnail wp-image-91840" srcset="https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/RayWenderlichLogo-250x250.png 250w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/RayWenderlichLogo-320x320.png 320w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/RayWenderlichLogo-32x32.png 32w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/RayWenderlichLogo-64x64.png 64w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/RayWenderlichLogo-96x96.png 96w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/RayWenderlichLogo-128x128.png 128w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/RayWenderlichLogo.png 377w" sizes="(max-width: 250px) 100vw, 250px"></a></p><br><p>And in case you&#8217;re curious to know what this drawing looks like in <a href="http://www.paintcodeapp.com" target="_blank" rel="external">PaintCode</a>:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/PaintCodeRayWenderlichLogo.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/PaintCodeRayWenderlichLogo-480x265.png" alt="PaintCodeRayWenderlichLogo" width="480" height="265" class="aligncenter size-medium wp-image-91841" srcset="https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/PaintCodeRayWenderlichLogo-480x265.png 480w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/PaintCodeRayWenderlichLogo-700x387.png 700w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/PaintCodeRayWenderlichLogo.png 1280w" sizes="(max-width: 480px) 100vw, 480px"></a></p><br><p>Layer Player includes controls to manipulate many of CAShapeLayer&#8217;s properties:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAShapeLayer_5.5.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAShapeLayer_5.5-180x320.png" alt="CAShapeLayer_5.5" width="180" height="320" class="aligncenter size-medium wp-image-91843 bordered" srcset="https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/CAShapeLayer_5.5-180x320.png 180w, https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/CAShapeLayer_5.5-281x500.png 281w, https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/CAShapeLayer_5.5.png 1242w" sizes="(max-width: 180px) 100vw, 180px"></a></p><br><div class="note"><br><p><em>Note</em>: You may notice that we&#8217;re skipping over the next demo in the Layer Player app. This is because CAEAGLLayer is effectively obsoleted by CAMetalLayer, which debuted with iOS 8 alongside the Metal framework. You can find a great tutorial covering CAMetalLayer <a href="http://www.raywenderlich.com/77488/ios-8-metal-tutorial-swift-getting-started" title="iOS 8 Metal Tutorial with Swift: Getting Started" target="_blank" rel="external">here</a>.</p><br></div><br><h2>示例9: CATransformLayer</h2><br><p>CATransformLayer does not flatten its sublayer hierarchy like other layer classes, so it&#8217;s  handy for drawing 3D structures. It&#8217;s actually a container for its sublayers, and each sublayer can have its own transforms and opacity changes, however, it ignores changes to other rendered layer properties such as border width and color. </p><br><p>You cannot directly hit test a transform layer because it doesn&#8217;t have a 2D coordinate space to map a touch point to, however, it&#8217;s possible to hit test individual sublayers. Here&#8217;s an example:</p><br><br><div class="wp_codebox"><table><tr id="p9048815"><td class="code" id="p90488code15"><pre class="swift" style="font-family:monospace;"><span style="color: #a61390;">import</span> UIKit<br>&nbsp;<br><span style="color: #a61390;">class</span> ViewController<span style="color: #002200;">:</span> <span style="color: #400080;">UIViewController</span> <span style="color: #002200;">&#123;</span><br>&nbsp;<br>  @IBOutlet weak <span style="color: #a61390;">var</span> someView<span style="color: #002200;">:</span> <span style="color: #400080;">UIView</span><span style="color: #002200;">!</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 1</span><br>  <span style="color: #a61390;">let</span> sideLength <span style="color: #002200;">=</span> <span style="color: #400080;">CGFloat</span><span style="color: #002200;">&#40;</span><span style="color: #2400d9;">160.0</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #a61390;">var</span> redColor <span style="color: #002200;">=</span> <span style="color: #400080;">UIColor</span>.redColor<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #a61390;">var</span> orangeColor <span style="color: #002200;">=</span> <span style="color: #400080;">UIColor</span>.orangeColor<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #a61390;">var</span> yellowColor <span style="color: #002200;">=</span> <span style="color: #400080;">UIColor</span>.yellowColor<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #a61390;">var</span> greenColor <span style="color: #002200;">=</span> <span style="color: #400080;">UIColor</span>.greenColor<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #a61390;">var</span> blueColor <span style="color: #002200;">=</span> <span style="color: #400080;">UIColor</span>.blueColor<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #a61390;">var</span> purpleColor <span style="color: #002200;">=</span> <span style="color: #400080;">UIColor</span>.purpleColor<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #a61390;">var</span> transformLayer <span style="color: #002200;">=</span> CATransformLayer<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 2</span><br>  <span style="color: #a61390;">func</span> setUpTransformLayer<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">var</span> layer <span style="color: #002200;">=</span> sideLayerWithColor<span style="color: #002200;">&#40;</span>redColor<span style="color: #002200;">&#41;</span><br>    transformLayer.addSublayer<span style="color: #002200;">&#40;</span>layer<span style="color: #002200;">&#41;</span><br>&nbsp;<br>    layer <span style="color: #002200;">=</span> sideLayerWithColor<span style="color: #002200;">&#40;</span>orangeColor<span style="color: #002200;">&#41;</span><br>    <span style="color: #a61390;">var</span> transform <span style="color: #002200;">=</span> CATransform3DMakeTranslation<span style="color: #002200;">&#40;</span>sideLength <span style="color: #002200;">/</span> <span style="color: #2400d9;">2.0</span>, <span style="color: #2400d9;">0.0</span>, sideLength <span style="color: #002200;">/</span> <span style="color: #002200;">-</span><span style="color: #2400d9;">2.0</span><span style="color: #002200;">&#41;</span><br>    transform <span style="color: #002200;">=</span> CATransform3DRotate<span style="color: #002200;">&#40;</span>transform, degreesToRadians<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">90.0</span><span style="color: #002200;">&#41;</span>, <span style="color: #2400d9;">0.0</span>, <span style="color: #2400d9;">1.0</span>, <span style="color: #2400d9;">0.0</span><span style="color: #002200;">&#41;</span><br>    layer.transform <span style="color: #002200;">=</span> transform<br>    transformLayer.addSublayer<span style="color: #002200;">&#40;</span>layer<span style="color: #002200;">&#41;</span><br>&nbsp;<br>    layer <span style="color: #002200;">=</span> sideLayerWithColor<span style="color: #002200;">&#40;</span>yellowColor<span style="color: #002200;">&#41;</span><br>    layer.transform <span style="color: #002200;">=</span> CATransform3DMakeTranslation<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">0.0</span>, <span style="color: #2400d9;">0.0</span>, <span style="color: #002200;">-</span>sideLength<span style="color: #002200;">&#41;</span><br>    transformLayer.addSublayer<span style="color: #002200;">&#40;</span>layer<span style="color: #002200;">&#41;</span><br>&nbsp;<br>    layer <span style="color: #002200;">=</span> sideLayerWithColor<span style="color: #002200;">&#40;</span>greenColor<span style="color: #002200;">&#41;</span><br>    transform <span style="color: #002200;">=</span> CATransform3DMakeTranslation<span style="color: #002200;">&#40;</span>sideLength <span style="color: #002200;">/</span> <span style="color: #002200;">-</span><span style="color: #2400d9;">2.0</span>, <span style="color: #2400d9;">0.0</span>, sideLength <span style="color: #002200;">/</span> <span style="color: #002200;">-</span><span style="color: #2400d9;">2.0</span><span style="color: #002200;">&#41;</span><br>    transform <span style="color: #002200;">=</span> CATransform3DRotate<span style="color: #002200;">&#40;</span>transform, degreesToRadians<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">90.0</span><span style="color: #002200;">&#41;</span>, <span style="color: #2400d9;">0.0</span>, <span style="color: #2400d9;">1.0</span>, <span style="color: #2400d9;">0.0</span><span style="color: #002200;">&#41;</span><br>    layer.transform <span style="color: #002200;">=</span> transform<br>    transformLayer.addSublayer<span style="color: #002200;">&#40;</span>layer<span style="color: #002200;">&#41;</span><br>&nbsp;<br>    layer <span style="color: #002200;">=</span> sideLayerWithColor<span style="color: #002200;">&#40;</span>blueColor<span style="color: #002200;">&#41;</span><br>    transform <span style="color: #002200;">=</span> CATransform3DMakeTranslation<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">0.0</span>, sideLength <span style="color: #002200;">/</span> <span style="color: #002200;">-</span><span style="color: #2400d9;">2.0</span>, sideLength <span style="color: #002200;">/</span> <span style="color: #002200;">-</span><span style="color: #2400d9;">2.0</span><span style="color: #002200;">&#41;</span><br>    transform <span style="color: #002200;">=</span> CATransform3DRotate<span style="color: #002200;">&#40;</span>transform, degreesToRadians<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">90.0</span><span style="color: #002200;">&#41;</span>, <span style="color: #2400d9;">1.0</span>, <span style="color: #2400d9;">0.0</span>, <span style="color: #2400d9;">0.0</span><span style="color: #002200;">&#41;</span><br>    layer.transform <span style="color: #002200;">=</span> transform<br>    transformLayer.addSublayer<span style="color: #002200;">&#40;</span>layer<span style="color: #002200;">&#41;</span><br>&nbsp;<br>    layer <span style="color: #002200;">=</span> sideLayerWithColor<span style="color: #002200;">&#40;</span>purpleColor<span style="color: #002200;">&#41;</span><br>    transform <span style="color: #002200;">=</span> CATransform3DMakeTranslation<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">0.0</span>, sideLength <span style="color: #002200;">/</span> <span style="color: #2400d9;">2.0</span>, sideLength <span style="color: #002200;">/</span> <span style="color: #002200;">-</span><span style="color: #2400d9;">2.0</span><span style="color: #002200;">&#41;</span><br>    transform <span style="color: #002200;">=</span> CATransform3DRotate<span style="color: #002200;">&#40;</span>transform, degreesToRadians<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">90.0</span><span style="color: #002200;">&#41;</span>, <span style="color: #2400d9;">1.0</span>, <span style="color: #2400d9;">0.0</span>, <span style="color: #2400d9;">0.0</span><span style="color: #002200;">&#41;</span><br>    layer.transform <span style="color: #002200;">=</span> transform<br>    transformLayer.addSublayer<span style="color: #002200;">&#40;</span>layer<span style="color: #002200;">&#41;</span><br>&nbsp;<br>    transformLayer.anchorPointZ <span style="color: #002200;">=</span> sideLength <span style="color: #002200;">/</span> <span style="color: #002200;">-</span><span style="color: #2400d9;">2.0</span><br>    applyRotationForXOffset<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">16.0</span>, yOffset<span style="color: #002200;">:</span> <span style="color: #2400d9;">16.0</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 3</span><br>  <span style="color: #a61390;">func</span> sideLayerWithColor<span style="color: #002200;">&#40;</span>color<span style="color: #002200;">:</span> <span style="color: #400080;">UIColor</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">-</span>&gt; <span style="color: #400080;">CALayer</span> <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">let</span> layer <span style="color: #002200;">=</span> <span style="color: #400080;">CALayer</span><span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>    layer.frame <span style="color: #002200;">=</span> <span style="color: #400080;">CGRect</span><span style="color: #002200;">&#40;</span>origin<span style="color: #002200;">:</span> CGPointZero, size<span style="color: #002200;">:</span> <span style="color: #400080;">CGSize</span><span style="color: #002200;">&#40;</span>width<span style="color: #002200;">:</span> sideLength, height<span style="color: #002200;">:</span> sideLength<span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    layer.position <span style="color: #002200;">=</span> <span style="color: #400080;">CGPoint</span><span style="color: #002200;">&#40;</span>x<span style="color: #002200;">:</span> CGRectGetMidX<span style="color: #002200;">&#40;</span>someView.bounds<span style="color: #002200;">&#41;</span>, y<span style="color: #002200;">:</span> CGRectGetMidY<span style="color: #002200;">&#40;</span>someView.bounds<span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    layer.backgroundColor <span style="color: #002200;">=</span> color.<span style="color: #400080;">CGColor</span><br>    <span style="color: #a61390;">return</span> layer<br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #a61390;">func</span> degreesToRadians<span style="color: #002200;">&#40;</span>degrees<span style="color: #002200;">:</span> <span style="color: #a61390;">Double</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">-</span>&gt; <span style="color: #400080;">CGFloat</span> <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">return</span> <span style="color: #400080;">CGFloat</span><span style="color: #002200;">&#40;</span>degrees <span style="color: #002200;"><em></em></span> M_PI <span style="color: #002200;">/</span> <span style="color: #2400d9;">180.0</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 4</span><br>  <span style="color: #a61390;">func</span> applyRotationForXOffset<span style="color: #002200;">&#40;</span>xOffset<span style="color: #002200;">:</span> <span style="color: #a61390;">Double</span>, yOffset<span style="color: #002200;">:</span> <span style="color: #a61390;">Double</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">let</span> totalOffset <span style="color: #002200;">=</span> sqrt<span style="color: #002200;">&#40;</span>xOffset <span style="color: #002200;"></span> xOffset <span style="color: #002200;">+</span> yOffset <span style="color: #002200;"><em></em></span> yOffset<span style="color: #002200;">&#41;</span><br>    <span style="color: #a61390;">let</span> totalRotation <span style="color: #002200;">=</span> <span style="color: #400080;">CGFloat</span><span style="color: #002200;">&#40;</span>totalOffset <span style="color: #002200;"></span> M_PI <span style="color: #002200;">/</span> <span style="color: #2400d9;">180.0</span><span style="color: #002200;">&#41;</span><br>    <span style="color: #a61390;">let</span> xRotationalFactor <span style="color: #002200;">=</span> <span style="color: #400080;">CGFloat</span><span style="color: #002200;">&#40;</span>totalOffset<span style="color: #002200;">&#41;</span> <span style="color: #002200;">/</span> totalRotation<br>    <span style="color: #a61390;">let</span> yRotationalFactor <span style="color: #002200;">=</span> <span style="color: #400080;">CGFloat</span><span style="color: #002200;">&#40;</span>totalOffset<span style="color: #002200;">&#41;</span> <span style="color: #002200;">/</span> totalRotation<br>    <span style="color: #a61390;">let</span> currentTransform <span style="color: #002200;">=</span> CATransform3DTranslate<span style="color: #002200;">&#40;</span>transformLayer.sublayerTransform, <span style="color: #2400d9;">0.0</span>, <span style="color: #2400d9;">0.0</span>, <span style="color: #2400d9;">0.0</span><span style="color: #002200;">&#41;</span><br>    <span style="color: #a61390;">let</span> rotationTransform <span style="color: #002200;">=</span> CATransform3DRotate<span style="color: #002200;">&#40;</span>transformLayer.sublayerTransform, totalRotation,<br>      xRotationalFactor <span style="color: #002200;"><em></em></span> currentTransform.m12 <span style="color: #002200;">-</span> yRotationalFactor <span style="color: #002200;"></span> currentTransform.m11,<br>      xRotationalFactor <span style="color: #002200;"><em></em></span> currentTransform.m22 <span style="color: #002200;">-</span> yRotationalFactor <span style="color: #002200;"></span> currentTransform.m21,<br>      xRotationalFactor <span style="color: #002200;"><em></em></span> currentTransform.m32 <span style="color: #002200;">-</span> yRotationalFactor <span style="color: #002200;"></span> currentTransform.m31<span style="color: #002200;">&#41;</span><br>    transformLayer.sublayerTransform <span style="color: #002200;">=</span> rotationTransform<br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 5</span><br>  <span style="color: #a61390;">override</span> <span style="color: #a61390;">func</span> touchesBegan<span style="color: #002200;">&#40;</span>touches<span style="color: #002200;">:</span> <span style="color: #400080;">NSSet</span>, withEvent event<span style="color: #002200;">:</span> <span style="color: #400080;">UIEvent</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">if</span> <span style="color: #a61390;">let</span> location <span style="color: #002200;">=</span> touches.anyObject<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span>?.locationInView<span style="color: #002200;">&#40;</span>someView<span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>      <span style="color: #a61390;">for</span> layer <span style="color: #a61390;">in</span> transformLayer.sublayers <span style="color: #002200;">&#123;</span><br>        <span style="color: #a61390;">if</span> <span style="color: #a61390;">let</span> hitLayer <span style="color: #002200;">=</span> layer.hitTest<span style="color: #002200;">&#40;</span>location<span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>          <span style="color: #a61390;">println</span><span style="color: #002200;">&#40;</span><span style="color: #bf1d1a;">&quot;Transform layer tapped!&quot;</span><span style="color: #002200;">&#41;</span><br>          break<br>        <span style="color: #002200;">&#125;</span><br>      <span style="color: #002200;">&#125;</span><br>    <span style="color: #002200;">&#125;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #a61390;">override</span> <span style="color: #a61390;">func</span> viewDidLoad<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">super</span>.viewDidLoad<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>&nbsp;<br>    <span style="color: #11740a; font-style: italic;">// 6</span><br>    setUpTransformLayer<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>    someView.layer.addSublayer<span style="color: #002200;">&#40;</span>transformLayer<span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br><span style="color: #002200;">&#125;</span></pre></td></tr></table></div><br><br><p>The above code does all of this:</p><br><ol><br><li>Creates properties for side length, colors for each side of the cube, and a transform layer. </li><br><li>Builds the cube by creating, rotating and then adding each side to the transform layer. Then it sets the transform layer&#8217;s z axis anchor point, rotates the cube and adds the cube to the view hierarchy. </li><br><li>Creates helper code to create each cube side layer with the specified color and to convert degrees to radians. Why radians? Simply because I find it more intuitive to work with degrees than radians. :]</li><br><li>Applies a rotation based on specified x and y offsets. Notice that the code sets the transform to <code>sublayerTransform</code>, and that applies to the sublayers of the transform layer. </li><br><li>Observes touches and cycles through the sublayers of the transform layer. This section hit tests each one and breaks out as soon as a hit is detected, since there are no benefits to hit testing remaining layers. </li><br><li>Sets up the transform layer and adds it to the view hierarchy.</li><br></ol><br><div class="note"><br><p><em>Note</em>: So what&#8217;s with all those <code>currentTransform.m##</code>s? I&#8217;m glad you asked, sort of :]. These are CATransform3D properties that represent elements of a matrix that comprises a rectangular array of rows and columns.<br></p><br><p><br> To learn more about matrix transformations like those used in this example, check out <a href="https://github.com/jrturton/3DTransformFun" title="3DTransform Fun" target="_blank">3DTransformFun project</a> by fellow tutorial team member <a href="http://www.raywenderlich.com/u/jrturton" title="Rich Turton" target="_blank" rel="external">Rich Turton</a>  and <a href="https://github.com/mpospese/EnterTheMatrix" title="Enter The Matrix" target="_blank">Enter The Matrix project</a> by Mark Pospesel.<br></p><br></div><br><p>Running the above code with <code>someView</code> being a 250 x 250 view results in this:</p><br><p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATransformLayer-250x250.png" alt="CATransformLayer" width="250" height="250" class="aligncenter size-thumbnail wp-image-91859" srcset="https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATransformLayer-250x250.png 250w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATransformLayer-32x32.png 32w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATransformLayer-64x64.png 64w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATransformLayer-96x96.png 96w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATransformLayer-128x128.png 128w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATransformLayer.png 306w" sizes="(max-width: 250px) 100vw, 250px"></p><br><p>Now, try something: tap anywhere on the cube and &#8220;Transform layer tapped!&#8221; will print to the console. </p><br><p>Layer Player includes switches to toggle the opacity of each sublayer, and the <a href="http://bill.dudney.net/roller/objc/entry/trackball_3d_transforms_made_easy" title="TrackBall - 3D transforms made easy" target="_blank">TrackBall utility from Bill Dudney</a>, <a href="https://github.com/scotteg/TrackBall" title="Swift port of Bill Dudney's original TrackBall Objective-C source code" target="_blank">ported to Swift</a>, which makes it easy to apply 3D transforms based on user gestures:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATransformLayer_5.5.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATransformLayer_5.5-180x320.png" alt="CATransformLayer_5.5" width="180" height="320" class="aligncenter size-medium wp-image-91862 bordered" srcset="https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/CATransformLayer_5.5-180x320.png 180w, https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/CATransformLayer_5.5-281x500.png 281w, https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/CATransformLayer_5.5.png 1242w" sizes="(max-width: 180px) 100vw, 180px"></a></p><br><h2>示例10: CAEmitterLayer</h2><br><p>CAEmitterLayer renders animated particles that are instances of CAEmitterCell. Both CAEmitterLayer and CAEmitterCell have properties to change rendering rate, size, shape, color, velocity, lifetime and more. Here&#8217;s an example:</p><br><br><div class="wp_codebox"><table><tr id="p9048816"><td class="code" id="p90488code16"><pre class="swift" style="font-family:monospace;"><span style="color: #a61390;">import</span> UIKit<br>&nbsp;<br><span style="color: #a61390;">class</span> ViewController<span style="color: #002200;">:</span> <span style="color: #400080;">UIViewController</span> <span style="color: #002200;">&#123;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 1</span><br>  <span style="color: #a61390;">let</span> emitterLayer <span style="color: #002200;">=</span> CAEmitterLayer<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #a61390;">let</span> emitterCell <span style="color: #002200;">=</span> CAEmitterCell<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 2</span><br>  <span style="color: #a61390;">func</span> setUpEmitterLayer<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    emitterLayer.frame <span style="color: #002200;">=</span> view.bounds<br>    emitterLayer.seed <span style="color: #002200;">=</span> UInt32<span style="color: #002200;">&#40;</span><span style="color: #400080;">NSDate</span><span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span>.timeIntervalSince1970<span style="color: #002200;">&#41;</span><br>    emitterLayer.renderMode <span style="color: #002200;">=</span> kCAEmitterLayerAdditive<br>    emitterLayer.drawsAsynchronously <span style="color: #002200;">=</span> <span style="color: #a61390;">true</span><br>    setEmitterPosition<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 3</span><br>  <span style="color: #a61390;">func</span> setUpEmitterCell<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    emitterCell.contents <span style="color: #002200;">=</span> <span style="color: #400080;">UIImage</span><span style="color: #002200;">&#40;</span>named<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">&quot;smallStar&quot;</span><span style="color: #002200;">&#41;</span>?.CGImage<br>&nbsp;<br>    emitterCell.velocity <span style="color: #002200;">=</span> <span style="color: #2400d9;">50.0</span><br>    emitterCell.velocityRange <span style="color: #002200;">=</span> <span style="color: #2400d9;">500.0</span><br>&nbsp;<br>    emitterCell.color <span style="color: #002200;">=</span> <span style="color: #400080;">UIColor</span>.blackColor<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span>.<span style="color: #400080;">CGColor</span><br>    emitterCell.redRange <span style="color: #002200;">=</span> <span style="color: #2400d9;">1.0</span><br>    emitterCell.greenRange <span style="color: #002200;">=</span> <span style="color: #2400d9;">1.0</span><br>    emitterCell.blueRange <span style="color: #002200;">=</span> <span style="color: #2400d9;">1.0</span><br>    emitterCell.alphaRange <span style="color: #002200;">=</span> <span style="color: #2400d9;">0.0</span><br>    emitterCell.redSpeed <span style="color: #002200;">=</span> <span style="color: #2400d9;">0.0</span><br>    emitterCell.greenSpeed <span style="color: #002200;">=</span> <span style="color: #2400d9;">0.0</span><br>    emitterCell.blueSpeed <span style="color: #002200;">=</span> <span style="color: #2400d9;">0.0</span><br>    emitterCell.alphaSpeed <span style="color: #002200;">=</span> <span style="color: #002200;">-</span><span style="color: #2400d9;">0.5</span><br>&nbsp;<br>    <span style="color: #a61390;">let</span> zeroDegreesInRadians <span style="color: #002200;">=</span> degreesToRadians<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">0.0</span><span style="color: #002200;">&#41;</span><br>    emitterCell.spin <span style="color: #002200;">=</span> degreesToRadians<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">130.0</span><span style="color: #002200;">&#41;</span><br>    emitterCell.spinRange <span style="color: #002200;">=</span> zeroDegreesInRadians<br>    emitterCell.emissionRange <span style="color: #002200;">=</span> degreesToRadians<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">360.0</span><span style="color: #002200;">&#41;</span><br>&nbsp;<br>    emitterCell.lifetime <span style="color: #002200;">=</span> <span style="color: #2400d9;">1.0</span><br>    emitterCell.birthRate <span style="color: #002200;">=</span> <span style="color: #2400d9;">250.0</span><br>    emitterCell.xAcceleration <span style="color: #002200;">=</span> <span style="color: #002200;">-</span><span style="color: #2400d9;">800.0</span><br>    emitterCell.yAcceleration <span style="color: #002200;">=</span> <span style="color: #2400d9;">1000.0</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 4</span><br>  <span style="color: #a61390;">func</span> setEmitterPosition<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    emitterLayer.emitterPosition <span style="color: #002200;">=</span> <span style="color: #400080;">CGPoint</span><span style="color: #002200;">&#40;</span>x<span style="color: #002200;">:</span> CGRectGetMidX<span style="color: #002200;">&#40;</span>view.bounds<span style="color: #002200;">&#41;</span>, y<span style="color: #002200;">:</span> CGRectGetMidY<span style="color: #002200;">&#40;</span>view.bounds<span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #a61390;">func</span> degreesToRadians<span style="color: #002200;">&#40;</span>degrees<span style="color: #002200;">:</span> <span style="color: #a61390;">Double</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">-</span>&gt; <span style="color: #400080;">CGFloat</span> <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">return</span> <span style="color: #400080;">CGFloat</span><span style="color: #002200;">&#40;</span>degrees <span style="color: #002200;">*</span> M_PI <span style="color: #002200;">/</span> <span style="color: #2400d9;">180.0</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #a61390;">override</span> <span style="color: #a61390;">func</span> viewDidLoad<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">super</span>.viewDidLoad<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>&nbsp;<br>    <span style="color: #11740a; font-style: italic;">// 5</span><br>    setUpEmitterLayer<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>    setUpEmitterCell<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>    emitterLayer.emitterCells <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>emitterCell<span style="color: #002200;">&#93;</span><br>    view.layer.addSublayer<span style="color: #002200;">&#40;</span>emitterLayer<span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 6</span><br>  <span style="color: #a61390;">override</span> <span style="color: #a61390;">func</span> traitCollectionDidChange<span style="color: #002200;">&#40;</span>previousTraitCollection<span style="color: #002200;">:</span> UITraitCollection?<span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    setEmitterPosition<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br><span style="color: #002200;">&#125;</span></pre></td></tr></table></div><br><br><p>The above code:</p><br><ol><br><li>Creates an emitter layer and cell.<br></li><li>Sets up the emitter layer by doing the following:<br><ul><br><li>Provides a seed for the layer&#8217;s random number generator that in turn randomizes certain properties of the layer&#8217;s emitter cells, such as velocity. This is further explained in the next comment. </li><br><li>Renders emitter cells above the layer&#8217;s background color and border in an order specified by <code>renderMode</code>.<br><div class="note"><br><p><em>Note</em>:  Apple&#8217;s documentation currently incorrectly states that values for this property are defined under Emitter Modes. In fact, renderMode&#8217;s values are defined under Emitter Render Order. The default value is unordered, and additional options include oldest first, oldest last, back to front and additive. </p><br></div><br></li><br><li>Sets <code>drawsAsynchronously</code> to <code>true</code>, which may improve performance because the emitter layer must continuously redraw its emitter cells. </li><br><li>Next, the emitter position is set via a helper method &#8212; learn more on comment 4. This is a good case study for how setting <code>drawsAsynchronously</code> to <code>true</code> has a positive effect on performance and smoothness of animation.</li><br></ul><br></li><li>There&#8217;s a lot of action in this block!<br><ul><br><li>It sets up the emitter cell by setting its contents to an image (this image is available in the Layer Player project). </li><br><li>Then it specifies an initial velocity and max variance (<code>velocityRange</code>); the emitter layer uses the aforementioned seed to create a random number generator that randomizes values within the range (initial value +/- the range value). This randomization happens for any properties ending in <em>Range</em>.</li><br><li>The color is set to black to allow the variance (discussed below) to vary from the default of white, because white results in overly bright particles. </li><br><li>A series of color ranges are set next, using the same randomization as for <code>velocityRange</code>, this time to specify the range of variance to each color. Speed values dictate how quickly each color can change over the lifetime of the cell. </li><br><li>Next, block three specifies how to distribute the cells around a full circular cone. More detail: It sets the emitter cell&#8217;s spinning velocity and emission range. Furthermore, emission range determines how emitter cells are distributed around a cone that is defined by the <code>emissionRange</code> specified in radians.<br></li><li>Sets the cell&#8217;s lifetime to 1 second. This property&#8217;s default value is 0, so if you don&#8217;t explicitly set this, your cells never appear! Same goes for <code>birthRate</code> (per second); the default is 0, so this must be set to some positive number in order for cells to appear.<br></li><li>Lastly, cell x and y acceleration are set; these values affect the visual angle to which the particles emit.</li><br></ul><br></li><li>Makes helper methods to convert degrees to radians and to set the emitter cell position to the midpoint of the view.<br></li><li>Sets up the emitter layer and cell, and then adds that cell to the layer, and the layer to the view hierarchy.<br></li><li>This method, new in iOS 8, provides a way to handle changes to the current trait collection, such as when the device is rotated. Not familiar with trait collections? Check out Section 1 of <a href="http://www.raywenderlich.com/store/iOS-8-by-tutorials" title="iOS 8 by Tutorials" target="_blank">iOS 8 by Tutorials</a> and you&#8217;ll become a master of them :]</li><br></ol><br><p>Huzzah! I know that&#8217;s a lot of information, but you&#8217;re tough and smart.</p><br><p>The outcome of running the above code reminds me of those <a href="https://www.youtube.com/watch?v=oT0JWGPXnTg" title="Sean Hayes - The More You Know Commercial" target="_blank">The More You Know</a> commercials:</p><br><p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAEmitterLayer2.gif" alt="CAEmitterLayer2" width="350" height="242" class="aligncenter size-full wp-image-92125"></p><br><p>Layer Player includes controls to adjust all of the above-mentioned properties, and several more:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAEmitterLayer_5.5.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAEmitterLayer_5.5-180x320.png" alt="CAEmitterLayer_5.5" width="180" height="320" class="aligncenter size-medium wp-image-92127 bordered" srcset="https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/CAEmitterLayer_5.5-180x320.png 180w, https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/CAEmitterLayer_5.5-281x500.png 281w, https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/CAEmitterLayer_5.5.png 1242w" sizes="(max-width: 180px) 100vw, 180px"></a></p><br><p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/victorious-e1419192669236.png" alt="victorious" width="147" height="300" class="alignright size-full wp-image-92137"></p><br><br><br></html>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://yoursite.com/2016/09/19/CALayer开发指南/" data-title="CALayer开发指南 | 跳跳魔王的博客" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2016/09/21/XCode-8-新特性/" title="XCode 8 新特性">
  <strong>上一篇：</strong><br/>
  <span>
  XCode 8 新特性</span>
</a>
</div>


<div class="next">
<a href="/2016/09/14/UIStackView-使用指南/"  title="UIStackView 使用指南">
 <strong>下一篇：</strong><br/> 
 <span>UIStackView 使用指南
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2016/09/19/CALayer开发指南/" data-title="CALayer开发指南" data-url="http://yoursite.com/2016/09/19/CALayer开发指南/"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">1.</span> <span class="toc-text">开始</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">2.</span> <span class="toc-text">基本的 CALayer 属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">3.</span> <span class="toc-text">改变图层的外观</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">4.</span> <span class="toc-text">伟大的 CALayer 之旅</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">5.</span> <span class="toc-text">示例1: CALayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">6.</span> <span class="toc-text">示例2: CAScrollLayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">7.</span> <span class="toc-text">示例3: CATextLayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">8.</span> <span class="toc-text">示例4: AVPlayerLayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">9.</span> <span class="toc-text">示例5: CAGradientLayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">10.</span> <span class="toc-text">示例6: CAReplicatorLayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">11.</span> <span class="toc-text">示例7: CATiledLayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">12.</span> <span class="toc-text">示例8: CAShapeLayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">13.</span> <span class="toc-text">示例9: CATransformLayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">14.</span> <span class="toc-text">示例10: CAEmitterLayer</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  


  

  

  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="http://www.mhealth365.cn/" target="_blank" title="一款温暖的心电监测设备">熙健-掌上心电</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=null&verifier=&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> I&#39;m an iOS engineer <br/>
			Hala Madrid</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/2779746325" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2016 
		
		<a href="/about" target="_blank" title="跳跳魔王">跳跳魔王</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"ecgbao"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
