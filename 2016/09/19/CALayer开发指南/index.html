
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>CALayer开发指南 | 跳跳魔王的博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="跳跳魔王">
    

    
    <meta name="description" content="也许你知道, 你在iOS程序上看到的一切都是视图。 有按钮视图, 列表视图, 滑块视图, 甚至是包含其他视图的父视图。不过你可能不知道,每个视图都由一个叫做图层的类支持 – 一个特定的 CALayer 。 通过这篇文章, 你会了解 CALayer 是什么, 如何工作的。 你还会看到10个用 CALayers 实现的炫酷效果, 比如几何图形, 渐变, 甚至是粒子系统。这篇文章假设你会用Swift开发">
<meta property="og:type" content="article">
<meta property="og:title" content="CALayer开发指南">
<meta property="og:url" content="http://yoursite.com/2016/09/19/CALayer开发指南/index.html">
<meta property="og:site_name" content="跳跳魔王的博客">
<meta property="og:description" content="也许你知道, 你在iOS程序上看到的一切都是视图。 有按钮视图, 列表视图, 滑块视图, 甚至是包含其他视图的父视图。不过你可能不知道,每个视图都由一个叫做图层的类支持 – 一个特定的 CALayer 。 通过这篇文章, 你会了解 CALayer 是什么, 如何工作的。 你还会看到10个用 CALayers 实现的炫酷效果, 比如几何图形, 渐变, 甚至是粒子系统。这篇文章假设你会用Swift开发">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/LayersScreenshot-316x320.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/Xcode-CreateOutlet-700x215.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CALayerPlayground-1-179x320.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CALayerPlayground-2-179x320.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/Xcode-AddTapGestureRecognizer-700x478.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/Xcode-CreateAction-700x253.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CALayerPlayground-3-179x320.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2015/01/CaLayerTour-e1421621716326.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CALayerTourScenes-700x415.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CALayer-250x250.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CALayer_5.5-180x320.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAScrollLayer.gif">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer-250x250.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer-MiddleTruncation.png.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer-StartTruncation.png.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer-EndTruncation.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer_5.5-180x320.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/AVPlayerItem.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/AVLayerPlayer_5.5-180x320.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/AxialGradientLayerType.gif">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAGradientLayer-250x250.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAGradientLayer_5.5-180x320.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAReplicatorLayer.gif">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAReplicatorLayer_5.5-180x320.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayer-250x250.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayer_5.5-180x320.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayerZoomedBlurry-250x250.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayerZoomed-250x250.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/windingRoad-480x300.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/XcodeTilingViewForImageStoryboard-480x286.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATiledImageLayer.gif">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAShapeLayerFillRules-480x256.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/RayWenderlichLogo-250x250.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/PaintCodeRayWenderlichLogo-480x265.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAShapeLayer_5.5-180x320.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATransformLayer-250x250.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATransformLayer_5.5-180x320.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAEmitterLayer2.gif">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAEmitterLayer_5.5-180x320.png">
<meta property="og:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/victorious-e1419192669236.png">
<meta property="og:updated_time" content="2016-10-28T05:28:54.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CALayer开发指南">
<meta name="twitter:description" content="也许你知道, 你在iOS程序上看到的一切都是视图。 有按钮视图, 列表视图, 滑块视图, 甚至是包含其他视图的父视图。不过你可能不知道,每个视图都由一个叫做图层的类支持 – 一个特定的 CALayer 。 通过这篇文章, 你会了解 CALayer 是什么, 如何工作的。 你还会看到10个用 CALayers 实现的炫酷效果, 比如几何图形, 渐变, 甚至是粒子系统。这篇文章假设你会用Swift开发">
<meta name="twitter:image" content="http://www.raywenderlich.com/wp-content/uploads/2014/12/LayersScreenshot-316x320.png">

    
    <link rel="alternative" href="/atom.xml" title="跳跳魔王的博客" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="跳跳魔王的博客">跳跳魔王的博客</a></h1>
				<h2 class="blog-motto">每天进步一点点</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页</a></li>
					
						<li><a href="/archives">归档</a></li>
					
						<li><a href="/about">关于</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/09/19/CALayer开发指南/" title="CALayer开发指南" itemprop="url">CALayer开发指南</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="跳跳魔王" target="_blank" itemprop="author">跳跳魔王</a>
		
  <p class="article-time">
    <time datetime="2016-09-19T07:16:18.000Z" itemprop="datePublished"> 发表于 2016-09-19</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">1.</span> <span class="toc-text">开始</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">2.</span> <span class="toc-text">基本的 CALayer 属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">3.</span> <span class="toc-text">改变图层的外观</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">4.</span> <span class="toc-text">伟大的 CALayer 之旅</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">5.</span> <span class="toc-text">示例1: CALayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">6.</span> <span class="toc-text">示例2: CAScrollLayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">7.</span> <span class="toc-text">示例3: CATextLayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">8.</span> <span class="toc-text">示例4: AVPlayerLayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">9.</span> <span class="toc-text">示例5: CAGradientLayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">10.</span> <span class="toc-text">示例6: CAReplicatorLayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">11.</span> <span class="toc-text">示例7: CATiledLayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">12.</span> <span class="toc-text">示例8: CAShapeLayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">13.</span> <span class="toc-text">示例9: CATransformLayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">14.</span> <span class="toc-text">示例10: CAEmitterLayer</span></a></li></ol>
		
		</div>
		
		<html lang="en-US" class="no-js windows"><br><br><link rel="stylesheet" id="wpsqt-main-css" href="https://cdn3.raywenderlich.com/wp-content/plugins/wp-survey-and-quiz-tool/css/main.css?ver=4.5.2" type="text/css" media="all"><br><link rel="stylesheet" id="style-main-css" href="https://cdn4.raywenderlich.com/wp-content/themes/raywenderlich/style.min.css?ver=1471520796" type="text/css" media="all"><br><br><div id="attachment_114189" style="width: 260px" class="wp-caption alignright"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/LayersScreenshot-316x320.png" width="316" height="320" class="alignright size-medium wp-image-91873" srcset="https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/LayersScreenshot-316x320.png 316w, https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/LayersScreenshot-494x500.png 494w, https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/LayersScreenshot-32x32.png 32w, https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/LayersScreenshot-64x64.png 64w, https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/LayersScreenshot-96x96.png 96w, https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/LayersScreenshot.png 608w" sizes="(max-width: 316px) 100vw, 316px"></div><br><br><p>也许你知道, 你在iOS程序上看到的一切都是视图。 有按钮视图, 列表视图, 滑块视图, 甚至是包含其他视图的父视图。</p><br><p>不过你可能不知道,每个视图都由一个叫做图层的类支持 – 一个特定的 CALayer 。 </p><br><p>通过这篇文章, 你会了解 CALayer 是什么, 如何工作的。 你还会看到10个用 CALayers 实现的炫酷效果, 比如几何图形, 渐变, 甚至是粒子系统。</p><br><p>这篇文章假设你会用Swift开发iOS应用程序, 包括用故事板构造界面。 </p><br><br><h2>开始</h2><br><p>理解图层到底是什么的最容易的方法就是看他们怎么运行。 所以让我们从头创建一个简单的工程来玩转图层。</p><br><p>准备好写代码了吗? 不错! 启动 Xcode 并且:</p><br><ol><br><li>从菜单选择 <em>File\New\Project&#8230;</em> . </li><br><li>从对话框中选择 <em>iOS\Application\Single View Application</em> . </li><br><li>点击 <em>Next</em>, 输入 <em>CALayerPlayground</em> 作为产品名,输入机构名和标识符。 </li><br><li>选择 <em>Swift</em>作为开发语言同时选择  <em>Universal</em> . </li><br><li>不要选中 <em>Core Data</em> , 然后点击 <em>Next</em>. </li><br><li>给你的工程找个好位置 (我把工程放在一个叫 Source 的用户文件夹), 然后点击 <em>Create</em>.</li><br><p>好了, 现在文件创建好了,下一步是创建一个视图:</p><br><li>在 Project navigator, 选择 <em>Main.storyboard</em>. </li><br><li>从菜单中选择 <em>View\Assistant Editor\Show Assistant Editor</em> , 如果没有显示出来就选择 <em>View\Utilities\Show Object Library</em> . </li><br><li>也可以选择 <em>Editor\Canvas\Show Bounds Rectangles</em>, 这样你会看到将要加入scene的视图边界轮廓。 </li><br><li>从 Object library 中, 拖一个视图到 View Controller Scene. 选中它, 去 Size inspector (<em>View\Utilities\Show Size Inspector</em>)设置 <em>x</em> 和 <em>y</em> 为 <em>150</em> , <em>width</em> 和 <em>height</em> 为 <em>300</em>. </li><br><li>保持视图选中, 点击自动布局工具条上的 <em>Align</em> 按钮 (故事板右下方) 选中 <em>Horizontal Center in Container</em> 和 <em>Vertical Center in Container</em>, 两个值都设为 <em>0</em>, 然后点击 <em>Add 2 Constraints</em>. </li><br><li>点击 <em>Pin</em> 按钮, 选中 <em>Width</em> 和 <em>Height</em>, 确保两个值都设成 <em>300</em>, 点击 <em>Add 2 Constraints</em>.</li><br></ol><br><p>最后, 按住control拖住在 <em>ViewController.swift</em> 创建的视图, 拖到 <code>viewDidLoad()</code> 方法上面。 弹出提示给出的outlet 名字是 <em>viewForLayer</em>. 你的 Xcode 看起来是这样:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/Xcode-CreateOutlet.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/Xcode-CreateOutlet-700x215.png" width="700" height="215" class="aligncenter size-large wp-image-90649" srcset="https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/Xcode-CreateOutlet-700x215.png 700w, https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/Xcode-CreateOutlet-480x147.png 480w, https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/Xcode-CreateOutlet.png 1404w" sizes="(max-width: 700px) 100vw, 700px"></a></p><br><p>点击 <em>Connect</em> 创建 outlet. </p><br><p>用下面的代码替换 <em>ViewController.swift</em> 的内容:</p><br><br><div class="wp_codebox"><table><tr id="p904881"><td class="code" id="p90488code1"><pre class="swift" style="font-family:monospace;"><span style="color: #a61390;">import</span> UIKit<br>&nbsp;<br><span style="color: #a61390;">class</span> ViewController<span style="color: #002200;">:</span> <span style="color: #400080;">UIViewController</span> <span style="color: #002200;">&#123;</span><br>&nbsp;<br>  @IBOutlet weak <span style="color: #a61390;">var</span> viewForLayer<span style="color: #002200;">:</span> <span style="color: #400080;">UIView</span><span style="color: #002200;">!</span><br>&nbsp;<br>  <span style="color: #a61390;">var</span> l<span style="color: #002200;">:</span> <span style="color: #400080;">CALayer</span> <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">return</span> viewForLayer.layer<br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #a61390;">override</span> <span style="color: #a61390;">func</span> viewDidLoad<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">super</span>.viewDidLoad<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>    setUpLayer<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #a61390;">func</span> setUpLayer<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    l.backgroundColor <span style="color: #002200;">=</span> <span style="color: #400080;">UIColor</span>.blueColor<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span>.<span style="color: #400080;">CGColor</span><br>    l.borderWidth <span style="color: #002200;">=</span> <span style="color: #2400d9;">100.0</span><br>    l.borderColor <span style="color: #002200;">=</span> <span style="color: #400080;">UIColor</span>.redColor<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span>.<span style="color: #400080;">CGColor</span><br>    l.shadowOpacity <span style="color: #002200;">=</span> <span style="color: #2400d9;">0.7</span><br>    l.shadowRadius <span style="color: #002200;">=</span> <span style="color: #2400d9;">10.0</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br><span style="color: #002200;">&#125;</span></pre></td></tr></table></div><br><br><p>正如前面提到的, 每个视图都有一个图层, 你可以用 <code>yourView.layer</code> 获取这个图层。 这个代码首先做的是创建一个计算属性”l” (小写的 L) 来访问 <code>viewForLayer</code> 的图层, 这个可以节省你写后续代码的敲击。 </p><br><p> <code>setUpLayer</code> 负责给图层设置一些属性; 阴影, 蓝色的背景, 红色大边框。 稍后你会了解更多 <code>setUpLayer()</code> , 不过先编译运行模拟器来查看你的自定义图层 (我选的是 <em>iPhone 6</em>) :</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/CALayerPlayground-1.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CALayerPlayground-1-179x320.png" width="179" height="320" class="aligncenter size-medium wp-image-90653 bordered" srcset="https://cdn3.raywenderlich.com/wp-content/uploads/2014/12/CALayerPlayground-1-179x320.png 179w, https://cdn3.raywenderlich.com/wp-content/uploads/2014/12/CALayerPlayground-1-281x500.png 281w" sizes="(max-width: 179px) 100vw, 179px"></a></p><br><p>几行代码的效果很酷吧,  因为每个视图背后都有图层, 你可以在程序 <i>任意</i> 视图中做这些。 我们来仔细看一下。</p><br><h2>基本的 CALayer 属性</h2><br><p>CALayer 有几个属让你可以自定义它的外观。 回想一下你前面做过的:</p><br><ul><br><li>背景色从无到蓝色<br></li><li>把边框宽度从0改成100<br></li><li>把边框色从黑色变成红色<br></li><li>最后, 改变阴影透明度的值到0.7; 这会产生阴影效果, 你可以进一步把它的阴影半径从3改成10。</li><br></ul><br><p>CALayer 仅有几个属性可以设置。 我们再试两个。 在<code>setUpLayer()</code> 下添加下面几行代码:</p><br><br><div class="wp_codebox"><table><tr id="p904882"><td class="code" id="p90488code2"><pre class="swift" style="font-family:monospace;">l.contents <span style="color: #002200;">=</span> <span style="color: #400080;">UIImage</span><span style="color: #002200;">&#40;</span>named<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">&quot;star&quot;</span><span style="color: #002200;">&#41;</span>?.CGImage<br>l.contentsGravity <span style="color: #002200;">=</span> kCAGravityCenter</pre></td></tr></table></div><br><br><p> <code>contents</code> 属性允许你给图层内容设置图片, 所以这里你给它设了图片叫 &#8220;star&#8221;. 对于这个工作, 你要先把图片加到你的工程里,  <a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/star.png" title="Star image" download="star.png" target="_blank" rel="external">下载我做的星星图片</a> 然后添加到你的工程里。</p><br><p>编译运行程序, 欣赏一会这件艺术品: </p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/CALayerPlayground-2.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CALayerPlayground-2-179x320.png" width="179" height="320" class="aligncenter size-medium wp-image-90655 bordered" srcset="https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CALayerPlayground-2-179x320.png 179w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CALayerPlayground-2-281x500.png 281w" sizes="(max-width: 179px) 100vw, 179px"></a></p><br><p>注意星星是如何居中的 &#8211; 这是你因为把 <code>contentsGravity</code> 属性设置成了 <code>kCAGravityCenter</code>. 如你所愿, 你可以改变它的重心为上, 右上, 右, 右下, 下,左下, 左和左上。 </p><br><h2>改变图层的外观</h2><br><p>仅仅为了好玩, 我们添加一些手势来操作图层的外观。 在 Xcode 里, 拖一个点击手势到 <code>viewForLayer</code> . 仅供参考, 添加点击手势应该是这个样子的:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/Xcode-AddTapGestureRecognizer.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/Xcode-AddTapGestureRecognizer-700x478.png" width="700" height="478" class="aligncenter size-large wp-image-90656" srcset="https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/Xcode-AddTapGestureRecognizer-700x478.png 700w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/Xcode-AddTapGestureRecognizer-468x320.png 468w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/Xcode-AddTapGestureRecognizer.png 1109w" sizes="(max-width: 700px) 100vw, 700px"></a></p><br><div class="note"><br><p><em>备注</em>: 如果你不熟悉手势, 可以查看 <a href="http://www.raywenderlich.com/76020/using-uigesturerecognizer-with-swift-tutorial" title="Using UIGestureRecognizer with Swift" target="_blank" rel="external"> Using UIGestureRecognizer with Swift</a>. </p><br></div><br><p>重复步骤添加一个捏合手势到 <code>viewForLayer</code> .</p><br><p>然后按住 control拖动每个手势到<em>ViewController.swift</em>, 一个接着一个, 把它们放<code>setUpLayer()</code> 和类的大括号之间。 </p><br><p>在弹出框里, 把连接按钮改成 <em>Action</em> 命名点击手势名为 <code>tapGestureRecognized</code> , 捏合手势名为 <code>pinchGestureRecognized</code>. 例如:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/Xcode-CreateAction.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/Xcode-CreateAction-700x253.png" width="700" height="253" class="aligncenter size-large wp-image-90658" srcset="https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/Xcode-CreateAction-700x253.png 700w, https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/Xcode-CreateAction-480x173.png 480w, https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/Xcode-CreateAction.png 1102w" sizes="(max-width: 700px) 100vw, 700px"></a></p><br><p>修改 <code>tapGestureRecognized(_:)</code> 像这样:</p><br><br><div class="wp_codebox"><table><tr id="p904883"><td class="code" id="p90488code3"><pre class="swift" style="font-family:monospace;">@IBAction <span style="color: #a61390;">func</span> tapGestureRecognized<span style="color: #002200;">&#40;</span>sender<span style="color: #002200;">:</span> <span style="color: #400080;">UITapGestureRecognizer</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>  l.shadowOpacity <span style="color: #002200;">=</span> l.shadowOpacity <span style="color: #002200;">==</span> <span style="color: #2400d9;">0.7</span> ? <span style="color: #2400d9;">0.0</span> <span style="color: #002200;">:</span> <span style="color: #2400d9;">0.7</span><br><span style="color: #002200;">&#125;</span></pre></td></tr></table></div><br><br><p>这是告诉 <code>viewForLayer</code> 点击时在0.7和0的阴影不透明度之间切换图层的阴影。 </p><br><p>你说的这个视图? 重写 CALayer&#8217;的 <code>hitTest(<em>:)</em></code> 方法也可以实现, 实际上在文章的后面你会看到这个方法。 不过这里是上面方法的逻辑:  hit testing 是图层唯一可以做的, 因为它不响应手势。 这就是为什么你要在视图上添加手势T。 </p><br><p>现在修改 <code>pinchGestureRecognized(:)</code> 像这样:</p><br><br><div class="wp_codebox"><table><tr id="p904884"><td class="code" id="p90488code4"><pre class="swift" style="font-family:monospace;">@IBAction <span style="color: #a61390;">func</span> pinchGestureRecognized<span style="color: #002200;">&#40;</span>sender<span style="color: #002200;">:</span> UIPinchGestureRecognizer<span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>  <span style="color: #a61390;">let</span> offset<span style="color: #002200;">:</span> <span style="color: #400080;">CGFloat</span> <span style="color: #002200;">=</span> sender.scale &lt; <span style="color: #2400d9;">1</span> ? <span style="color: #2400d9;">5.0</span> <span style="color: #002200;">:</span> <span style="color: #002200;">-</span><span style="color: #2400d9;">5.0</span><br>  <span style="color: #a61390;">let</span> oldFrame <span style="color: #002200;">=</span> l.frame<br>  <span style="color: #a61390;">let</span> oldOrigin <span style="color: #002200;">=</span> oldFrame.origin<br>  <span style="color: #a61390;">let</span> newOrigin <span style="color: #002200;">=</span> <span style="color: #400080;">CGPoint</span><span style="color: #002200;">&#40;</span>x<span style="color: #002200;">:</span> oldOrigin.x <span style="color: #002200;">+</span> offset, y<span style="color: #002200;">:</span> oldOrigin.y <span style="color: #002200;">+</span> offset<span style="color: #002200;">&#41;</span><br>  <span style="color: #a61390;">let</span> newSize <span style="color: #002200;">=</span> <span style="color: #400080;">CGSize</span><span style="color: #002200;">&#40;</span>width<span style="color: #002200;">:</span> oldFrame.width <span style="color: #002200;">+</span> <span style="color: #002200;">&#40;</span>offset <span style="color: #002200;"><em></em></span> <span style="color: #002200;">-</span><span style="color: #2400d9;">2.0</span><span style="color: #002200;">&#41;</span>, height<span style="color: #002200;">:</span> oldFrame.height <span style="color: #002200;">+</span> <span style="color: #002200;">&#40;</span>offset <span style="color: #002200;"></span> <span style="color: #002200;">-</span><span style="color: #2400d9;">2.0</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #a61390;">let</span> newFrame <span style="color: #002200;">=</span> <span style="color: #400080;">CGRect</span><span style="color: #002200;">&#40;</span>origin<span style="color: #002200;">:</span> newOrigin, size<span style="color: #002200;">:</span> newSize<span style="color: #002200;">&#41;</span><br>  <span style="color: #a61390;">if</span> newFrame.width &gt;<span style="color: #002200;">=</span> <span style="color: #2400d9;">100.0</span> <span style="color: #002200;">&amp;&amp;</span> newFrame.width &lt;<span style="color: #002200;">=</span> <span style="color: #2400d9;">300.0</span> <span style="color: #002200;">&#123;</span><br>    l.borderWidth <span style="color: #002200;">-=</span> offset<br>    l.cornerRadius <span style="color: #002200;">+=</span> <span style="color: #002200;">&#40;</span>offset <span style="color: #002200;">/</span> <span style="color: #2400d9;">2.0</span><span style="color: #002200;">&#41;</span><br>    l.frame <span style="color: #002200;">=</span> newFrame<br>  <span style="color: #002200;">&#125;</span><br><span style="color: #002200;">&#125;</span></pre></td></tr></table></div><br><br><p>你在这里基于用户捏合创建了正负偏移量, 然后调整图层区域的尺寸,边框的宽度和圆角半径。 </p><br><p>图层的圆角半径默认为0, 是个90度圆角的标准矩形。 增加半径创建圆角。 想把正方形变成圆吗? 把圆角半径设置为宽度的一半就可以了。 </p><br><p>注意,调整圆角半径并不会裁剪图层的内容 (星星图片) 除非图层的 <code>masksToBounds</code> 属性设置成 <code>true</code>.</p><br><p>编译运行, 试着单击和捏合视图:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/CALayerPlayground-3.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CALayerPlayground-3-179x320.png" width="179" height="320" class="aligncenter size-medium wp-image-90661 bordered" srcset="https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CALayerPlayground-3-179x320.png 179w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CALayerPlayground-3-281x500.png 281w" sizes="(max-width: 179px) 100vw, 179px"></a></p><br><p>嗨, 慢慢打磨,你可以成为一个不错的头像制造商! :]</p><br><h2>伟大的 CALayer 之旅</h2><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2015/01/CaLayerTour-e1421621716326.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2015/01/CaLayerTour-e1421621716326.png" width="441" height="423" class="aligncenter size-full wp-image-93973" srcset="https://cdn4.raywenderlich.com/wp-content/uploads/2015/01/CaLayerTour-e1421621716326.png 441w, https://cdn4.raywenderlich.com/wp-content/uploads/2015/01/CaLayerTour-e1421621716326-334x320.png 334w, https://cdn4.raywenderlich.com/wp-content/uploads/2015/01/CaLayerTour-e1421621716326-32x32.png 32w" sizes="(max-width: 441px) 100vw, 441px"></a> </p><br><p>CALayer 已经多了一些属性和方法, 以及一些拥有特定属性和方法的子类。 </p><br><p>对于剩下的文章, 你会需要下面的:</p><br><ul><br><li><a href="http://bit.ly/AppStoreLayerPlayer" title="Layer Player on App Store" target="_blank">The Layer Player App</a></li><br><li><a href="http://bit.ly/LayerPlayer" title="Layer Player at GitHub" target="_blank">The Layer Player Source Code</a></li><br></ul><br><p>这个程序包含10种不同 CALayers 的示例, 这些示例你会在文章里学到。 这是10个示例的预览:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/CALayerTourScenes.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CALayerTourScenes-700x415.png" width="700" height="415" class="aligncenter size-large wp-image-92164 bordered" srcset="https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/CALayerTourScenes-700x415.png 700w, https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/CALayerTourScenes-480x284.png 480w" sizes="(max-width: 700px) 100vw, 700px"></a></p><br><p>通过下面的例子, 我建议你在 CALayer 程序中玩玩,选择性的看一些源码。 剩余的文章你不需要编码, 坐下来阅读吧 :]</p><br><p>这里有一些很棒的示例你可以添加不同类型 CALayers 到你的工程。 希望你喜欢!</p><br><h2>示例1: CALayer</h2><br><p>你已经看过一个使用 CALayer 的示例, 并且设置了一些属性。 </p><br><p>这里有一些关于 CALayers 的事我还没有提及:</p><br><ul><br><li><em>图层可以有子图层</em>. 就像视图有子视图, 图层也有子图层。 你可以用这个实现一些炫酷的效果!</li><br><li><em>图层属性是动画的</em>. 当你改变一个图层的属性时, 默认它会随着时间产生动画。 你也可以按照自己的时机定制动画。</li><br><li><em>图层是轻量级的</em>. 图层比视图轻量级, 因此它们可以帮你实现更好的效果。</li><br><li><em>图层有很多有用的属性.</em> 你已经看到一些了, 不过让我们再看一些!</li><br></ul><br><p>如你早前看到的, 图层有很多有用的属性。 让我浏览完整的 CALayer 属性列表 &#8211; 一些你没有看过的但是很便捷的!</p><br><br><div class="wp_codebox"><table><tr id="p904885"><td class="code" id="p90488code5"><pre class="swift" style="font-family:monospace;"><span style="color: #11740a; font-style: italic;">// 1</span><br><span style="color: #a61390;">let</span> layer <span style="color: #002200;">=</span> <span style="color: #400080;">CALayer</span><span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>layer.frame <span style="color: #002200;">=</span> someView.bounds<br>&nbsp;<br><span style="color: #11740a; font-style: italic;">// 2</span><br>layer.contents <span style="color: #002200;">=</span> <span style="color: #400080;">UIImage</span><span style="color: #002200;">&#40;</span>named<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">&quot;star&quot;</span><span style="color: #002200;">&#41;</span>?.CGImage<br>layer.contentsGravity <span style="color: #002200;">=</span> kCAGravityCenter<br>&nbsp;<br><span style="color: #11740a; font-style: italic;">// 3</span><br>layer.magnificationFilter <span style="color: #002200;">=</span> kCAFilterLinear<br>layer.geometryFlipped <span style="color: #002200;">=</span> <span style="color: #a61390;">false</span><br>&nbsp;<br><span style="color: #11740a; font-style: italic;">// 4</span><br>layer.backgroundColor <span style="color: #002200;">=</span> <span style="color: #400080;">UIColor</span><span style="color: #002200;">&#40;</span>red<span style="color: #002200;">:</span> <span style="color: #2400d9;">11</span><span style="color: #002200;">/</span><span style="color: #2400d9;">255.0</span>, green<span style="color: #002200;">:</span> <span style="color: #2400d9;">86</span><span style="color: #002200;">/</span><span style="color: #2400d9;">255.0</span>, blue<span style="color: #002200;">:</span> <span style="color: #2400d9;">14</span><span style="color: #002200;">/</span><span style="color: #2400d9;">255.0</span>, alpha<span style="color: #002200;">:</span> <span style="color: #2400d9;">1.0</span><span style="color: #002200;">&#41;</span>.<span style="color: #400080;">CGColor</span><br>layer.opacity <span style="color: #002200;">=</span> <span style="color: #2400d9;">1.0</span><br>layer.hidden <span style="color: #002200;">=</span> <span style="color: #a61390;">false</span><br>layer.masksToBounds <span style="color: #002200;">=</span> <span style="color: #a61390;">false</span><br>&nbsp;<br><span style="color: #11740a; font-style: italic;">// 5</span><br>layer.cornerRadius <span style="color: #002200;">=</span> <span style="color: #2400d9;">100.0</span><br>layer.borderWidth <span style="color: #002200;">=</span> <span style="color: #2400d9;">12.0</span><br>layer.borderColor <span style="color: #002200;">=</span> <span style="color: #400080;">UIColor</span>.whiteColor<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span>.<span style="color: #400080;">CGColor</span><br>&nbsp;<br><span style="color: #11740a; font-style: italic;">// 6</span><br>layer.shadowOpacity <span style="color: #002200;">=</span> <span style="color: #2400d9;">0.75</span><br>layer.shadowOffset <span style="color: #002200;">=</span> <span style="color: #400080;">CGSize</span><span style="color: #002200;">&#40;</span>width<span style="color: #002200;">:</span> <span style="color: #2400d9;">0</span>, height<span style="color: #002200;">:</span> <span style="color: #2400d9;">3</span><span style="color: #002200;">&#41;</span><br>layer.shadowRadius <span style="color: #002200;">=</span> <span style="color: #2400d9;">3.0</span><br>someView.layer.addSublayer<span style="color: #002200;">&#40;</span>layer<span style="color: #002200;">&#41;</span></pre></td></tr></table></div><br><br><p>在上面的代码里:</p><br><ol><br><li>创建一个 CALayer 实例并把他设置成 <code>someView</code> 的边界.</li><br><li>给图层设置一张图片作为内容并居中。 注意用下面的图片数据  (<code>CGImage</code>) 赋值. </li><br><li>通过<code>contentsGravity</code>放大图片时使用过滤器, 可以同时改变大小 (resize, resize aspect, and resize aspect fill) 和 位置 (center, top, top-right, right, etc.). </li><br><p>前面的变化没有动画效果, 如果 <code>geometryFlipped</code> 没有设置成 <code>true</code>, 几何位置和阴影会是颠倒的。继续: </p><br><li>你设置了背景色是蕾最喜欢的绿色阴影 :] 并且让图层变的不透明可见。 同时, 你让视图不要遮挡它的内容, 意思是如果它的尺寸小于它的内容 (星星图), 图片不会被裁剪。 </li><br><li>图层的圆角半径设成宽度的一半可以创造圆形边框的视觉效果; 注意图层颜色用 Quartz 颜色赋值 (<code>CGColor</code>).</li><br><li>创建阴影同时设置 <code>shouldRasterize</code> 为 <code>true</code> (下面讨论), 然后把图层添加到视图结构。</li><br></ol><br><p>这是运行结果:</p><br><p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CALayer-250x250.png" width="250" height="250" class="aligncenter size-thumbnail wp-image-90712" srcset="https://cdn3.raywenderlich.com/wp-content/uploads/2014/12/CALayer-250x250.png 250w, https://cdn3.raywenderlich.com/wp-content/uploads/2014/12/CALayer-320x320.png 320w, https://cdn3.raywenderlich.com/wp-content/uploads/2014/12/CALayer-500x500.png 500w, https://cdn3.raywenderlich.com/wp-content/uploads/2014/12/CALayer-32x32.png 32w, https://cdn3.raywenderlich.com/wp-content/uploads/2014/12/CALayer-64x64.png 64w, https://cdn3.raywenderlich.com/wp-content/uploads/2014/12/CALayer-96x96.png 96w, https://cdn3.raywenderlich.com/wp-content/uploads/2014/12/CALayer-128x128.png 128w, https://cdn3.raywenderlich.com/wp-content/uploads/2014/12/CALayer.png 800w" sizes="(max-width: 250px) 100vw, 250px"></p><br><p>CALayer 有两个额外的属性可以提高性能: <code>shouldRasterize</code> 和 <code>drawsAsynchronously</code>. </p><br><p><code>shouldRasterize</code> 默认是 <code>false</code> , 当被设置成 <code>true</code> 它可以提升性能高, 因为图层内容只需要渲染一次就够了。 对于在屏幕上展示动画而又不需要改变外观的对象来说这是完美的。 </p><br><p><code>drawsAsynchronously</code> 是 <code>shouldRasterize</code> 相反的一种属性。 它的值默认也是 <code>false</code> . 把它设置成 <code>true</code> ,在内容必须重复绘制时能提升性能, 比如当你使用发射器图层不断渲染动画颗粒的时候。) </p><br><div class="note"><br><p><em>一个警告</em>: 把图层的 <code>shouldRasterize</code> 或者 <code>drawsAsynchronously</code> 值设置成true 之前要考虑清楚它的影响。 比较值为真假时候的性能,这样你会明白是否需要开启这些特性去提升性能。 如果滥用, 性能可能会急剧下降。<br></p></div><br><p>现在暂时转移注意力到 Layer Player. 它包含可以操作CALayer 属性的很多控件:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/CALayer_5.5.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CALayer_5.5-180x320.png" width="180" height="320" class="aligncenter size-medium wp-image-91212 bordered" srcset="https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/CALayer_5.5-180x320.png 180w, https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/CALayer_5.5-281x500.png 281w, https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/CALayer_5.5.png 1242w" sizes="(max-width: 180px) 100vw, 180px"></a></p><br><p>玩玩这些控件; 这是感受 CALayer 可以做什么的一种很好的方式!</p><br><div class="note"><em>备注:</em> 图层不是响应链的一部分,所以它不能响应触碰或者视图那种手势, 就像你在 CALayerPlayground 示例中看到的那样。 <p></p><br><p>不过, 你可以敲击测试它们, 你会在 CATransformLayer 中看到示例代码。 你也可以往图层添加自定义动画, 这些动画会在 CAReplicatorLayer 中看到。</p></div><br><h2>示例2: CAScrollLayer</h2><br><p>CAScrollLayer 显示滚动图层的一部分。 它很基础,不能响应用户的触摸甚至不能确定滚动图层的边界, 所以它可以无限做类似防止滚出边界这种很酷的事! :] </p><br><p>UIScrollView 不用 CAScrollLayer 来做这件事, 取而代之的直接改变它的图层边界。 </p><br><p>用 CAScrollLayer 可以做的是设置它的滚动模式为水平或者垂直, 你可以编程让它滚动到特定的位置或区域:</p><br><br><div class="wp_codebox"><table><tr id="p904886"><td class="code" id="p90488code6"><pre class="swift" style="font-family:monospace;"><span style="color: #11740a; font-style: italic;">// In ScrollingView.swift</span><br><span style="color: #a61390;">import</span> UIKit<br>&nbsp;<br><span style="color: #a61390;">class</span> ScrollingView<span style="color: #002200;">:</span> <span style="color: #400080;">UIView</span> <span style="color: #002200;">&#123;</span><br>  <span style="color: #11740a; font-style: italic;">// 1</span><br>  <span style="color: #a61390;">override</span> <span style="color: #a61390;">class</span> <span style="color: #a61390;">func</span> layerClass<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">-</span>&gt; AnyClass <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">return</span> CAScrollLayer.<span style="color: #a61390;">self</span><br>  <span style="color: #002200;">&#125;</span><br><span style="color: #002200;">&#125;</span><br>&nbsp;<br><span style="color: #11740a; font-style: italic;">// In CAScrollLayerViewController.swift</span><br><span style="color: #a61390;">import</span> UIKit<br>&nbsp;<br><span style="color: #a61390;">class</span> CAScrollLayerViewController<span style="color: #002200;">:</span> <span style="color: #400080;">UIViewController</span> <span style="color: #002200;">&#123;</span><br>  @IBOutlet weak <span style="color: #a61390;">var</span> scrollingView<span style="color: #002200;">:</span> ScrollingView<span style="color: #002200;">!</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 2</span><br>  <span style="color: #a61390;">var</span> scrollingViewLayer<span style="color: #002200;">:</span> CAScrollLayer <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">return</span> scrollingView.layer <span style="color: #a61390;">as</span> CAScrollLayer<br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #a61390;">override</span> <span style="color: #a61390;">func</span> viewDidLoad<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">super</span>.viewDidLoad<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>    <span style="color: #11740a; font-style: italic;">// 3</span><br>    scrollingViewLayer.scrollMode <span style="color: #002200;">=</span> kCAScrollBoth<br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  @IBAction <span style="color: #a61390;">func</span> tapRecognized<span style="color: #002200;">&#40;</span>sender<span style="color: #002200;">:</span> <span style="color: #400080;">UITapGestureRecognizer</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    <span style="color: #11740a; font-style: italic;">// 4</span><br>    <span style="color: #a61390;">var</span> newPoint <span style="color: #002200;">=</span> <span style="color: #400080;">CGPoint</span><span style="color: #002200;">&#40;</span>x<span style="color: #002200;">:</span> <span style="color: #2400d9;">250</span>, y<span style="color: #002200;">:</span> <span style="color: #2400d9;">250</span><span style="color: #002200;">&#41;</span><br>    <span style="color: #400080;">UIView</span>.animateWithDuration<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">0.3</span>, delay<span style="color: #002200;">:</span> <span style="color: #2400d9;">0</span>, options<span style="color: #002200;">:</span> .CurveEaseInOut, animations<span style="color: #002200;">:</span> <span style="color: #002200;">&#123;</span><br>      <span style="color: #002200;">&#91;</span>unowned <span style="color: #a61390;">self</span><span style="color: #002200;">&#93;</span> <span style="color: #a61390;">in</span><br>      <span style="color: #a61390;">self</span>.scrollingViewLayer.scrollToPoint<span style="color: #002200;">&#40;</span>newPoint<span style="color: #002200;">&#41;</span><br>      <span style="color: #002200;">&#125;</span>, completion<span style="color: #002200;">:</span> <span style="color: #a61390;">nil</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br><span style="color: #002200;">&#125;</span></pre></td></tr></table></div><br><br><p>上面的代码:</p><br><ol><br><li>自定义 <code>UIView</code> 子类通过重写 <code>layerClass()</code> 来返回 <code>CAScrollLayer</code>; 这是创建一个新图层并且添加它作为一个子图层的一种选择, 就像示例做的一样。 </li><br><li>一个计算属性用来组织和自定义视图滚动图层的工作。</li><br><li>滚动设置为支持水平和垂直。 </li><br><li>当一个点击被识别后, 新的位置被创建, 滚动图层在一个 <code>UIView</code> 动画中滚动到那个位置。 备注: <code>scrollToPoint(<em>:)</em></code> 和 <code>scrollToRect(:)</code> 不会自动发生动画。 </li><br></ol><br><p>案例学习: 一个ScrollingView 实例, 它包含一个图片视图,这个视图的图片比滚动视图的边界还大。 当你执行上面的代码并单击视图, 可能是这样:</p><br><p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAScrollLayer.gif" width="250" height="250" class="aligncenter size-full wp-image-90738" srcset="https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/CAScrollLayer.gif 250w, https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/CAScrollLayer-32x32.gif 32w, https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/CAScrollLayer-64x64.gif 64w, https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/CAScrollLayer-96x96.gif 96w, https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/CAScrollLayer-128x128.gif 128w" sizes="(max-width: 250px) 100vw, 250px"></p><br><p>Layer Player 包含很多锁定水平和垂直滚动的控件。 </p><br><p>有一些经验规则决定用或不用 CAScrollLayer:</p><br><ul><br><li><em>如果只是想要轻量级并且需要编程实现滚动</em>: 考虑使用 CAScrollLayer.</li><br><li><em>如果你想让用户滚动</em>: 最好用 UIScrollView. 想了解更多, 查看 <a href="http://www.raywenderlich.com/93104/video-tutorial-swift-scroll-view-school-part-0-introduction" target="_blank" rel="external">18-part video tutorial series</a> .</li><br><li><em>如果你在滚动一个很大的图</em>: 考虑使用 CATiledLayer (更多信息在下面)。</li><br></ul><br><h2>示例3: CATextLayer</h2><br><p>CATextLayer 提供简单快速的纯文本或者属性字符串渲染。 不像 UILabel, CATextLayer 没有指定的 UIFont, 只有 CTFontRef 或 CGFontRef. </p><br><p>下面这块代码一样, 像动态变化一样去操作字体，字体大小，颜色，对齐方式，包围和截断:</p><br><br><div class="wp_codebox"><table><tr id="p904887"><td class="code" id="p90488code7"><pre class="swift" style="font-family:monospace;"><span style="color: #11740a; font-style: italic;">// 1</span><br><span style="color: #a61390;">let</span> textLayer <span style="color: #002200;">=</span> CATextLayer<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>textLayer.frame <span style="color: #002200;">=</span> someView.bounds<br>&nbsp;<br><span style="color: #11740a; font-style: italic;">// 2</span><br><span style="color: #a61390;">var</span> string <span style="color: #002200;">=</span> <span style="color: #bf1d1a;">&quot;&quot;</span><br><span style="color: #a61390;">for</span> _ <span style="color: #a61390;">in</span> <span style="color: #2400d9;">1</span>…20 <span style="color: #002200;">&#123;</span><br>  string <span style="color: #002200;">+=</span> <span style="color: #bf1d1a;">&quot;Lorem ipsum dolor sit amet, consectetur adipiscing elit. Fusce auctor arcu quis velit congue dictum. &quot;</span><br><span style="color: #002200;">&#125;</span><br>&nbsp;<br>textLayer.string <span style="color: #002200;">=</span> string<br>&nbsp;<br><span style="color: #11740a; font-style: italic;">// 3</span><br><span style="color: #a61390;">let</span> fontName<span style="color: #002200;">:</span> CFStringRef <span style="color: #002200;">=</span> <span style="color: #bf1d1a;">&quot;Noteworthy-Light&quot;</span><br>textLayer.font <span style="color: #002200;">=</span> CTFontCreateWithName<span style="color: #002200;">&#40;</span>fontName, fontSize, <span style="color: #a61390;">nil</span><span style="color: #002200;">&#41;</span><br>&nbsp;<br><span style="color: #11740a; font-style: italic;">// 4</span><br>textLayer.foregroundColor <span style="color: #002200;">=</span> <span style="color: #400080;">UIColor</span>.darkGrayColor<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span>.<span style="color: #400080;">CGColor</span><br>textLayer.wrapped <span style="color: #002200;">=</span> <span style="color: #a61390;">true</span><br>textLayer.alignmentMode <span style="color: #002200;">=</span> kCAAlignmentLeft<br>textLayer.contentsScale <span style="color: #002200;">=</span> UIScreen.mainScreen<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span>.scale<br>someView.layer.addSublayer<span style="color: #002200;">&#40;</span>textLayer<span style="color: #002200;">&#41;</span></pre></td></tr></table></div><br><br><p>解释上面的代码:</p><br><ol><br><li>创建一个 CATextLayer 实例并把它的区域设置成<code>someView</code>的区域。 </li><br><li>创建一个重复的字符串并把它设置到文字层。 </li><br><li>创建一个字体并把设置到文字层。 </li><br><li>设置文字层包围和左对齐, (你可以选择设成 natural, right, center 和 justified.),  <code>contentsScale</code> 设置成跟随屏幕, 然后把图层添加到视图层级中。</li><br></ol><br><p>所有图层类, 不仅仅是 CATextLayer, 默认按照1倍因子渲染。 连接到视图的时候, 图层按照当前屏幕自动设置 <code>contentsScale</code> 合适的比例。 手动创建的图层需要显示设置 <code>contentsScale</code> , 否则缩放比例是1，你在视网膜屏幕看到的是模糊的文字。</p><br><p>如果添加到正方形的 <code>someView</code>, 创建的文字图层会像下面这样:</p><br><p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer-250x250.png" width="250" height="250" class="aligncenter size-thumbnail wp-image-90750" srcset="https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer-250x250.png 250w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer-320x320.png 320w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer-500x500.png 500w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer-32x32.png 32w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer-64x64.png 64w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer-96x96.png 96w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer-128x128.png 128w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer.png 800w" sizes="(max-width: 250px) 100vw, 250px"></p><br><p>你可以玩玩截断设置, 当你想用省略号切断文本的时候它表现很好。 默认没有设置截断，当然你可以设置成首部截断，末尾截断和中间截断:</p><br><p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer-MiddleTruncation.png.png" width="250" height="26" class="aligncenter size-full wp-image-90764"></p><br><p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer-StartTruncation.png.png" width="250" height="26" class="aligncenter size-full wp-image-90765"></p><br><p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer-EndTruncation.png" width="250" height="26" class="aligncenter size-full wp-image-90763"></p><br><p>Layer Player 有很多控件来改变 CATextLayer 的属性:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer_5.5.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer_5.5-180x320.png" width="180" height="320" class="aligncenter size-medium wp-image-91214 bordered" srcset="https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer_5.5-180x320.png 180w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer_5.5-281x500.png 281w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATextLayer_5.5.png 1242w" sizes="(max-width: 180px) 100vw, 180px"></a></p><br><h2>示例4: AVPlayerLayer</h2><br><p>AVPlayerLayer 向 AVFoundation 添加了一个图层。 它拥有一个 AVPlayer 来播放 AV 媒体文件 (AVPlayerItems). 这里有个创建 AVPlayerLayer 的例子:</p><br><br><div class="wp_codebox"><table><tr id="p904888"><td class="code" id="p90488code8"><pre class="swift" style="font-family:monospace;"><span style="color: #a61390;">override</span> <span style="color: #a61390;">func</span> viewDidLoad<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>  <span style="color: #a61390;">super</span>.viewDidLoad<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #11740a; font-style: italic;">// 1</span><br>  <span style="color: #a61390;">let</span> playerLayer <span style="color: #002200;">=</span> AVPlayerLayer<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>  playerLayer.frame <span style="color: #002200;">=</span> someView.bounds<br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 2</span><br>  <span style="color: #a61390;">let</span> url <span style="color: #002200;">=</span> <span style="color: #400080;">NSBundle</span>.mainBundle<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span>.URLForResource<span style="color: #002200;">&#40;</span><span style="color: #bf1d1a;">&quot;someVideo&quot;</span>, withExtension<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">&quot;m4v&quot;</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #a61390;">let</span> player <span style="color: #002200;">=</span> AVPlayer<span style="color: #002200;">&#40;</span>URL<span style="color: #002200;">:</span> url<span style="color: #002200;">&#41;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 3</span><br>  player.actionAtItemEnd <span style="color: #002200;">=</span> .None<br>  playerLayer.player <span style="color: #002200;">=</span> player<br>  someView.layer.addSublayer<span style="color: #002200;">&#40;</span>playerLayer<span style="color: #002200;">&#41;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 4</span><br>  <span style="color: #400080;">NSNotificationCenter</span>.defaultCenter<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span>.addObserver<span style="color: #002200;">&#40;</span><span style="color: #a61390;">self</span>, selector<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">&quot;playerDidReachEndNotificationHandler:&quot;</span>, name<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">&quot;AVPlayerItemDidPlayToEndTimeNotification&quot;</span>, object<span style="color: #002200;">:</span> player.currentItem<span style="color: #002200;">&#41;</span><br><span style="color: #002200;">&#125;</span><br>&nbsp;<br><span style="color: #a61390;">deinit</span> <span style="color: #002200;">&#123;</span><br>  <span style="color: #400080;">NSNotificationCenter</span>.defaultCenter<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span>.removeObserver<span style="color: #002200;">&#40;</span><span style="color: #a61390;">self</span><span style="color: #002200;">&#41;</span><br><span style="color: #002200;">&#125;</span><br>&nbsp;<br><span style="color: #11740a; font-style: italic;">// 5</span><br>@IBAction <span style="color: #a61390;">func</span> playButtonTapped<span style="color: #002200;">&#40;</span>sender<span style="color: #002200;">:</span> <span style="color: #400080;">UIButton</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>  <span style="color: #a61390;">if</span> playButton.titleLabel?.text <span style="color: #002200;">==</span> <span style="color: #bf1d1a;">&quot;Play&quot;</span> <span style="color: #002200;">&#123;</span><br>    player.play<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>    playButton.setTitle<span style="color: #002200;">&#40;</span><span style="color: #bf1d1a;">&quot;Pause&quot;</span>, forState<span style="color: #002200;">:</span> .Normal<span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span> <span style="color: #a61390;">else</span> <span style="color: #002200;">&#123;</span><br>    player.pause<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>    playButton.setTitle<span style="color: #002200;">&#40;</span><span style="color: #bf1d1a;">&quot;Play&quot;</span>, forState<span style="color: #002200;">:</span> .Normal<span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  updatePlayButtonTitle<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>  updateRateSegmentedControl<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br><span style="color: #002200;">&#125;</span><br>&nbsp;<br><span style="color: #11740a; font-style: italic;">// 6</span><br><span style="color: #a61390;">func</span> playerDidReachEndNotificationHandler<span style="color: #002200;">&#40;</span>notification<span style="color: #002200;">:</span> <span style="color: #400080;">NSNotification</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>  <span style="color: #a61390;">let</span> playerItem <span style="color: #002200;">=</span> notification.object <span style="color: #a61390;">as</span> AVPlayerItem<br>  playerItem.seekToTime<span style="color: #002200;">&#40;</span>kCMTimeZero<span style="color: #002200;">&#41;</span><br><span style="color: #002200;">&#125;</span></pre></td></tr></table></div><br><br><p>分解上面的代码:</p><br><ol><br><li>创建新的播放器图层并设置它的区域。</li><br><li>用 AV 库创建一个播放器。 </li><br><li>告诉播放器播放完成前什么都不做; 添加附加选项，包括暂停，切换到下一首。 </li><br><li>给 AVPlayer 注册播放结束的通知 (在 deinit 移除通知)。 </li><br><li>当播放按钮被点击, 它会触发控件去播放歌曲并设置按钮的标题。</li><br></ol><br><p>注意这只是一个简单的示例帮助你开始。 在真实的项目里, 以按钮文字为中心是不可取的。</p><br><p>AVPlayerLayer 和 上面创建的 AVPlayer 视觉表现为 AVPlayerItem 实例的第一帧, 像这样:</p><br><p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/AVPlayerItem.png" width="250" height="141" class="aligncenter size-full wp-image-91221"></p><br><p>AVPlayerLayer 有两个附加的属性:</p><br><ul><br><li><code>videoGravity</code> 设置视频显示大小。 </li><br><li><code>readyForDisplay</code> 检测视频是否准备好播放。 </li><br></ul><br><p><code>AVPlayer</code>, 另一方面, 只有很少的附加属性和方法。 有一个要注意的是 <code>rate</code>, 包含从 0 到 1的回放速率。 零代表暂停，1代表正常速率播放视频 (1倍速)。 </p><br><p>然而, 设置 <code>rate</code> 也会指示回放按照这个速度开始。 换种说法, 调用 <code>pause()</code> 和 设置 <code>rate</code> 为 0 效果是一样的, 跟调用 <code>play()</code> 和把 <code>rate</code> 设置成 1是一回事</p><br><p>那么快进，慢镜或者反向播放呢? AVPlayerLayer 也已经包含。 设置 <code>rate</code> 比1大就等于要求播放器以这个倍数的速率开始播放, 例如, 设置 <code>rate</code> 为 2 意味着双倍速。 </p><br><p>你可能会想, 把 <code>rate</code> 设置成负数就会指示播放器按照对应的倍速开始倒着播放。 </p><br><p>当比正常倍速更快回放前 (快进), 不管怎样, AVPlayerItem 实例会调用适当的方法来验证它可以以这个速度回放: </p><br><ul><br><li><code>canPlayFastForward()</code> 针对比 1 大的情况</li><br><li><code>canPlaySlowForward()</code> 针对 0 和 1 之间的情况</li><br><li><code>canPlayReverse()</code> 针对 -1</li><br><li><code>canPlaySlowReverse()</code> 针对 -1 和 0 之间的情况</li><br><li><code>canPlayFastReverse()</code> 针对小于 -1 的情况 </li><br></ul><br><p>大多数视频都可以各种快进, 但是很少有可以倒着播放的。 Layer Player 也包含回放控件:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/AVLayerPlayer_5.5.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/AVLayerPlayer_5.5-180x320.png" width="180" height="320" class="aligncenter size-medium wp-image-91216 bordered" srcset="https://cdn3.raywenderlich.com/wp-content/uploads/2014/12/AVLayerPlayer_5.5-180x320.png 180w, https://cdn3.raywenderlich.com/wp-content/uploads/2014/12/AVLayerPlayer_5.5-281x500.png 281w, https://cdn3.raywenderlich.com/wp-content/uploads/2014/12/AVLayerPlayer_5.5.png 1242w" sizes="(max-width: 180px) 100vw, 180px"></a></p><br><h2>示例5: CAGradientLayer</h2><br><p>CAGradientLayer 使得混合两种或多种颜色变得容易, 这样尤其适合做背景。 要配置它, 你要指定 CGColors 数组, 也要指定 <code>startPoint</code> 和 <code>endPoint</code> 来指定梯度图层哪里开始和结束。 </p><br><p>记住, <code>startPoint</code> 和 <code>endPoint</code> 不是明确的点。 相反, 他们在单元坐标空间定义然后在绘制时映射到图层边界。 换句话说,  x 值为1表示这个点在图层的右边界, y 值为1表示这个点在图层的底边界。 </p><br><p>CAGradientLayer 有个 <code>type</code> 属性, 尽管 <code>kCAGradientLayerAxial</code> 是唯一的选项, 它通过数组中的颜色进行线性转换。 </p><br><p>这意味着如果你在 <code>startPoint</code> 和 <code>endPoint</code> 之间绘制一条线 (A), 渐变沿着一条虚拟的线 (B) 发生，这条线垂直于 A, 所有沿着 B 的点都是同样的颜色:</p><br><p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/AxialGradientLayerType.gif" width="300" class="aligncenter size-full wp-image-91240"></p><br><p>或者, 你可以用0和1之间的数组控制 <code>locations</code> 属性，指定相对停止的位置，在这里梯度图层应该使用 <code>colors</code> 数组里的下一个颜色。 </p><br><p>如果未指定，默认停止位置是均匀分布的。 如果 <code>locations</code> 被设置, 那么它的的数量必须匹配 <code>colors</code> 的数量, 否则坏事要发生。 :[</p><br><p>这里有一个创建梯度图层的例子:</p><br><br><div class="wp_codebox"><table><tr id="p904889"><td class="code" id="p90488code9"><pre class="swift" style="font-family:monospace;"><span style="color: #a61390;">let</span> gradientLayer <span style="color: #002200;">=</span> CAGradientLayer<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>gradientLayer.frame <span style="color: #002200;">=</span> someView.bounds<br>gradientLayer.colors <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>cgColorForRed<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">209.0</span>, green<span style="color: #002200;">:</span> <span style="color: #2400d9;">0.0</span>, blue<span style="color: #002200;">:</span> <span style="color: #2400d9;">0.0</span><span style="color: #002200;">&#41;</span>,<br>  cgColorForRed<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">255.0</span>, green<span style="color: #002200;">:</span> <span style="color: #2400d9;">102.0</span>, blue<span style="color: #002200;">:</span> <span style="color: #2400d9;">34.0</span><span style="color: #002200;">&#41;</span>,<br>  cgColorForRed<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">255.0</span>, green<span style="color: #002200;">:</span> <span style="color: #2400d9;">218.0</span>, blue<span style="color: #002200;">:</span> <span style="color: #2400d9;">33.0</span><span style="color: #002200;">&#41;</span>,<br>  cgColorForRed<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">51.0</span>, green<span style="color: #002200;">:</span> <span style="color: #2400d9;">221.0</span>, blue<span style="color: #002200;">:</span> <span style="color: #2400d9;">0.0</span><span style="color: #002200;">&#41;</span>,<br>  cgColorForRed<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">17.0</span>, green<span style="color: #002200;">:</span> <span style="color: #2400d9;">51.0</span>, blue<span style="color: #002200;">:</span> <span style="color: #2400d9;">204.0</span><span style="color: #002200;">&#41;</span>,<br>  cgColorForRed<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">34.0</span>, green<span style="color: #002200;">:</span> <span style="color: #2400d9;">0.0</span>, blue<span style="color: #002200;">:</span> <span style="color: #2400d9;">102.0</span><span style="color: #002200;">&#41;</span>,<br>  cgColorForRed<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">51.0</span>, green<span style="color: #002200;">:</span> <span style="color: #2400d9;">0.0</span>, blue<span style="color: #002200;">:</span> <span style="color: #2400d9;">68.0</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#93;</span><br>gradientLayer.startPoint <span style="color: #002200;">=</span> <span style="color: #400080;">CGPoint</span><span style="color: #002200;">&#40;</span>x<span style="color: #002200;">:</span> <span style="color: #2400d9;">0</span>, y<span style="color: #002200;">:</span> <span style="color: #2400d9;">0</span><span style="color: #002200;">&#41;</span><br>gradientLayer.endPoint <span style="color: #002200;">=</span> <span style="color: #400080;">CGPoint</span><span style="color: #002200;">&#40;</span>x<span style="color: #002200;">:</span> <span style="color: #2400d9;">0</span>, y<span style="color: #002200;">:</span> <span style="color: #2400d9;">1</span><span style="color: #002200;">&#41;</span><br>someView.layer.addSublayer<span style="color: #002200;">&#40;</span>gradientLayer<span style="color: #002200;">&#41;</span><br>&nbsp;<br><span style="color: #a61390;">func</span> cgColorForRed<span style="color: #002200;">&#40;</span>red<span style="color: #002200;">:</span> <span style="color: #400080;">CGFloat</span>, green<span style="color: #002200;">:</span> <span style="color: #400080;">CGFloat</span>, blue<span style="color: #002200;">:</span> <span style="color: #400080;">CGFloat</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">-</span>&gt; <span style="color: #a61390;">AnyObject</span> <span style="color: #002200;">&#123;</span><br>  <span style="color: #a61390;">return</span> <span style="color: #400080;">UIColor</span><span style="color: #002200;">&#40;</span>red<span style="color: #002200;">:</span> red<span style="color: #002200;">/</span><span style="color: #2400d9;">255.0</span>, green<span style="color: #002200;">:</span> green<span style="color: #002200;">/</span><span style="color: #2400d9;">255.0</span>, blue<span style="color: #002200;">:</span> blue<span style="color: #002200;">/</span><span style="color: #2400d9;">255.0</span>, alpha<span style="color: #002200;">:</span> <span style="color: #2400d9;">1.0</span><span style="color: #002200;">&#41;</span>.<span style="color: #400080;">CGColor</span> <span style="color: #a61390;">as</span> <span style="color: #a61390;">AnyObject</span><br><span style="color: #002200;">&#125;</span></pre></td></tr></table></div><br><br><p>上面的代码, 你创建了一个梯度图层, 区域跟 <code>someView</code> 边界相匹配, 赋值了一个颜色数组, 设置了开始结束的坐标点, 并且把梯度图层添加到视图层级。 效果如下:</p><br><p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAGradientLayer-250x250.png" width="250" height="250" class="aligncenter size-thumbnail wp-image-91248 bordered" srcset="https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CAGradientLayer-250x250.png 250w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CAGradientLayer-320x320.png 320w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CAGradientLayer-500x500.png 500w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CAGradientLayer-32x32.png 32w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CAGradientLayer-64x64.png 64w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CAGradientLayer-96x96.png 96w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CAGradientLayer-128x128.png 128w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CAGradientLayer.png 609w" sizes="(max-width: 250px) 100vw, 250px"></p><br><p>色彩缤纷! 下一步, 你要编一个蝴蝶的程序，然后飞出app，来到你的面前。 :]</p><br><p>Layer Player 提供控件来改变起始位置，颜色和位置:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAGradientLayer_5.5.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAGradientLayer_5.5-180x320.png" width="180" height="320" class="aligncenter size-medium wp-image-91244 bordered" srcset="https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/CAGradientLayer_5.5-180x320.png 180w, https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/CAGradientLayer_5.5-281x500.png 281w, https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/CAGradientLayer_5.5.png 1242w" sizes="(max-width: 180px) 100vw, 180px"></a></p><br><h2>示例6: CAReplicatorLayer</h2><br><p>CAReplicatorLayer 复制图层指定的次数, 用来创建一些很酷的效果。 </p><br><p>每个图层拷贝都有自己的颜色和定位改变, 并且它的绘制可以推迟到给所有的复制器图层一个动画效果。 深度可以保存给复制器图层一个3D效果。 这里是一个例子:</p><br><br><div class="wp_codebox"><table><tr id="p9048810"><td class="code" id="p90488code10"><pre class="swift" style="font-family:monospace;"><span style="color: #11740a; font-style: italic;">// 1</span><br><span style="color: #a61390;">let</span> replicatorLayer <span style="color: #002200;">=</span> CAReplicatorLayer<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>replicatorLayer.frame <span style="color: #002200;">=</span> someView.bounds<br>&nbsp;<br><span style="color: #11740a; font-style: italic;">// 2</span><br>replicatorLayer.instanceCount <span style="color: #002200;">=</span> <span style="color: #2400d9;">30</span><br>replicatorLayer.instanceDelay <span style="color: #002200;">=</span> CFTimeInterval<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">1</span> <span style="color: #002200;">/</span> <span style="color: #2400d9;">30.0</span><span style="color: #002200;">&#41;</span><br>replicatorLayer.preservesDepth <span style="color: #002200;">=</span> <span style="color: #a61390;">false</span><br>replicatorLayer.instanceColor <span style="color: #002200;">=</span> <span style="color: #400080;">UIColor</span>.whiteColor<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span>.<span style="color: #400080;">CGColor</span><br>&nbsp;<br><span style="color: #11740a; font-style: italic;">// 3</span><br>replicatorLayer.instanceRedOffset <span style="color: #002200;">=</span> <span style="color: #2400d9;">0.0</span><br>replicatorLayer.instanceGreenOffset <span style="color: #002200;">=</span> <span style="color: #002200;">-</span><span style="color: #2400d9;">0.5</span><br>replicatorLayer.instanceBlueOffset <span style="color: #002200;">=</span> <span style="color: #002200;">-</span><span style="color: #2400d9;">0.5</span><br>replicatorLayer.instanceAlphaOffset <span style="color: #002200;">=</span> <span style="color: #2400d9;">0.0</span><br>&nbsp;<br><span style="color: #11740a; font-style: italic;">// 4</span><br><span style="color: #a61390;">let</span> angle <span style="color: #002200;">=</span> <span style="color: #a61390;">Float</span><span style="color: #002200;">&#40;</span>M_PI <span style="color: #002200;"><em></em></span> <span style="color: #2400d9;">2.0</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">/</span> <span style="color: #2400d9;">30</span><br>replicatorLayer.instanceTransform <span style="color: #002200;">=</span> CATransform3DMakeRotation<span style="color: #002200;">&#40;</span><span style="color: #400080;">CGFloat</span><span style="color: #002200;">&#40;</span>angle<span style="color: #002200;">&#41;</span>, <span style="color: #2400d9;">0.0</span>, <span style="color: #2400d9;">0.0</span>, <span style="color: #2400d9;">1.0</span><span style="color: #002200;">&#41;</span><br>someView.layer.addSublayer<span style="color: #002200;">&#40;</span>replicatorLayer<span style="color: #002200;">&#41;</span><br>&nbsp;<br><span style="color: #11740a; font-style: italic;">// 5</span><br><span style="color: #a61390;">let</span> instanceLayer <span style="color: #002200;">=</span> <span style="color: #400080;">CALayer</span><span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br><span style="color: #a61390;">let</span> layerWidth<span style="color: #002200;">:</span> <span style="color: #400080;">CGFloat</span> <span style="color: #002200;">=</span> <span style="color: #2400d9;">10.0</span><br><span style="color: #a61390;">let</span> midX <span style="color: #002200;">=</span> CGRectGetMidX<span style="color: #002200;">&#40;</span>someView.bounds<span style="color: #002200;">&#41;</span> <span style="color: #002200;">-</span> layerWidth <span style="color: #002200;">/</span> <span style="color: #2400d9;">2.0</span><br>instanceLayer.frame <span style="color: #002200;">=</span> <span style="color: #400080;">CGRect</span><span style="color: #002200;">&#40;</span>x<span style="color: #002200;">:</span> midX, y<span style="color: #002200;">:</span> <span style="color: #2400d9;">0.0</span>, width<span style="color: #002200;">:</span> layerWidth, height<span style="color: #002200;">:</span> layerWidth <span style="color: #002200;"></span> <span style="color: #2400d9;">3.0</span><span style="color: #002200;">&#41;</span><br>instanceLayer.backgroundColor <span style="color: #002200;">=</span> <span style="color: #400080;">UIColor</span>.whiteColor<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span>.<span style="color: #400080;">CGColor</span><br>replicatorLayer.addSublayer<span style="color: #002200;">&#40;</span>instanceLayer<span style="color: #002200;">&#41;</span><br>&nbsp;<br><span style="color: #11740a; font-style: italic;">// 6</span><br><span style="color: #a61390;">let</span> fadeAnimation <span style="color: #002200;">=</span> <span style="color: #400080;">CABasicAnimation</span><span style="color: #002200;">&#40;</span>keyPath<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">&quot;opacity&quot;</span><span style="color: #002200;">&#41;</span><br>fadeAnimation.fromValue <span style="color: #002200;">=</span> <span style="color: #2400d9;">1.0</span><br>fadeAnimation.toValue <span style="color: #002200;">=</span> <span style="color: #2400d9;">0.0</span><br>fadeAnimation.duration <span style="color: #002200;">=</span> <span style="color: #2400d9;">1</span><br>fadeAnimation.repeatCount <span style="color: #002200;">=</span> <span style="color: #a61390;">Float</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">Int</span>.<span style="color: #a61390;">max</span><span style="color: #002200;">&#41;</span><br>&nbsp;<br><span style="color: #11740a; font-style: italic;">// 7</span><br>instanceLayer.opacity <span style="color: #002200;">=</span> <span style="color: #2400d9;">0.0</span><br>instanceLayer.addAnimation<span style="color: #002200;">&#40;</span>fadeAnimation, forKey<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">&quot;FadeAnimation&quot;</span><span style="color: #002200;">&#41;</span></pre></td></tr></table></div><br><br><p>上面的代码做了下面这些事:</p><br><ol><br><li>创建一个 CAReplicatorLayer 实例并且把区域设成 <code>someView</code> 的边界。 </li><br><li>设置复制器图层拷贝数 (<code>instanceCount</code>) 并且推迟绘制。设置复制器图层为 2D (<code>preservesDepth = false</code>) 同时设置它的实例颜色为白色。 </li><br><li>给连续的重复实例添加红绿蓝颜色值偏移量。 默认值都是0, 在所有实例有效保留颜色值。 然而, 这种情况下, 实例颜色最初设置为白色, 以为意味着红绿蓝都是 1.0 。 所以, 设置红色为 0 同时绿蓝偏移值为负数可以突出红色调。 同样的, 把alpha 偏移量设置到连续重复图层的 alpha 。 </li><br><li>创建一个变换实现圆形旋转。 </li><br><li>为复制器图层创建一个实例图层同时设置区域， 第一个实例会在中心 x 和  <code>someView</code>区域的顶部绘制。 这块代码同时设置实例的颜色，然后把实例图层添加到复制器图层。 </li><br><li>产生一个淡入淡出的动画，透明度从 1 到 0 。 </li><br><li>设置实例图层不透明度为0， 那么它就是透明的，直到每个实例被绘制，同时它的颜色和 alpha 值被设置。</li><br></ol><br><p>代码执行结果结果如下:</p><br><p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAReplicatorLayer.gif" width="250" height="250" class="aligncenter size-full wp-image-91334" srcset="https://cdn3.raywenderlich.com/wp-content/uploads/2014/12/CAReplicatorLayer.gif 250w, https://cdn3.raywenderlich.com/wp-content/uploads/2014/12/CAReplicatorLayer-32x32.gif 32w, https://cdn3.raywenderlich.com/wp-content/uploads/2014/12/CAReplicatorLayer-64x64.gif 64w, https://cdn3.raywenderlich.com/wp-content/uploads/2014/12/CAReplicatorLayer-96x96.gif 96w, https://cdn3.raywenderlich.com/wp-content/uploads/2014/12/CAReplicatorLayer-128x128.gif 128w" sizes="(max-width: 250px) 100vw, 250px"></p><br><p>Layer Player 包含了控件去操作大多的属性:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAReplicatorLayer_5.5.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAReplicatorLayer_5.5-180x320.png" width="180" height="320" class="aligncenter size-medium wp-image-91349 bordered" srcset="https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CAReplicatorLayer_5.5-180x320.png 180w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CAReplicatorLayer_5.5-281x500.png 281w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CAReplicatorLayer_5.5.png 1242w" sizes="(max-width: 180px) 100vw, 180px"></a></p><br><h2>示例7: CATiledLayer</h2><br><p>CATiledLayer 以瓷砖形式异步绘制图层内容。 对于大图或者内容很多你每次只需要看很小一块，这很有用, 因为你可以开始看你的内容而不是一次性把它们加入内存。</p><br><p>有个两个方式来处理绘制。 一种是重写 UIView ，使用 CATiledLayer 重复绘制瓷砖来填满视图的背景, 像这样:</p><br><br><div class="wp_codebox"><table><tr id="p9048811"><td class="code" id="p90488code11"><pre class="swift" style="font-family:monospace;"><span style="color: #11740a; font-style: italic;">// In ViewController.swift</span><br><span style="color: #a61390;">import</span> UIKit<br>&nbsp;<br><span style="color: #a61390;">class</span> ViewController<span style="color: #002200;">:</span> <span style="color: #400080;">UIViewController</span> <span style="color: #002200;">&#123;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 1</span><br>  @IBOutlet weak <span style="color: #a61390;">var</span> tiledBackgroundView<span style="color: #002200;">:</span> TiledBackgroundView<span style="color: #002200;">!</span><br>&nbsp;<br><span style="color: #002200;">&#125;</span><br>&nbsp;<br><span style="color: #11740a; font-style: italic;">// In TiledBackgroundView.swift</span><br><span style="color: #a61390;">import</span> UIKit<br>&nbsp;<br><span style="color: #a61390;">class</span> TiledBackgroundView<span style="color: #002200;">:</span> <span style="color: #400080;">UIView</span> <span style="color: #002200;">&#123;</span><br>&nbsp;<br>  <span style="color: #a61390;">let</span> sideLength <span style="color: #002200;">=</span> <span style="color: #400080;">CGFloat</span><span style="color: #002200;">&#40;</span><span style="color: #2400d9;">50.0</span><span style="color: #002200;">&#41;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 2</span><br>  <span style="color: #a61390;">override</span> <span style="color: #a61390;">class</span> <span style="color: #a61390;">func</span> layerClass<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">-</span>&gt; AnyClass <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">return</span> CATiledLayer.<span style="color: #a61390;">self</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 3</span><br>  required <span style="color: #a61390;">init</span><span style="color: #002200;">&#40;</span>coder aDecoder<span style="color: #002200;">:</span> <span style="color: #400080;">NSCoder</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">super</span>.<span style="color: #a61390;">init</span><span style="color: #002200;">&#40;</span>coder<span style="color: #002200;">:</span> aDecoder<span style="color: #002200;">&#41;</span><br>    srand48<span style="color: #002200;">&#40;</span><span style="color: #a61390;">Int</span><span style="color: #002200;">&#40;</span><span style="color: #400080;">NSDate</span><span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span>.timeIntervalSince1970<span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    <span style="color: #a61390;">let</span> layer <span style="color: #002200;">=</span> <span style="color: #a61390;">self</span>.layer <span style="color: #a61390;">as</span> CATiledLayer<br>    <span style="color: #a61390;">let</span> scale <span style="color: #002200;">=</span> UIScreen.mainScreen<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span>.scale<br>    layer.contentsScale <span style="color: #002200;">=</span> scale<br>    layer.tileSize <span style="color: #002200;">=</span> <span style="color: #400080;">CGSize</span><span style="color: #002200;">&#40;</span>width<span style="color: #002200;">:</span> sideLength <span style="color: #002200;"><em></em></span> scale, height<span style="color: #002200;">:</span> sideLength <span style="color: #002200;"></span> scale<span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 4</span><br>  <span style="color: #a61390;">override</span> <span style="color: #a61390;">func</span> drawRect<span style="color: #002200;">&#40;</span>rect<span style="color: #002200;">:</span> <span style="color: #400080;">CGRect</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">let</span> context <span style="color: #002200;">=</span> <span style="color: #400080;">UIGraphicsGetCurrentContext</span><span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>    <span style="color: #a61390;">var</span> red <span style="color: #002200;">=</span> <span style="color: #400080;">CGFloat</span><span style="color: #002200;">&#40;</span>drand48<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    <span style="color: #a61390;">var</span> green <span style="color: #002200;">=</span> <span style="color: #400080;">CGFloat</span><span style="color: #002200;">&#40;</span>drand48<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    <span style="color: #a61390;">var</span> blue <span style="color: #002200;">=</span> <span style="color: #400080;">CGFloat</span><span style="color: #002200;">&#40;</span>drand48<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    CGContextSetRGBFillColor<span style="color: #002200;">&#40;</span>context, red, green, blue, <span style="color: #2400d9;">1.0</span><span style="color: #002200;">&#41;</span><br>    CGContextFillRect<span style="color: #002200;">&#40;</span>context, rect<span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br><span style="color: #002200;">&#125;</span></pre></td></tr></table></div><br><br><p>代码解释:</p><br><ol><br><li><code>tiledBackgroundView</code> 放置在 (150, 150) ，宽高都是 300. </li><br><li><code>layerClass()</code> 重写，视图图层被创建为 CATiledLayer 的实例。 </li><br><li><code>rand48()</code> 方法用来产生随机颜色用在 <code>drawRect()</code> 里。 然后扩展图层内容 (转换为 CATiledLayer) 来匹配屏幕的尺寸，接着设置大小。 </li><br><li>重写 <code>drawRect()</code> 来用随机颜色填充视图。</li><br></ol><br><p>最后, 上面的代码绘制了一个 6&#215;6 随机色的瓷砖, 像这样:</p><br><p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayer-250x250.png" width="250" height="250" class="aligncenter size-thumbnail wp-image-91465" srcset="https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayer-250x250.png 250w, https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayer-320x320.png 320w, https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayer-32x32.png 32w, https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayer-64x64.png 64w, https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayer-96x96.png 96w, https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayer-128x128.png 128w, https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayer.png 451w" sizes="(max-width: 250px) 100vw, 250px"></p><br><p>Layer Player 在瓷砖背景图上绘制了一条路径来详细说明这个用法:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayer_5.5.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayer_5.5-180x320.png" width="180" height="320" class="aligncenter size-medium wp-image-91469 bordered" srcset="https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayer_5.5-180x320.png 180w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayer_5.5-281x500.png 281w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayer_5.5.png 1242w" sizes="(max-width: 180px) 100vw, 180px"></a></p><br><p>上面截图的星星在放大显示时会变的模糊不清:</p><br><p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayerZoomedBlurry-250x250.png" width="250" height="250" class="aligncenter size-thumbnail wp-image-91473" srcset="https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayerZoomedBlurry-250x250.png 250w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayerZoomedBlurry-320x320.png 320w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayerZoomedBlurry-32x32.png 32w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayerZoomedBlurry-64x64.png 64w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayerZoomedBlurry-96x96.png 96w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayerZoomedBlurry-128x128.png 128w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayerZoomedBlurry.png 374w" sizes="(max-width: 250px) 100vw, 250px"></p><br><p>模糊度是细节色阶的结果，这个是图层维护的。 CATiledLayer 有两个属性 <code>levelsOfDetail</code> 和 <code>levelsOfDetailBias</code>. </p><br><p><code>levelsOfDetail</code>, 如它名字所说, 是图层维护的细节色阶数。 默认为0, 并且每次提升色阶会按以前色阶的一半的分辨率缓存。 <code>levelsOfDetail</code> 最大值是最低细节色阶至少是一个像素。 </p><br><p><code>levelsOfDetailBias</code>, 换种说法, 是图层缓存的 <i>magnified</i> 细节色阶的数量。 默认为0, 意味着没有额外的放大的色阶被缓存, 并且每次提升色阶将会按照先前色阶分辨率的两倍缓存。 </p><br><p>例如, 把上面模糊的瓷砖图层的 <code>levelsOfDetailBias</code> 值增加到 5，将会导致缓存色阶按照 2x, 4x, 8x, 16x 和 32x 放大, 缩放效果如下:</p><br><p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayerZoomed-250x250.png" width="250" height="250" class="aligncenter size-thumbnail wp-image-91475" srcset="https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayerZoomed-250x250.png 250w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayerZoomed-320x320.png 320w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayerZoomed-32x32.png 32w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayerZoomed-64x64.png 64w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayerZoomed-96x96.png 96w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayerZoomed-128x128.png 128w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/CATiledLayerZoomed.png 374w" sizes="(max-width: 250px) 100vw, 250px"></p><br><p>很酷, 是不是? 不过等一等，还有更酷的! </p><br><p>Layer Player 包含了一个图形扩展，文件叫 <a href="https://github.com/scotteg/LayerPlayer/blob/master/LayerPlayer/UIImage%2BTileCutter.swift" title="UIImage+TileCutter.swift" target="_blank">UIImage+TileCutter.swift</a>. 辅导团队成员 <a href="http://www.raywenderlich.com/u/nicklockwood" title="Nick Lockwood" target="_blank" rel="external">Nick Lockwood</a> 为他的终端app改造了这个代码, 这个在他的书里提供了, <i>iOS Core Animation: Advanced Techniques</i>. </p><br><p>它的工作就是把源图像分成若干指定大小的方形图块, 根据每块图的行列位置命名; 例如, windingRoad_6_2.png 在 7列， 3行 (索引从0开始):</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/windingRoad.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/windingRoad-480x300.png" width="480" height="300" class="aligncenter size-medium wp-image-91653" srcset="https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/windingRoad-480x300.png 480w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/windingRoad-700x437.png 700w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/windingRoad.png 1200w" sizes="(max-width: 480px) 100vw, 480px"></a></p><br><p>给这些图块放置位置, 自定义一个 UIView 子类可以用来绘制这些图块:</p><br><br><div class="wp_codebox"><table><tr id="p9048812"><td class="code" id="p90488code12"><pre class="swift" style="font-family:monospace;"><span style="color: #a61390;">import</span> UIKit<br>&nbsp;<br><span style="color: #a61390;">class</span> TilingViewForImage<span style="color: #002200;">:</span> <span style="color: #400080;">UIView</span> <span style="color: #002200;">&#123;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 1</span><br>  <span style="color: #a61390;">let</span> sideLength <span style="color: #002200;">=</span> <span style="color: #400080;">CGFloat</span><span style="color: #002200;">&#40;</span><span style="color: #2400d9;">640.0</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #a61390;">let</span> fileName <span style="color: #002200;">=</span> <span style="color: #bf1d1a;">&quot;windingRoad&quot;</span><br>  <span style="color: #a61390;">let</span> cachesPath <span style="color: #002200;">=</span> NSSearchPathForDirectoriesInDomains<span style="color: #002200;">&#40;</span>.CachesDirectory, .UserDomainMask, <span style="color: #a61390;">true</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#91;</span><span style="color: #2400d9;">0</span><span style="color: #002200;">&#93;</span> <span style="color: #a61390;">as</span> <span style="color: #a61390;">String</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 2</span><br>  <span style="color: #a61390;">override</span> <span style="color: #a61390;">class</span> <span style="color: #a61390;">func</span> layerClass<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">-</span>&gt; AnyClass <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">return</span> CATiledLayer.<span style="color: #a61390;">self</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 3</span><br>  required <span style="color: #a61390;">init</span><span style="color: #002200;">&#40;</span>coder aDecoder<span style="color: #002200;">:</span> <span style="color: #400080;">NSCoder</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">super</span>.<span style="color: #a61390;">init</span><span style="color: #002200;">&#40;</span>coder<span style="color: #002200;">:</span> aDecoder<span style="color: #002200;">&#41;</span><br>    <span style="color: #a61390;">let</span> layer <span style="color: #002200;">=</span> <span style="color: #a61390;">self</span>.layer <span style="color: #a61390;">as</span> CATiledLayer<br>    layer.tileSize <span style="color: #002200;">=</span> <span style="color: #400080;">CGSize</span><span style="color: #002200;">&#40;</span>width<span style="color: #002200;">:</span> sideLength, height<span style="color: #002200;">:</span> sideLength<span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 4</span><br>  <span style="color: #a61390;">override</span> <span style="color: #a61390;">func</span> drawRect<span style="color: #002200;">&#40;</span>rect<span style="color: #002200;">:</span> <span style="color: #400080;">CGRect</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">let</span> firstColumn <span style="color: #002200;">=</span> <span style="color: #a61390;">Int</span><span style="color: #002200;">&#40;</span>CGRectGetMinX<span style="color: #002200;">&#40;</span>rect<span style="color: #002200;">&#41;</span> <span style="color: #002200;">/</span> sideLength<span style="color: #002200;">&#41;</span><br>    <span style="color: #a61390;">let</span> lastColumn <span style="color: #002200;">=</span> <span style="color: #a61390;">Int</span><span style="color: #002200;">&#40;</span>CGRectGetMaxX<span style="color: #002200;">&#40;</span>rect<span style="color: #002200;">&#41;</span> <span style="color: #002200;">/</span> sideLength<span style="color: #002200;">&#41;</span><br>    <span style="color: #a61390;">let</span> firstRow <span style="color: #002200;">=</span> <span style="color: #a61390;">Int</span><span style="color: #002200;">&#40;</span>CGRectGetMinY<span style="color: #002200;">&#40;</span>rect<span style="color: #002200;">&#41;</span> <span style="color: #002200;">/</span> sideLength<span style="color: #002200;">&#41;</span><br>    <span style="color: #a61390;">let</span> lastRow <span style="color: #002200;">=</span> <span style="color: #a61390;">Int</span><span style="color: #002200;">&#40;</span>CGRectGetMaxY<span style="color: #002200;">&#40;</span>rect<span style="color: #002200;">&#41;</span> <span style="color: #002200;">/</span> sideLength<span style="color: #002200;">&#41;</span><br>&nbsp;<br>    <span style="color: #a61390;">for</span> row <span style="color: #a61390;">in</span> firstRow…lastRow <span style="color: #002200;">&#123;</span><br>      <span style="color: #a61390;">for</span> column <span style="color: #a61390;">in</span> firstColumn…lastColumn <span style="color: #002200;">&#123;</span><br>        <span style="color: #a61390;">if</span> <span style="color: #a61390;">let</span> tile <span style="color: #002200;">=</span> imageForTileAtColumn<span style="color: #002200;">&#40;</span>column, row<span style="color: #002200;">:</span> row<span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>          <span style="color: #a61390;">let</span> x <span style="color: #002200;">=</span> sideLength <span style="color: #002200;"><em></em></span> <span style="color: #400080;">CGFloat</span><span style="color: #002200;">&#40;</span>column<span style="color: #002200;">&#41;</span><br>          <span style="color: #a61390;">let</span> y <span style="color: #002200;">=</span> sideLength <span style="color: #002200;"></span> <span style="color: #400080;">CGFloat</span><span style="color: #002200;">&#40;</span>row<span style="color: #002200;">&#41;</span><br>          <span style="color: #a61390;">let</span> point <span style="color: #002200;">=</span> <span style="color: #400080;">CGPoint</span><span style="color: #002200;">&#40;</span>x<span style="color: #002200;">:</span> x, y<span style="color: #002200;">:</span> y<span style="color: #002200;">&#41;</span><br>          <span style="color: #a61390;">let</span> size <span style="color: #002200;">=</span> <span style="color: #400080;">CGSize</span><span style="color: #002200;">&#40;</span>width<span style="color: #002200;">:</span> sideLength, height<span style="color: #002200;">:</span> sideLength<span style="color: #002200;">&#41;</span><br>          <span style="color: #a61390;">var</span> tileRect <span style="color: #002200;">=</span> <span style="color: #400080;">CGRect</span><span style="color: #002200;">&#40;</span>origin<span style="color: #002200;">:</span> point, size<span style="color: #002200;">:</span> size<span style="color: #002200;">&#41;</span><br>          tileRect <span style="color: #002200;">=</span> CGRectIntersection<span style="color: #002200;">&#40;</span>bounds, tileRect<span style="color: #002200;">&#41;</span><br>          tile.drawInRect<span style="color: #002200;">&#40;</span>tileRect<span style="color: #002200;">&#41;</span><br>        <span style="color: #002200;">&#125;</span><br>      <span style="color: #002200;">&#125;</span><br>    <span style="color: #002200;">&#125;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #a61390;">func</span> imageForTileAtColumn<span style="color: #002200;">&#40;</span>column<span style="color: #002200;">:</span> <span style="color: #a61390;">Int</span>, row<span style="color: #002200;">:</span> <span style="color: #a61390;">Int</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">-</span>&gt; <span style="color: #400080;">UIImage</span>? <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">let</span> filePath <span style="color: #002200;">=</span> <span style="color: #bf1d1a;">&quot;<span style="color: #2400d9;">(</span>cachesPath)/<span style="color: #2400d9;">(</span>fileName)<em><span style="color: #2400d9;">(</span>column)</em><span style="color: #2400d9;">(</span>row)&quot;</span><br>    <span style="color: #a61390;">return</span> <span style="color: #400080;">UIImage</span><span style="color: #002200;">&#40;</span>contentsOfFile<span style="color: #002200;">:</span> filePath<span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br><span style="color: #002200;">&#125;</span></pre></td></tr></table></div><br><br><p>上面的代码:</p><br><ol><br><li>为图块侧边长度创建属性, 再用图片文件名和缓存目录路径创建，后者是 TileCutter 扩展保存图块的地方。 saves tiles. </li><br><li>重写 <code>layerClass()</code> 返回 CATiledLayer. </li><br><li>实现  <code>init(_:)</code>, 在视图图层, 转换为图块图层并设置图块大小。 注意没有必要让 <code>contentsScale</code> 匹配屏幕大小, 因为你直接使用视图的支持图层与创建一个新的图层并且作为子图层添加进去。 </li><br><li>重写 <code>drawRect()</code> ，根据你行列位置绘制每个图块。</li><br></ol><br><p>然后子类型的视图, 和原始图像大小，可以加入滚动视图:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/XcodeTilingViewForImageStoryboard.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/XcodeTilingViewForImageStoryboard-480x286.png" width="480" height="286" class="aligncenter size-medium wp-image-91656" srcset="https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/XcodeTilingViewForImageStoryboard-480x286.png 480w, https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/XcodeTilingViewForImageStoryboard-700x417.png 700w, https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/XcodeTilingViewForImageStoryboard.png 1235w" sizes="(max-width: 480px) 100vw, 480px"></a></p><br><p>就这样, 你现在有了黄油一样滑动大图的手感 (5120 x 3200 ), 感谢 CATiledLayer:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATiledImageLayer.gif" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATiledImageLayer.gif" width="332" height="500" class="aligncenter size-full wp-image-91663"></a></p><br><p>如你所见，上面的动画, 存在显著的变形当我们快速滚动的时候。 最小化这种影响可以使用更小的图块 (上述例子使用图块是 640 x 640) 然后创建一个CATiledLayer 的子类然后重写 <code>fadeDuration()</code>，让它返回 0:</p><br><br><div class="wp_codebox"><table><tr id="p9048813"><td class="code" id="p90488code13"><pre class="swift" style="font-family:monospace;"><span style="color: #a61390;">class</span> TiledLayer<span style="color: #002200;">:</span> CATiledLayer <span style="color: #002200;">&#123;</span><br>&nbsp;<br>  <span style="color: #a61390;">override</span> <span style="color: #a61390;">class</span> <span style="color: #a61390;">func</span> fadeDuration<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">-</span>&gt; CFTimeInterval <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">return</span> <span style="color: #2400d9;">0.0</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br><span style="color: #002200;">&#125;</span></pre></td></tr></table></div><br><br><h2>示例8: CAShapeLayer</h2><br><p>CAShapeLayer 使用可扩展的矢量路径去绘制, 这比使用图片要快很多。其他好处是你不用提供 @2x and @3x 尺寸的图片了。 爽!</p><br><p>此外, 在你处理定制线的粗细，颜色, dashing, 线的合并，都有很多属性, 如果线闭合成一个封闭区域, 并且这个区域需要填充某种颜色。 下面是个例子:</p><br><br><div class="wp_codebox"><table><tr id="p9048814"><td class="code" id="p90488code14"><pre class="swift" style="font-family:monospace;"><span style="color: #a61390;">import</span> UIKit<br>&nbsp;<br><span style="color: #a61390;">class</span> ViewController<span style="color: #002200;">:</span> <span style="color: #400080;">UIViewController</span> <span style="color: #002200;">&#123;</span><br>&nbsp;<br>  @IBOutlet weak <span style="color: #a61390;">var</span> someView<span style="color: #002200;">:</span> <span style="color: #400080;">UIView</span><span style="color: #002200;">!</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 1</span><br>  <span style="color: #a61390;">let</span> rwColor <span style="color: #002200;">=</span> <span style="color: #400080;">UIColor</span><span style="color: #002200;">&#40;</span>red<span style="color: #002200;">:</span> <span style="color: #2400d9;">11</span><span style="color: #002200;">/</span><span style="color: #2400d9;">255.0</span>, green<span style="color: #002200;">:</span> <span style="color: #2400d9;">86</span><span style="color: #002200;">/</span><span style="color: #2400d9;">255.0</span>, blue<span style="color: #002200;">:</span> <span style="color: #2400d9;">14</span><span style="color: #002200;">/</span><span style="color: #2400d9;">255.0</span>, alpha<span style="color: #002200;">:</span> <span style="color: #2400d9;">1.0</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #a61390;">let</span> rwPath <span style="color: #002200;">=</span> <span style="color: #400080;">UIBezierPath</span><span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #a61390;">let</span> rwLayer <span style="color: #002200;">=</span> CAShapeLayer<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 2</span><br>  <span style="color: #a61390;">func</span> setUpRWPath<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    rwPath.moveToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">0.22</span>, <span style="color: #2400d9;">124.79</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.addLineToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">0.22</span>, <span style="color: #2400d9;">249.57</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.addLineToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">124.89</span>, <span style="color: #2400d9;">249.57</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.addLineToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">249.57</span>, <span style="color: #2400d9;">249.57</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.addLineToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">249.57</span>, <span style="color: #2400d9;">143.79</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.addCurveToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">249.37</span>, <span style="color: #2400d9;">38.25</span><span style="color: #002200;">&#41;</span>, controlPoint1<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">249.57</span>, <span style="color: #2400d9;">85.64</span><span style="color: #002200;">&#41;</span>, controlPoint2<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">249.47</span>, <span style="color: #2400d9;">38.15</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.addCurveToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">206.47</span>, <span style="color: #2400d9;">112.47</span><span style="color: #002200;">&#41;</span>, controlPoint1<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">249.27</span>, <span style="color: #2400d9;">38.35</span><span style="color: #002200;">&#41;</span>, controlPoint2<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">229.94</span>, <span style="color: #2400d9;">71.76</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.addCurveToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">163.46</span>, <span style="color: #2400d9;">186.84</span><span style="color: #002200;">&#41;</span>, controlPoint1<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">182.99</span>, <span style="color: #2400d9;">153.19</span><span style="color: #002200;">&#41;</span>, controlPoint2<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">163.61</span>, <span style="color: #2400d9;">186.65</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.addCurveToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">146.17</span>, <span style="color: #2400d9;">156.99</span><span style="color: #002200;">&#41;</span>, controlPoint1<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">163.27</span>, <span style="color: #2400d9;">187.03</span><span style="color: #002200;">&#41;</span>, controlPoint2<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">155.48</span>, <span style="color: #2400d9;">173.59</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.addCurveToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">128.79</span>, <span style="color: #2400d9;">127.08</span><span style="color: #002200;">&#41;</span>, controlPoint1<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">136.82</span>, <span style="color: #2400d9;">140.43</span><span style="color: #002200;">&#41;</span>, controlPoint2<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">129.03</span>, <span style="color: #2400d9;">126.94</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.addCurveToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">109.31</span>, <span style="color: #2400d9;">157.77</span><span style="color: #002200;">&#41;</span>, controlPoint1<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">128.59</span>, <span style="color: #2400d9;">127.18</span><span style="color: #002200;">&#41;</span>, controlPoint2<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">119.83</span>, <span style="color: #2400d9;">141.01</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.addCurveToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">89.83</span>, <span style="color: #2400d9;">187.86</span><span style="color: #002200;">&#41;</span>, controlPoint1<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">98.79</span>, <span style="color: #2400d9;">174.52</span><span style="color: #002200;">&#41;</span>, controlPoint2<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">90.02</span>, <span style="color: #2400d9;">188.06</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.addCurveToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">56.52</span>, <span style="color: #2400d9;">108.28</span><span style="color: #002200;">&#41;</span>, controlPoint1<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">89.24</span>, <span style="color: #2400d9;">187.23</span><span style="color: #002200;">&#41;</span>, controlPoint2<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">56.56</span>, <span style="color: #2400d9;">109.11</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.addCurveToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">64.02</span>, <span style="color: #2400d9;">102.25</span><span style="color: #002200;">&#41;</span>, controlPoint1<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">56.47</span>, <span style="color: #2400d9;">107.75</span><span style="color: #002200;">&#41;</span>, controlPoint2<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">59.24</span>, <span style="color: #2400d9;">105.56</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.addCurveToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">101.42</span>, <span style="color: #2400d9;">67.57</span><span style="color: #002200;">&#41;</span>, controlPoint1<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">81.99</span>, <span style="color: #2400d9;">89.78</span><span style="color: #002200;">&#41;</span>, controlPoint2<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">93.92</span>, <span style="color: #2400d9;">78.72</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.addCurveToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">108.38</span>, <span style="color: #2400d9;">30.65</span><span style="color: #002200;">&#41;</span>, controlPoint1<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">110.28</span>, <span style="color: #2400d9;">54.47</span><span style="color: #002200;">&#41;</span>, controlPoint2<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">113.01</span>, <span style="color: #2400d9;">39.96</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.addCurveToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">10.35</span>, <span style="color: #2400d9;">0.41</span><span style="color: #002200;">&#41;</span>, controlPoint1<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">99.66</span>, <span style="color: #2400d9;">13.17</span><span style="color: #002200;">&#41;</span>, controlPoint2<span style="color: #002200;">:</span> CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">64.11</span>, <span style="color: #2400d9;">2.16</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.addLineToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">0.22</span>, <span style="color: #2400d9;">0.07</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.addLineToPoint<span style="color: #002200;">&#40;</span>CGPointMake<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">0.22</span>, <span style="color: #2400d9;">124.79</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    rwPath.closePath<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 3</span><br>  <span style="color: #a61390;">func</span> setUpRWLayer<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    rwLayer.path <span style="color: #002200;">=</span> rwPath.CGPath<br>    rwLayer.fillColor <span style="color: #002200;">=</span> rwColor.<span style="color: #400080;">CGColor</span><br>    rwLayer.fillRule <span style="color: #002200;">=</span> kCAFillRuleNonZero<br>    rwLayer.lineCap <span style="color: #002200;">=</span> kCALineCapButt<br>    rwLayer.lineDashPattern <span style="color: #002200;">=</span> <span style="color: #a61390;">nil</span><br>    rwLayer.lineDashPhase <span style="color: #002200;">=</span> <span style="color: #2400d9;">0.0</span><br>    rwLayer.lineJoin <span style="color: #002200;">=</span> kCALineJoinMiter<br>    rwLayer.lineWidth <span style="color: #002200;">=</span> <span style="color: #2400d9;">1.0</span><br>    rwLayer.miterLimit <span style="color: #002200;">=</span> <span style="color: #2400d9;">10.0</span><br>    rwLayer.strokeColor <span style="color: #002200;">=</span> rwColor.<span style="color: #400080;">CGColor</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #a61390;">override</span> <span style="color: #a61390;">func</span> viewDidLoad<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">super</span>.viewDidLoad<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>&nbsp;<br>    <span style="color: #11740a; font-style: italic;">// 4</span><br>    setUpRWPath<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>    setUpRWLayer<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>    someView.layer.addSublayer<span style="color: #002200;">&#40;</span>rwLayer<span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br><span style="color: #002200;">&#125;</span></pre></td></tr></table></div><br><br><p>代码讲解:</p><br><ol><br><li>创建颜色, 路径, 和形状图层对象。</li><br><li>绘制形状图层的路径。 如果你不想写样板代码, 取出 <a href="http://www.paintcodeapp.com" target="_blank" rel="external">PaintCode</a>; 它通过控件或者输入存在的矢量图或者psd文件来生成代码。 </li><br><li>建立形状图层。 路径设置成第二部绘制的路径的 CGPath , 填充颜色为第一步创建的颜色的 CGColor , 填充规则显示设置成非零默认值。<br><ul><br><li>其他唯一选项是奇偶数, 对于这个形状来说，没有交叉路径，填充规则没有太大区别。 </li><br><li>非零规则数 left-to-right 路径 +1 ， right-to-left 路径 -1; 它合计所有路径值，如果总数大于 0 , 它用这些路径填充这些形状。 </li><br><li>本质上, 非零填充形状内部所有点。 </li><br><li>奇偶规则计算构成图形 <i>交叉路径</i> 的总数，并且，如果技术是奇数, 形状被填充。 这绝对是一张图胜过一千个单词。 </li><br><p>构成五边形的奇偶图表交叉路径数目是偶数, 因此五角星没有被填充, 构成三角形的交叉路径数是奇数, 所以三角形被填充了。<br><br><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAShapeLayerFillRules.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAShapeLayerFillRules-480x256.png" width="480" height="256" class="aligncenter size-medium wp-image-91890" srcset="https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CAShapeLayerFillRules-480x256.png 480w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CAShapeLayerFillRules.png 676w" sizes="(max-width: 480px) 100vw, 480px"></a></p></ul></li><br><li>调用路径绘制和图层建立的代码, 然后把图层添加到视图层级中。 </li><br></ol><br><p>这个代码绘制了 raywenderlich.com 的标志图:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/RayWenderlichLogo.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/RayWenderlichLogo-250x250.png" width="250" height="250" class="aligncenter size-thumbnail wp-image-91840" srcset="https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/RayWenderlichLogo-250x250.png 250w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/RayWenderlichLogo-320x320.png 320w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/RayWenderlichLogo-32x32.png 32w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/RayWenderlichLogo-64x64.png 64w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/RayWenderlichLogo-96x96.png 96w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/RayWenderlichLogo-128x128.png 128w, https://cdn5.raywenderlich.com/wp-content/uploads/2014/12/RayWenderlichLogo.png 377w" sizes="(max-width: 250px) 100vw, 250px"></a></p><br><p>假使你很好奇想知道在 <a href="http://www.paintcodeapp.com" target="_blank" rel="external">PaintCode</a> 中这个绘制看起来是:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/PaintCodeRayWenderlichLogo.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/PaintCodeRayWenderlichLogo-480x265.png" width="480" height="265" class="aligncenter size-medium wp-image-91841" srcset="https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/PaintCodeRayWenderlichLogo-480x265.png 480w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/PaintCodeRayWenderlichLogo-700x387.png 700w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/PaintCodeRayWenderlichLogo.png 1280w" sizes="(max-width: 480px) 100vw, 480px"></a></p><br><p>Layer Player 包含很多控件去操作 CAShapeLayer 的多数属性:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAShapeLayer_5.5.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAShapeLayer_5.5-180x320.png" width="180" height="320" class="aligncenter size-medium wp-image-91843 bordered" srcset="https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/CAShapeLayer_5.5-180x320.png 180w, https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/CAShapeLayer_5.5-281x500.png 281w, https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/CAShapeLayer_5.5.png 1242w" sizes="(max-width: 180px) 100vw, 180px"></a></p><br><div class="note"><br><p><em>备注</em>: 你可能注意到我们跳过了 Layer Player 应用上的下一个示例。 这是因为 CAEAGLLayer 被 CAMetalLayer 淘汰了, 后者跟着 Metal 框架一起在 iOS 8 发布。 你可以在 <a href="http://www.raywenderlich.com/77488/ios-8-metal-tutorial-swift-getting-started" title="iOS 8 Metal Tutorial with Swift: Getting Started" target="_blank" rel="external">这里</a> 找到很棒的 CAMetalLayer 辅导材料。</p><br></div><br><h2>示例9: CATransformLayer</h2><br><p>CATransformLayer 处理 3D 结构很便捷。 它实际上是子图层的容器, 每个子图层都有自己的变换和不透明变化, 不过, 它会忽略其他渲染图层属性的变化, 比如 边框宽度和颜色。 </p><br><p>你不能直接对变换图层做点击测试, 因为它没有 2D 的坐标空间去匹配触摸点, 不过, 可以对独立的子图层做点击测试。 这儿是例子:</p><br><br><div class="wp_codebox"><table><tr id="p9048815"><td class="code" id="p90488code15"><pre class="swift" style="font-family:monospace;"><span style="color: #a61390;">import</span> UIKit<br>&nbsp;<br><span style="color: #a61390;">class</span> ViewController<span style="color: #002200;">:</span> <span style="color: #400080;">UIViewController</span> <span style="color: #002200;">&#123;</span><br>&nbsp;<br>  @IBOutlet weak <span style="color: #a61390;">var</span> someView<span style="color: #002200;">:</span> <span style="color: #400080;">UIView</span><span style="color: #002200;">!</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 1</span><br>  <span style="color: #a61390;">let</span> sideLength <span style="color: #002200;">=</span> <span style="color: #400080;">CGFloat</span><span style="color: #002200;">&#40;</span><span style="color: #2400d9;">160.0</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #a61390;">var</span> redColor <span style="color: #002200;">=</span> <span style="color: #400080;">UIColor</span>.redColor<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #a61390;">var</span> orangeColor <span style="color: #002200;">=</span> <span style="color: #400080;">UIColor</span>.orangeColor<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #a61390;">var</span> yellowColor <span style="color: #002200;">=</span> <span style="color: #400080;">UIColor</span>.yellowColor<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #a61390;">var</span> greenColor <span style="color: #002200;">=</span> <span style="color: #400080;">UIColor</span>.greenColor<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #a61390;">var</span> blueColor <span style="color: #002200;">=</span> <span style="color: #400080;">UIColor</span>.blueColor<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #a61390;">var</span> purpleColor <span style="color: #002200;">=</span> <span style="color: #400080;">UIColor</span>.purpleColor<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #a61390;">var</span> transformLayer <span style="color: #002200;">=</span> CATransformLayer<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 2</span><br>  <span style="color: #a61390;">func</span> setUpTransformLayer<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">var</span> layer <span style="color: #002200;">=</span> sideLayerWithColor<span style="color: #002200;">&#40;</span>redColor<span style="color: #002200;">&#41;</span><br>    transformLayer.addSublayer<span style="color: #002200;">&#40;</span>layer<span style="color: #002200;">&#41;</span><br>&nbsp;<br>    layer <span style="color: #002200;">=</span> sideLayerWithColor<span style="color: #002200;">&#40;</span>orangeColor<span style="color: #002200;">&#41;</span><br>    <span style="color: #a61390;">var</span> transform <span style="color: #002200;">=</span> CATransform3DMakeTranslation<span style="color: #002200;">&#40;</span>sideLength <span style="color: #002200;">/</span> <span style="color: #2400d9;">2.0</span>, <span style="color: #2400d9;">0.0</span>, sideLength <span style="color: #002200;">/</span> <span style="color: #002200;">-</span><span style="color: #2400d9;">2.0</span><span style="color: #002200;">&#41;</span><br>    transform <span style="color: #002200;">=</span> CATransform3DRotate<span style="color: #002200;">&#40;</span>transform, degreesToRadians<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">90.0</span><span style="color: #002200;">&#41;</span>, <span style="color: #2400d9;">0.0</span>, <span style="color: #2400d9;">1.0</span>, <span style="color: #2400d9;">0.0</span><span style="color: #002200;">&#41;</span><br>    layer.transform <span style="color: #002200;">=</span> transform<br>    transformLayer.addSublayer<span style="color: #002200;">&#40;</span>layer<span style="color: #002200;">&#41;</span><br>&nbsp;<br>    layer <span style="color: #002200;">=</span> sideLayerWithColor<span style="color: #002200;">&#40;</span>yellowColor<span style="color: #002200;">&#41;</span><br>    layer.transform <span style="color: #002200;">=</span> CATransform3DMakeTranslation<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">0.0</span>, <span style="color: #2400d9;">0.0</span>, <span style="color: #002200;">-</span>sideLength<span style="color: #002200;">&#41;</span><br>    transformLayer.addSublayer<span style="color: #002200;">&#40;</span>layer<span style="color: #002200;">&#41;</span><br>&nbsp;<br>    layer <span style="color: #002200;">=</span> sideLayerWithColor<span style="color: #002200;">&#40;</span>greenColor<span style="color: #002200;">&#41;</span><br>    transform <span style="color: #002200;">=</span> CATransform3DMakeTranslation<span style="color: #002200;">&#40;</span>sideLength <span style="color: #002200;">/</span> <span style="color: #002200;">-</span><span style="color: #2400d9;">2.0</span>, <span style="color: #2400d9;">0.0</span>, sideLength <span style="color: #002200;">/</span> <span style="color: #002200;">-</span><span style="color: #2400d9;">2.0</span><span style="color: #002200;">&#41;</span><br>    transform <span style="color: #002200;">=</span> CATransform3DRotate<span style="color: #002200;">&#40;</span>transform, degreesToRadians<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">90.0</span><span style="color: #002200;">&#41;</span>, <span style="color: #2400d9;">0.0</span>, <span style="color: #2400d9;">1.0</span>, <span style="color: #2400d9;">0.0</span><span style="color: #002200;">&#41;</span><br>    layer.transform <span style="color: #002200;">=</span> transform<br>    transformLayer.addSublayer<span style="color: #002200;">&#40;</span>layer<span style="color: #002200;">&#41;</span><br>&nbsp;<br>    layer <span style="color: #002200;">=</span> sideLayerWithColor<span style="color: #002200;">&#40;</span>blueColor<span style="color: #002200;">&#41;</span><br>    transform <span style="color: #002200;">=</span> CATransform3DMakeTranslation<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">0.0</span>, sideLength <span style="color: #002200;">/</span> <span style="color: #002200;">-</span><span style="color: #2400d9;">2.0</span>, sideLength <span style="color: #002200;">/</span> <span style="color: #002200;">-</span><span style="color: #2400d9;">2.0</span><span style="color: #002200;">&#41;</span><br>    transform <span style="color: #002200;">=</span> CATransform3DRotate<span style="color: #002200;">&#40;</span>transform, degreesToRadians<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">90.0</span><span style="color: #002200;">&#41;</span>, <span style="color: #2400d9;">1.0</span>, <span style="color: #2400d9;">0.0</span>, <span style="color: #2400d9;">0.0</span><span style="color: #002200;">&#41;</span><br>    layer.transform <span style="color: #002200;">=</span> transform<br>    transformLayer.addSublayer<span style="color: #002200;">&#40;</span>layer<span style="color: #002200;">&#41;</span><br>&nbsp;<br>    layer <span style="color: #002200;">=</span> sideLayerWithColor<span style="color: #002200;">&#40;</span>purpleColor<span style="color: #002200;">&#41;</span><br>    transform <span style="color: #002200;">=</span> CATransform3DMakeTranslation<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">0.0</span>, sideLength <span style="color: #002200;">/</span> <span style="color: #2400d9;">2.0</span>, sideLength <span style="color: #002200;">/</span> <span style="color: #002200;">-</span><span style="color: #2400d9;">2.0</span><span style="color: #002200;">&#41;</span><br>    transform <span style="color: #002200;">=</span> CATransform3DRotate<span style="color: #002200;">&#40;</span>transform, degreesToRadians<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">90.0</span><span style="color: #002200;">&#41;</span>, <span style="color: #2400d9;">1.0</span>, <span style="color: #2400d9;">0.0</span>, <span style="color: #2400d9;">0.0</span><span style="color: #002200;">&#41;</span><br>    layer.transform <span style="color: #002200;">=</span> transform<br>    transformLayer.addSublayer<span style="color: #002200;">&#40;</span>layer<span style="color: #002200;">&#41;</span><br>&nbsp;<br>    transformLayer.anchorPointZ <span style="color: #002200;">=</span> sideLength <span style="color: #002200;">/</span> <span style="color: #002200;">-</span><span style="color: #2400d9;">2.0</span><br>    applyRotationForXOffset<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">16.0</span>, yOffset<span style="color: #002200;">:</span> <span style="color: #2400d9;">16.0</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 3</span><br>  <span style="color: #a61390;">func</span> sideLayerWithColor<span style="color: #002200;">&#40;</span>color<span style="color: #002200;">:</span> <span style="color: #400080;">UIColor</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">-</span>&gt; <span style="color: #400080;">CALayer</span> <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">let</span> layer <span style="color: #002200;">=</span> <span style="color: #400080;">CALayer</span><span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>    layer.frame <span style="color: #002200;">=</span> <span style="color: #400080;">CGRect</span><span style="color: #002200;">&#40;</span>origin<span style="color: #002200;">:</span> CGPointZero, size<span style="color: #002200;">:</span> <span style="color: #400080;">CGSize</span><span style="color: #002200;">&#40;</span>width<span style="color: #002200;">:</span> sideLength, height<span style="color: #002200;">:</span> sideLength<span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    layer.position <span style="color: #002200;">=</span> <span style="color: #400080;">CGPoint</span><span style="color: #002200;">&#40;</span>x<span style="color: #002200;">:</span> CGRectGetMidX<span style="color: #002200;">&#40;</span>someView.bounds<span style="color: #002200;">&#41;</span>, y<span style="color: #002200;">:</span> CGRectGetMidY<span style="color: #002200;">&#40;</span>someView.bounds<span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>    layer.backgroundColor <span style="color: #002200;">=</span> color.<span style="color: #400080;">CGColor</span><br>    <span style="color: #a61390;">return</span> layer<br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #a61390;">func</span> degreesToRadians<span style="color: #002200;">&#40;</span>degrees<span style="color: #002200;">:</span> <span style="color: #a61390;">Double</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">-</span>&gt; <span style="color: #400080;">CGFloat</span> <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">return</span> <span style="color: #400080;">CGFloat</span><span style="color: #002200;">&#40;</span>degrees <span style="color: #002200;"><em></em></span> M_PI <span style="color: #002200;">/</span> <span style="color: #2400d9;">180.0</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 4</span><br>  <span style="color: #a61390;">func</span> applyRotationForXOffset<span style="color: #002200;">&#40;</span>xOffset<span style="color: #002200;">:</span> <span style="color: #a61390;">Double</span>, yOffset<span style="color: #002200;">:</span> <span style="color: #a61390;">Double</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">let</span> totalOffset <span style="color: #002200;">=</span> sqrt<span style="color: #002200;">&#40;</span>xOffset <span style="color: #002200;"></span> xOffset <span style="color: #002200;">+</span> yOffset <span style="color: #002200;"><em></em></span> yOffset<span style="color: #002200;">&#41;</span><br>    <span style="color: #a61390;">let</span> totalRotation <span style="color: #002200;">=</span> <span style="color: #400080;">CGFloat</span><span style="color: #002200;">&#40;</span>totalOffset <span style="color: #002200;"></span> M_PI <span style="color: #002200;">/</span> <span style="color: #2400d9;">180.0</span><span style="color: #002200;">&#41;</span><br>    <span style="color: #a61390;">let</span> xRotationalFactor <span style="color: #002200;">=</span> <span style="color: #400080;">CGFloat</span><span style="color: #002200;">&#40;</span>totalOffset<span style="color: #002200;">&#41;</span> <span style="color: #002200;">/</span> totalRotation<br>    <span style="color: #a61390;">let</span> yRotationalFactor <span style="color: #002200;">=</span> <span style="color: #400080;">CGFloat</span><span style="color: #002200;">&#40;</span>totalOffset<span style="color: #002200;">&#41;</span> <span style="color: #002200;">/</span> totalRotation<br>    <span style="color: #a61390;">let</span> currentTransform <span style="color: #002200;">=</span> CATransform3DTranslate<span style="color: #002200;">&#40;</span>transformLayer.sublayerTransform, <span style="color: #2400d9;">0.0</span>, <span style="color: #2400d9;">0.0</span>, <span style="color: #2400d9;">0.0</span><span style="color: #002200;">&#41;</span><br>    <span style="color: #a61390;">let</span> rotationTransform <span style="color: #002200;">=</span> CATransform3DRotate<span style="color: #002200;">&#40;</span>transformLayer.sublayerTransform, totalRotation,<br>      xRotationalFactor <span style="color: #002200;"><em></em></span> currentTransform.m12 <span style="color: #002200;">-</span> yRotationalFactor <span style="color: #002200;"></span> currentTransform.m11,<br>      xRotationalFactor <span style="color: #002200;"><em></em></span> currentTransform.m22 <span style="color: #002200;">-</span> yRotationalFactor <span style="color: #002200;"></span> currentTransform.m21,<br>      xRotationalFactor <span style="color: #002200;"><em></em></span> currentTransform.m32 <span style="color: #002200;">-</span> yRotationalFactor <span style="color: #002200;"></span> currentTransform.m31<span style="color: #002200;">&#41;</span><br>    transformLayer.sublayerTransform <span style="color: #002200;">=</span> rotationTransform<br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 5</span><br>  <span style="color: #a61390;">override</span> <span style="color: #a61390;">func</span> touchesBegan<span style="color: #002200;">&#40;</span>touches<span style="color: #002200;">:</span> <span style="color: #400080;">NSSet</span>, withEvent event<span style="color: #002200;">:</span> <span style="color: #400080;">UIEvent</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">if</span> <span style="color: #a61390;">let</span> location <span style="color: #002200;">=</span> touches.anyObject<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span>?.locationInView<span style="color: #002200;">&#40;</span>someView<span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>      <span style="color: #a61390;">for</span> layer <span style="color: #a61390;">in</span> transformLayer.sublayers <span style="color: #002200;">&#123;</span><br>        <span style="color: #a61390;">if</span> <span style="color: #a61390;">let</span> hitLayer <span style="color: #002200;">=</span> layer.hitTest<span style="color: #002200;">&#40;</span>location<span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>          <span style="color: #a61390;">println</span><span style="color: #002200;">&#40;</span><span style="color: #bf1d1a;">&quot;Transform layer tapped!&quot;</span><span style="color: #002200;">&#41;</span><br>          break<br>        <span style="color: #002200;">&#125;</span><br>      <span style="color: #002200;">&#125;</span><br>    <span style="color: #002200;">&#125;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #a61390;">override</span> <span style="color: #a61390;">func</span> viewDidLoad<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">super</span>.viewDidLoad<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>&nbsp;<br>    <span style="color: #11740a; font-style: italic;">// 6</span><br>    setUpTransformLayer<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>    someView.layer.addSublayer<span style="color: #002200;">&#40;</span>transformLayer<span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br><span style="color: #002200;">&#125;</span></pre></td></tr></table></div><br><br><p>上面的代码做了以下的事:</p><br><ol><br><li>创建边长属性, 正方体各边的颜色, 和变换图层。 </li><br><li>通过创建, 旋转和添加每个面到变换图层来构建正方体。 然后它会设置变换图层的z轴锚点，旋转正方体然后添加到视图层级中。 </li><br><li>创建辅助代码，用指定颜色来创建正方体的每个面, 然后把角度转换为弧度。 为什么用弧度? 简单来说，因为我发现用角度比用弧度更直观。 </li><br><li>基于 x 和 y 偏移来使用旋转。 注意这个代码变换设置为 <code>sublayerTransform</code>, 这会应用到变换图层的子图层。 </li><br><li>通过变换图层的子图层来观察触摸和循环。 这部分点击测试每个图层，一旦检测到点击立即中断测试, 因为没有必要去测试剩余的图层。 </li><br><li>建立转换图层并把它添加到视图层级中。</li><br></ol><br><div class="note"><br><p><em>备注</em>: 这些 <code>currentTransform.m##</code> 是什么鬼? 我很高兴你问到这个问题。 这些都是 CATransform3D 的属性， 表示矩阵的元素, 这个矩阵由一个行列矩形数组构成。<br></p><br><p>想要学习更多用在本例的矩阵变换, 可以下载 <a href="https://github.com/jrturton/3DTransformFun" title="3DTransform Fun" target="_blank">3DTransformFun project</a> , 这是由辅导小组成员 <a href="http://www.raywenderlich.com/u/jrturton" title="Rich Turton" target="_blank" rel="external">Rich Turton</a> 提供， 还有这个 <a href="https://github.com/mpospese/EnterTheMatrix" title="Enter The Matrix" target="_blank">Enter The Matrix project</a> 由 Mark Pospesel 提供。<br></p><br></div><br><p>运行上面的代码，用一个 250 x 250 的视图 <code>someView</code> 会有下面的结果:</p><br><p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATransformLayer-250x250.png" width="250" height="250" class="aligncenter size-thumbnail wp-image-91859" srcset="https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATransformLayer-250x250.png 250w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATransformLayer-32x32.png 32w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATransformLayer-64x64.png 64w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATransformLayer-96x96.png 96w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATransformLayer-128x128.png 128w, https://cdn4.raywenderlich.com/wp-content/uploads/2014/12/CATransformLayer.png 306w" sizes="(max-width: 250px) 100vw, 250px"></p><br><p>现在, 尝试一些东西: 点击正方体任何地方, &#8220;Transform layer tapped!&#8221; 都会被打印到控制台。 </p><br><p>Layer Player 包含开关去切换每一个子图层的不透明度,  <a href="http://bill.dudney.net/roller/objc/entry/trackball_3d_transforms_made_easy" title="TrackBall - 3D transforms made easy" target="_blank">TrackBall utility from Bill Dudney</a>, <a href="https://github.com/scotteg/TrackBall" title="Swift port of Bill Dudney's original TrackBall Objective-C source code" target="_blank">ported to Swift</a>, 这些使得基于用户手势应用 3D 变换更加简单:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATransformLayer_5.5.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CATransformLayer_5.5-180x320.png" width="180" height="320" class="aligncenter size-medium wp-image-91862 bordered" srcset="https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/CATransformLayer_5.5-180x320.png 180w, https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/CATransformLayer_5.5-281x500.png 281w, https://cdn2.raywenderlich.com/wp-content/uploads/2014/12/CATransformLayer_5.5.png 1242w" sizes="(max-width: 180px) 100vw, 180px"></a></p><br><h2>示例10: CAEmitterLayer</h2><br><p>CAEmitterLayer 渲染 CAEmitterCell 实例的动态颗粒。CAEmitterLayer 和 CAEmitterCell 都有属性可以去改变渲染的速率, 尺寸, 形状, 颜色, 速度, 生命周期和其他更多。 实例如下:</p><br><br><div class="wp_codebox"><table><tr id="p9048816"><td class="code" id="p90488code16"><pre class="swift" style="font-family:monospace;"><span style="color: #a61390;">import</span> UIKit<br>&nbsp;<br><span style="color: #a61390;">class</span> ViewController<span style="color: #002200;">:</span> <span style="color: #400080;">UIViewController</span> <span style="color: #002200;">&#123;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 1</span><br>  <span style="color: #a61390;">let</span> emitterLayer <span style="color: #002200;">=</span> CAEmitterLayer<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #a61390;">let</span> emitterCell <span style="color: #002200;">=</span> CAEmitterCell<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 2</span><br>  <span style="color: #a61390;">func</span> setUpEmitterLayer<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    emitterLayer.frame <span style="color: #002200;">=</span> view.bounds<br>    emitterLayer.seed <span style="color: #002200;">=</span> UInt32<span style="color: #002200;">&#40;</span><span style="color: #400080;">NSDate</span><span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span>.timeIntervalSince1970<span style="color: #002200;">&#41;</span><br>    emitterLayer.renderMode <span style="color: #002200;">=</span> kCAEmitterLayerAdditive<br>    emitterLayer.drawsAsynchronously <span style="color: #002200;">=</span> <span style="color: #a61390;">true</span><br>    setEmitterPosition<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 3</span><br>  <span style="color: #a61390;">func</span> setUpEmitterCell<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    emitterCell.contents <span style="color: #002200;">=</span> <span style="color: #400080;">UIImage</span><span style="color: #002200;">&#40;</span>named<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">&quot;smallStar&quot;</span><span style="color: #002200;">&#41;</span>?.CGImage<br>&nbsp;<br>    emitterCell.velocity <span style="color: #002200;">=</span> <span style="color: #2400d9;">50.0</span><br>    emitterCell.velocityRange <span style="color: #002200;">=</span> <span style="color: #2400d9;">500.0</span><br>&nbsp;<br>    emitterCell.color <span style="color: #002200;">=</span> <span style="color: #400080;">UIColor</span>.blackColor<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span>.<span style="color: #400080;">CGColor</span><br>    emitterCell.redRange <span style="color: #002200;">=</span> <span style="color: #2400d9;">1.0</span><br>    emitterCell.greenRange <span style="color: #002200;">=</span> <span style="color: #2400d9;">1.0</span><br>    emitterCell.blueRange <span style="color: #002200;">=</span> <span style="color: #2400d9;">1.0</span><br>    emitterCell.alphaRange <span style="color: #002200;">=</span> <span style="color: #2400d9;">0.0</span><br>    emitterCell.redSpeed <span style="color: #002200;">=</span> <span style="color: #2400d9;">0.0</span><br>    emitterCell.greenSpeed <span style="color: #002200;">=</span> <span style="color: #2400d9;">0.0</span><br>    emitterCell.blueSpeed <span style="color: #002200;">=</span> <span style="color: #2400d9;">0.0</span><br>    emitterCell.alphaSpeed <span style="color: #002200;">=</span> <span style="color: #002200;">-</span><span style="color: #2400d9;">0.5</span><br>&nbsp;<br>    <span style="color: #a61390;">let</span> zeroDegreesInRadians <span style="color: #002200;">=</span> degreesToRadians<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">0.0</span><span style="color: #002200;">&#41;</span><br>    emitterCell.spin <span style="color: #002200;">=</span> degreesToRadians<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">130.0</span><span style="color: #002200;">&#41;</span><br>    emitterCell.spinRange <span style="color: #002200;">=</span> zeroDegreesInRadians<br>    emitterCell.emissionRange <span style="color: #002200;">=</span> degreesToRadians<span style="color: #002200;">&#40;</span><span style="color: #2400d9;">360.0</span><span style="color: #002200;">&#41;</span><br>&nbsp;<br>    emitterCell.lifetime <span style="color: #002200;">=</span> <span style="color: #2400d9;">1.0</span><br>    emitterCell.birthRate <span style="color: #002200;">=</span> <span style="color: #2400d9;">250.0</span><br>    emitterCell.xAcceleration <span style="color: #002200;">=</span> <span style="color: #002200;">-</span><span style="color: #2400d9;">800.0</span><br>    emitterCell.yAcceleration <span style="color: #002200;">=</span> <span style="color: #2400d9;">1000.0</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 4</span><br>  <span style="color: #a61390;">func</span> setEmitterPosition<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    emitterLayer.emitterPosition <span style="color: #002200;">=</span> <span style="color: #400080;">CGPoint</span><span style="color: #002200;">&#40;</span>x<span style="color: #002200;">:</span> CGRectGetMidX<span style="color: #002200;">&#40;</span>view.bounds<span style="color: #002200;">&#41;</span>, y<span style="color: #002200;">:</span> CGRectGetMidY<span style="color: #002200;">&#40;</span>view.bounds<span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #a61390;">func</span> degreesToRadians<span style="color: #002200;">&#40;</span>degrees<span style="color: #002200;">:</span> <span style="color: #a61390;">Double</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">-</span>&gt; <span style="color: #400080;">CGFloat</span> <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">return</span> <span style="color: #400080;">CGFloat</span><span style="color: #002200;">&#40;</span>degrees <span style="color: #002200;">*</span> M_PI <span style="color: #002200;">/</span> <span style="color: #2400d9;">180.0</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #a61390;">override</span> <span style="color: #a61390;">func</span> viewDidLoad<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    <span style="color: #a61390;">super</span>.viewDidLoad<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>&nbsp;<br>    <span style="color: #11740a; font-style: italic;">// 5</span><br>    setUpEmitterLayer<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>    setUpEmitterCell<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>    emitterLayer.emitterCells <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>emitterCell<span style="color: #002200;">&#93;</span><br>    view.layer.addSublayer<span style="color: #002200;">&#40;</span>emitterLayer<span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br>  <span style="color: #11740a; font-style: italic;">// 6</span><br>  <span style="color: #a61390;">override</span> <span style="color: #a61390;">func</span> traitCollectionDidChange<span style="color: #002200;">&#40;</span>previousTraitCollection<span style="color: #002200;">:</span> UITraitCollection?<span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br>    setEmitterPosition<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br>  <span style="color: #002200;">&#125;</span><br>&nbsp;<br><span style="color: #002200;">&#125;</span></pre></td></tr></table></div><br><br><p>上面的代码做了下面的事情:</p><br><ol><br><li>创建发射器图层和单元格。<br></li><li>通过如下方式建立发射器图层:<br><ul><br><li>为图层随机送产生器提供种子，产生器会为图层的发射器单元格随机生成某种属性, 比如速度。 下面的注释会做进一步解释。 </li><br><li>在上面图层的背景色和边框上渲染发射器单元, 使用命令由 <code>renderMode</code> 指定。<br><div class="note"><br><p><em>备注</em>:  目前苹果的文档错误的指出, 这个属性值定义在 Emitter Modes 下。 而实际上, renderMode 的值定义在 Emitter Render Order 下。 默认值是无序的, 额外的选项包括 oldest first, oldest last, back to front 和 additive. </p><br></div><br></li><br><li>把 <code>drawsAsynchronously</code> 设置成 <code>true</code>, 这个可以提升性能, 因为发射器图层必须连续重绘发射单元。 </li><br><li>下一步, 发射位置通过辅助方法设置- 注释4了解更多。 这是好例子去学习如何把 <code>drawsAsynchronously</code> 设置成 <code>true</code> , 这会提升性能并使动画更平顺。</li><br></ul><br></li><li>这块做了很多事!<br><ul><br><li>给发射单元设置图片作为内容 (这个图片在 Layer Player 工程里可以用)。 </li><br><li>然后指定了初始速度和最大方差 (<code>velocityRange</code>); 发射图层使用上述的种子创建一个随机数生成器，这个发射器在 (初始值 +/- 范围值) 之内生成随机数。 随机发生在 <em>Range</em> 结尾的任何属性上。</li><br><li>颜色设置成黑色, 允许方差 (下面讨论) 从默认白色改变, 白色会产生明亮的颗粒。 </li><br><li>接下来设置一系列颜色, 对 <code>velocityRange</code> 使用相同的随机化, 这个时候为每个颜色指定方差的范围。 种子值在单元生命周期控制每个颜色的变化速度。 </li><br><li>下一步, 第三块代码指出怎样围绕一个循环的圆锥体发射单元格。 更多细节: 它设置了发射单元的旋转速度和发射范围。 此外, 发射范围决定发射单元如何围绕圆锥体发射, 这个值定义在 <code>emissionRange</code> , 用弧度指定。<br></li><li>设置单元格生命周期为 1 秒。 这个属性默认值是 0, 所以如果你不显示的设置这个值, 单元格永远不会出现! 对 <code>birthRate</code> (每秒) 也是一样; 默认值也是 0, 因此这个值必须设置成某个整数来保证单元格会出现。<br></li><li>最后, 单元 x 和 y 加速被设置; 这些值影响颗粒发射的视觉角度。</li><br></ul><br></li><li>把角度转换为弧度, 把发射单元位置设置到视图的中心。<br></li><li>建立发射图层和单元, 然后把单元格添加到图层,再把图层加到视图层级中。<br></li></ol><br><p>爽! 我知道这个信息量太大, 不过你坚韧灵活。</p><br><p>代码运行结果提醒我这些 <a href="https://www.youtube.com/watch?v=oT0JWGPXnTg" title="Sean Hayes - The More You Know Commercial" target="_blank">The More You Know</a> 商业广告:</p><br><p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAEmitterLayer2.gif" width="350" height="242" class="aligncenter size-full wp-image-92125"></p><br><p>Layer Player 包含控件来调整所有上面提到的属性, 还多了几个:</p><br><p><a href="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAEmitterLayer_5.5.png" target="_blank" rel="external"><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/CAEmitterLayer_5.5-180x320.png" width="180" height="320" class="aligncenter size-medium wp-image-92127 bordered" srcset="https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/CAEmitterLayer_5.5-180x320.png 180w, https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/CAEmitterLayer_5.5-281x500.png 281w, https://cdn1.raywenderlich.com/wp-content/uploads/2014/12/CAEmitterLayer_5.5.png 1242w" sizes="(max-width: 180px) 100vw, 180px"></a></p><br><p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/12/victorious-e1419192669236.png" width="147" height="300" class="alignright size-full wp-image-92137"></p><br><br><br></html>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://yoursite.com/2016/09/19/CALayer开发指南/" data-title="CALayer开发指南 | 跳跳魔王的博客" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2016/09/21/XCode-8-新特性/" title="XCode 8 新特性">
  <strong>上一篇：</strong><br/>
  <span>
  XCode 8 新特性</span>
</a>
</div>


<div class="next">
<a href="/2016/09/14/UIStackView-使用指南/"  title="UIStackView 使用指南">
 <strong>下一篇：</strong><br/> 
 <span>UIStackView 使用指南
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2016/09/19/CALayer开发指南/" data-title="CALayer开发指南" data-url="http://yoursite.com/2016/09/19/CALayer开发指南/"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">1.</span> <span class="toc-text">开始</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">2.</span> <span class="toc-text">基本的 CALayer 属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">3.</span> <span class="toc-text">改变图层的外观</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">4.</span> <span class="toc-text">伟大的 CALayer 之旅</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">5.</span> <span class="toc-text">示例1: CALayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">6.</span> <span class="toc-text">示例2: CAScrollLayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">7.</span> <span class="toc-text">示例3: CATextLayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">8.</span> <span class="toc-text">示例4: AVPlayerLayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">9.</span> <span class="toc-text">示例5: CAGradientLayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">10.</span> <span class="toc-text">示例6: CAReplicatorLayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">11.</span> <span class="toc-text">示例7: CATiledLayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">12.</span> <span class="toc-text">示例8: CAShapeLayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">13.</span> <span class="toc-text">示例9: CATransformLayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">14.</span> <span class="toc-text">示例10: CAEmitterLayer</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  


  

  

  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="http://www.mhealth365.cn/" target="_blank" title="一款温暖的心电监测设备">熙健-掌上心电</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=null&verifier=&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> I&#39;m an iOS engineer <br/>
			Hala Madrid</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/2779746325" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2016 
		
		<a href="/about" target="_blank" title="跳跳魔王">跳跳魔王</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"ecgbao"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
